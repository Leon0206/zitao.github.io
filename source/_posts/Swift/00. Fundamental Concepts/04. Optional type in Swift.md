---
title: 04. Optional type in Swift.
date: 2023-11-07 17:10:00
categories: 
- [Swift, 00. Fundamental Concepts]
tags:
- Optional
---

<font color=gray size=2>*It will take about 2 minutes to finish reading this article.*</font>


#### <font size=5 color=#4169E1>1. The concept of Optional type</font> 

Why is the concept of Optional introduced in Swift? It is introduced in the official documentation:

```Swift
Swift also introduces optional types, which handle the absence of a value. Optionals say either “there is a value, and it equals x” or “there isn’t a value at all”. Using optionals is similar to using nil with pointers in Objective-C, but they work for any type, not just classes. Not only are optionals safer and more expressive than nil pointers in Objective-C, they’re at the heart of many of Swift’s most powerful features.

```

To sum it up: the optional type is used to express "there is a value, it is equal to x or there is no value at all". When we encounter the Optional type, we will obviously know that the value here may be nil, and we must handle it with caution. This approach is safer and more expressive than Objective-C. To put it bluntly, the introduction of optional types is both safe and convenient to write.

#### <font size=5 color=#4169E1>2. Implementation of Optional type</font> 

```Swift
var optionalInteger: Int?
```
or

```Swift
var optionalInteger: Int！
```

? and!, they are all syntactic sugar for optional types.

#### <font size=5 color=#4169E1>3. The essence of Optional type</font> 

Optional is actually an enumeration (strictly speaking: it should be a high-order abstract type based on enum and generics), which are None and Some(T) respectively. If the optional type is nil, the Case of None will be hit.

```Swift
enum Optional<T> : NilLiteralConvertible, Reflectable {  
        case None  
        case Some(T)  
 
        //...
}
```

If you hit the Case of Some(T), you will get a "wrapped" value (a wrapped value). If you want to get the real value, you need to "unpack" it, otherwise you will get the Optional(value ).



#### <font size=5 color=#4169E1>4. Application of Optional type (unpacking)</font> 

<font size=4>**4.1 Optional binding**</font>  

In this case, if included, assign the value to a temporary constant or variable. Optional binding can be used in if and while statements to evaluate optional values and assign the value to a constant or variable.

Basic writing:

```Swift
if let constantName = someOptional {
    statements
}

```

Example:

```Swift
var myString:String?
myString = "Hello, Swift!"
if let yourString = myString {
    print("Your string value is - \(yourString)")
}else{
    print("Your string has no value")
}

```

<font size=4>**4.2 Force parsing**</font>  

Example:

```Swift
var myString:String?
myString = "Hello, world!"
if myString != nil {
    // force parsing
    print( myString! )
}else{
    print("myString value is nil")
}

```

If myString is nil at this time, a runtime error will occur in the above code.

 
#### <font size=5 color=#4169E1>5. Notes on Optional type</font> 

<font size=4>**5.1 Use! When performing forced unpacking, ensure that the variable value is non-nil**</font> 

```Swift
var str1:String? // The str1 value may be the value passed or the value obtained from the server
let msg = "Hi"
let txt = msg + str1! // runtime error
```
Therefore, it needs to be used with caution.

<font size=4>**5.2 ?? operator (null and operator)**</font>  

This is a common and very useful operator. When we unpack variables, we are often prompted to provide a default value.

```Swift
// Writing method one: Optional Binding (Optional Binding)
var username = ""
if let name = inputName {
     username = name
} else {
     username = "Guest"
}
//Writing method 2: ternary operator
let username = inputName != nil ? inputName! : "Guest"
```

The above code is equivalent to:

```Swift
let username = inputName ?? "Guest" 
```

a??b means: Optional type a is first judged as empty. If a contains a value, it is unblocked, otherwise the default value b is returned. Note: Expression a must be of Optional type, and the type of default value b needs to be consistent with the type of value stored in a.

Note: ?? sometimes may also represent multiple Optional, for example:

```Swift
var string: String? = "string"
var anotherString: String?? = string

```

We can clearly know that anotherString is Optinal<Optional<String>>


<font size=4>**5.3 Optional Chaining optional chain**</font>  

Swift official website has the following introduction:

> Optional chaining is a process for querying and calling properties, methods, and subscripts on an optional that might currently be nil. If the optional contains a value, the property, method, or subscript call succeeds; if the optional is nil, the property, method, or subscript call returns nil. Multiple queries can be chained together, and the entire chain fails gracefully if any link in the chain is nil.

Rough meaning:

Option chaining is the process of querying and calling properties, methods, and subscripts on an optional chain that may currently be zero. If the optional contains a value, the property, method, or subscript call succeeds; if the optional value is nil, the property, method, or subscript call returns nil. Multiple queries can be chained together, and if any link in the chain is zero, the entire chain fails gracefully.

Examples are as follows:

```Swift
class Person {
var residence: Residence?
}
class Residence {
     var numberOfRooms = 1
}
let john = Person()
//If written as forced unpacking, this code will cause an error when running.
let roomCount = john.residence!.numberOfRooms
//Correct writing
//john.residence = Residence()
if let roomCount = john.residence?.numberOfRooms {
     print("John's residence has \(roomCount) room(s).")
} else {
     print("Unable to retrieve the number of rooms.")
}

```

#### <font size=5 color=gray>*Reference*</font>
[1] https://leon0206.blog.csdn.net/article/details/120438470