<!DOCTYPE html>
<!-- saved from url=(0042)https://juejin.cn/post/7061891716931911687 -->
<html lang="zh" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22zh%22%7D%7D"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Swift Protocol 背后的故事(理论) - 掘金</title><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"><meta data-n-head="ssr" name="apple-itunes-app" content="app-id=987739104"><meta data-n-head="ssr" name="theme-color" content="#ffffff"><meta data-n-head="ssr" name="msapplication-TileColor" content="#da532c"><meta data-n-head="ssr" vmid="description" name="description" content="本文主要讨论 Swift Protocol 实现机制，涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理。"><meta data-n-head="ssr" vmid="keywords" name="keywords" content="Swift,iOS"><link data-n-head="ssr" rel="preconnect" href="https://unpkg.byted-static.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="https://lf3-cdn-tos.bytescm.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="https://mcs.snssdk.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="https://i.snssdk.com/" crossorigin="anonymous"><link data-n-head="ssr" rel="dns-prefetch" href="https://lf3-short.ibytedapm.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://lf3-cdn-tos.bytescm.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://api.juejin.cn/"><link data-n-head="ssr" rel="dns-prefetch" href="https://lf-cdn-tos.bytescm.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://unpkg.byted-static.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p1-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p3-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p6-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p9-juejin.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p1-jj.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p2-jj.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p6-jj.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://p9-jj.byteimg.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://mcs.snssdk.com/"><link data-n-head="ssr" rel="dns-prefetch" href="https://i.snssdk.com/"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/apple-touch-icon.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="32x32" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/favicon-32x32.png"><link data-n-head="ssr" rel="icon" type="image/png" sizes="16x16" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/favicon-16x16.png"><link data-n-head="ssr" rel="mask-icon" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/safari-pinned-tab.svg" color="#1E80FF"><link data-n-head="ssr" rel="manifest" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/favicons/site.webmanifest"><link data-n-head="ssr" rel="search" title="掘金" href="https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web//static/search.xml" type="application/opensearchdescription+xml"><link data-n-head="ssr" rel="stylesheet" href="./Swift Protocol 背后的故事(理论) - 掘金_files/bytedesign.min.css"><link data-n-head="ssr" rel="canonical" href="https://juejin.cn/post/7061891716931911687"><script data-n-head="ssr" type="text/javascript" src="./Swift Protocol 背后的故事(理论) - 掘金_files/acrawler.js"></script><script data-n-head="ssr" vmid="slardar" type="text/javascript" crossorigin="anonymous">;(function (w, d, u, b, n, pc, ga, ae, po, s, p, e, t, pp) {pc = 'precollect';ga = 'getAttribute';ae = 'addEventListener';po = 'PerformanceObserver';s = function (m) {p = [].slice.call(arguments);p.push(Date.now(), location.href);(m == pc ? s.p.a : s.q).push(p)};s.q = [];s.p = { a: [] };w[n] = s;e = document.createElement('script');e.src = u + '?bid=' + b + '&globalName=' + n;e.crossOrigin = u.indexOf('sdk-web') > 0 ? 'anonymous' : 'use-credentials';d.getElementsByTagName('head')[0].appendChild(e);if (ae in w) {s.pcErr = function (e) {e = e || w.event;t = e.target || e.srcElement;if (t instanceof Element || t instanceof HTMLElement) {if (t[ga]('integrity')) {w[n](pc, 'sri', t[ga]('href') || t[ga]('src'))} else {w[n](pc, 'st', { tagName: t.tagName, url: t[ga]('href') || t[ga]('src') })}} else {w[n](pc, 'err', e.error || e.message)}};s.pcRej = function (e) {e = e || w.event;w[n](pc, 'err', e.reason || (e.detail && e.detail.reason))};w[ae]('error', s.pcErr, true);w[ae]('unhandledrejection', s.pcRej, true);};if('PerformanceLongTaskTiming' in w) {pp = s.pp = { entries: [] };pp.observer = new PerformanceObserver(function (l) {pp.entries = pp.entries.concat(l.getEntries())});pp.observer.observe({ entryTypes: ['longtask', 'largest-contentful-paint','layout-shift'] })}})(window,document,'https://lf3-short.ibytedapm.com/slardar/fe/sdk-web/browser.cn.js','2608','SlardarWeb')</script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/browser.cn.js" crossorigin="anonymous"></script><script data-n-head="ssr" type="text/javascript" src="./Swift Protocol 背后的故事(理论) - 掘金_files/imageReport.js"></script><script data-n-head="ssr" type="application/ld+json">[{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://juejin.cn/post/7061891716931911687"},"headline":"Swift Protocol 背后的故事(理论)","description":"本文主要讨论 Swift Protocol 实现机制，涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理。","image":[],"author":{"@type":"Organization","name":"峰之巅"},"publisher":{"@type":"Organization","name":"掘金","logo":{"@type":"ImageObject","url":"//lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/e08da34488b114bd4c665ba2fa520a31.svg"}},"datePublished":"2022年02月07日","dateModified":"2022年06月30日"},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","name":"稀土掘金","position":1,"item":"https://juejin.cn"},{"@type":"ListItem","name":"iOS","position":2,"item":"https://juejin.cn/ios"},{"@type":"ListItem","name":"文章","position":3}]}]</script><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/6ccc1bf.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/83d184c.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/6a0af43.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/app.c95707c.css" as="style"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/6e787e2.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/default.c3d25dd.css" as="style"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/c68ae6a.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/52.39cb9d6.css" as="style"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/607e9aa.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/197.8de3951.css" as="style"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/fe8610f.js" as="script"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/198.adcadde.css" as="style"><link rel="preload" href="./Swift Protocol 背后的故事(理论) - 掘金_files/37aab1f.js" as="script"><link rel="stylesheet" href="./Swift Protocol 背后的故事(理论) - 掘金_files/app.c95707c.css"><link rel="stylesheet" href="./Swift Protocol 背后的故事(理论) - 掘金_files/default.c3d25dd.css"><link rel="stylesheet" href="./Swift Protocol 背后的故事(理论) - 掘金_files/52.39cb9d6.css"><link rel="stylesheet" href="./Swift Protocol 背后的故事(理论) - 掘金_files/197.8de3951.css"><link rel="stylesheet" href="./Swift Protocol 背后的故事(理论) - 掘金_files/198.adcadde.css">
  <script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/3f2c049.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/e5d3ec2.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/41b8609.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/4.4ebc7e8.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/929f319.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/139.9ccface.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/45c0ab1.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/181.1b801b1.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/37ac484.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/192.1dc0908.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/7745e43.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/452761f.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/158.cb7fed2.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/a217112.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/228a585.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/16a9736.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/7183dda.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/e0132cd.js"></script><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/fea69cf.js"></script><style type="text/css">.code-editor-container{display:block;position:relative;overflow:hidden;box-sizing:border-box;}iframe.code-editor-frame{width:100%;height:100%;border:none;border-radius:8px;box-sizing:border-box;border:0.5px solid rgba(128,128,128,0.4);}</style><style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/common-monitors.1.5.1.js" crossorigin="anonymous"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/100.b5554a0.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/c51d9f0.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/155.cc4a86e.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/385b17a.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/9.b3ecb8a.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/5a9f17f.js"></script><link rel="preload" as="style" href="./Swift Protocol 背后的故事(理论) - 掘金_files/88.9843b4c.css"><script charset="utf-8" src="./Swift Protocol 背后的故事(理论) - 掘金_files/9ba0270.js"></script></head>
  <body data-new-gr-c-s-check-loaded="14.1098.0" data-gr-ext-installed="">
    <div id="__nuxt"><div id="__layout"><div id="juejin"><!----> <div class="view-container" data-v-4b9f9746="" data-v-1c9ebbff=""><div class="main-header-box" data-v-4b9f9746=""><header data-fetch-key="0" class="main-header main-header visible" data-v-ec958a82="" data-v-4b9f9746="" visible="visible"><div class="container" data-v-ec958a82=""><a href="https://juejin.cn/" class="logo" data-v-ec958a82=""><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/e08da34488b114bd4c665ba2fa520a31.svg" alt="稀土掘金" class="logo-img" data-v-ec958a82=""> <img src="./Swift Protocol 背后的故事(理论) - 掘金_files/6c61ae65d1c41ae8221a670fa32d05aa.svg" alt="稀土掘金" class="mobile" data-v-ec958a82=""></a> <!----> <!----> <nav role="navigation" class="main-nav" data-v-ec958a82=""><ul class="nav-list" data-v-ec958a82=""><!----> <li class="main-nav-list" data-v-ec958a82=""><div class="phone-show-menu isResourceVisible" data-v-ec958a82=""><span data-v-ec958a82="">首页</span> <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="unfold16-icon" data-v-ec958a82=""><path d="M2.45025 4.82431C2.17422 4.49957 2.40501 4.00049 2.83122 4.00049H9.16878C9.59498 4.00049 9.82578 4.49957 9.54975 4.82431L6.38097 8.55229C6.1813 8.78719 5.8187 8.78719 5.61903 8.55229L2.45025 4.82431Z" data-v-ec958a82=""></path></svg></div> <ul class="phone-hide isResourceVisible" data-v-ec958a82=""><li class="nav-item link-item route-active" data-v-ec958a82=""><a href="https://juejin.cn/" data-v-ec958a82="">首页</a></li> <li class="nav-item link-item activities" data-v-ec958a82=""><a href="https://juejin.cn/pins" data-v-ec958a82=""><span class="text" data-v-ec958a82="">
                  沸点
                  </span></a></li> <li class="nav-item link-item book" data-v-ec958a82=""><a href="https://juejin.cn/course" data-v-ec958a82="">
                课程
                </a></li> <li class="nav-item link-item" data-v-ec958a82=""><a href="https://juejin.cn/live" data-v-ec958a82="">直播</a></li> <li class="nav-item link-item" data-v-ec958a82=""><a href="https://juejin.cn/events/all" data-v-ec958a82="">活动</a></li> <li class="nav-item link-item" data-v-ec958a82=""><a href="https://juejin.cn/challenge" data-v-ec958a82="">
                竞赛
                </a></li> <nav class="nav-item link-item" data-v-ec958a82=""><a href="https://detail.youzan.com/show/goods/newest?kdt_id=104340304" target="_blank" rel="nofollow noopener noreferrer" class="nav-item link-item no-border" data-v-ec958a82=""><span data-v-ec958a82="">商城</span></a> <!----></nav> <nav class="nav-item link-item download-icon isResourceVisible" data-v-ec958a82=""><a href="https://juejin.cn/app?utm_source=jj_nav" target="_blank" class="download-app no-border" data-v-ec958a82="">
                APP
              </a> <span data-v-ec958a82="" class="tablead">邀请有礼</span></nav> <nav class="nav-item link-item extension-icon" data-v-ec958a82=""><a href="https://juejin.cn/extension?utm_source=jj_nav" target="_blank" rel="nofollow noopener noreferrer" class="broswer-extension no-border isResourceVisible" data-v-ec958a82=""><span data-v-ec958a82="">插件</span></a></nav> <li tag="li" class="nav-item link-item" data-v-ec958a82=""><a target="_blank" href="https://juejin.cn/vip?utm_source=web_nav" class="activity no-hover special-activity" data-v-ec958a82=""><img data-v-248050e4="" data-v-ec958a82="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/7482b3ad2cd14edda31f05399c2ae759_tplv-k3u1fbpfcp-no-mark_288_288_288_0.awebp" alt="image" class="lazy" loading="lazy" style="max-width: 115px; vertical-align: middle;"></a></li></ul></li> <ul class="right-side-nav" data-v-ec958a82=""><li class="search-add" data-v-ec958a82=""><ul class="search-add-ul isResourceVisible" data-v-ec958a82=""><li class="nav-item search" data-v-ec958a82=""><form role="search" class="search-form isResourceVisible" data-v-ec958a82=""><input type="search" maxlength="32" placeholder="探索稀土掘金" value="" class="search-input isResourceVisible" data-v-ec958a82=""> <div class="seach-icon-container" data-v-ec958a82=""><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/1e8ab9a22f0ddc36349f60b38900d0bd.svg" alt="搜索" class="search-icon" data-v-ec958a82=""></div> <div class="typehead" style="display:none;" data-v-ec958a82=""><!----> <div class="title" data-v-ec958a82=""><span data-v-ec958a82="">搜索历史</span> <span class="clear" data-v-ec958a82="">
                        清空
                      </span></div> <div class="list" data-v-ec958a82=""><div data-v-ec958a82="">
                        Existential
                      </div><div data-v-ec958a82="">
                        ExistentialContainer
                      </div><div data-v-ec958a82="">
                        Protocol witness table
                      </div><div data-v-ec958a82="">
                        tableview卡顿优化
                      </div><div data-v-ec958a82="">
                        FastImageCache
                      </div><div data-v-ec958a82="">
                        iOS 图片的优化
                      </div></div></div></form></li> <li class="nav-item add creator-item" data-v-ec958a82=""><div class="add-group" data-v-0a54c80a="" data-v-ec958a82=""><svg data-v-0a54c80a="" width="38" height="20" viewBox="0 0 38 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="update-icon"><rect data-v-0a54c80a="" y="1" width="38" height="16" rx="8" fill="#F53F3F"></rect><path data-v-0a54c80a="" d="M7.5 7.93H11.47V9.02H7.5V7.93ZM11.47 9.65V10.71H7.5V9.65H11.47ZM11.47 11.34V12.48C11.47 12.72 11.34 12.84 11.08 12.84C10.75 12.84 10.39 12.82 10.01 12.8L10.19 13.46H11.31C11.87 13.44 12.15 13.19 12.15 12.7V7.3H7.51C7.75 6.93 7.96 6.54 8.16 6.14H13.43V5.44H8.46C8.6 5.09 8.72 4.73 8.84 4.36L8.11 4.27C7.99 4.66 7.84 5.05 7.67 5.44H4.69V6.14H7.34C6.65 7.43 5.68 8.57 4.42 9.57L4.89 10.18C5.61 9.6 6.26 8.95 6.82 8.25V13.48H7.5V11.34H11.47ZM14.72 4.73V5.4H18.64V6.27H15.58V10.23H18.51C18.41 10.75 18.23 11.18 17.99 11.52C17.43 11.23 16.91 10.89 16.44 10.5L15.89 10.88C16.38 11.3 16.92 11.67 17.5 11.99C16.86 12.45 15.84 12.73 14.45 12.84L14.76 13.5C16.35 13.32 17.5 12.94 18.2 12.34C19.69 13.02 21.44 13.41 23.45 13.49L23.63 12.8C21.71 12.74 20.05 12.41 18.65 11.82C18.93 11.42 19.12 10.89 19.24 10.23H22.46V6.27H19.36V5.4H23.29V4.73H14.72ZM21.75 9.6H19.33L19.36 8.89V8.54H21.75V9.6ZM18.61 9.6H16.29V8.54H18.64V8.89C18.64 9.13 18.63 9.37 18.61 9.6ZM16.29 7.94V6.89H18.64V7.94H16.29ZM19.36 6.89H21.75V7.94H19.36V6.89ZM32.94 4.43C31.97 4.85 30.88 5.08 29.67 5.1V9.38C29.62 10.9 29.3 12.09 28.71 12.95L29.22 13.49C29.94 12.47 30.32 11.1 30.37 9.38V8.19H31.85V13.53H32.56V8.19H33.6V7.5H30.37V5.68C31.45 5.62 32.42 5.41 33.3 5.07L32.94 4.43ZM24.61 5.2V5.86H29.12V5.2H27.23C27.09 4.84 26.95 4.51 26.8 4.21L26.06 4.33C26.23 4.59 26.38 4.88 26.52 5.2H24.61ZM24.51 7.47V8.12H26.53V9.24H24.67V9.9H26.53V12.56C26.53 12.8 26.4 12.92 26.14 12.92C26 12.92 25.85 12.9 25.69 12.87L25.84 13.54H26.38C26.96 13.54 27.25 13.27 27.25 12.73V9.9H29.01V9.24H27.25V8.12H29.18V7.47H28.05C28.24 7.13 28.41 6.74 28.57 6.31L27.92 6.09C27.77 6.57 27.6 7.03 27.4 7.47H26.3C26.14 6.93 25.96 6.48 25.77 6.11L25.13 6.34C25.33 6.69 25.51 7.07 25.66 7.47H24.51ZM25.37 10.44C25.15 11.32 24.81 12.12 24.34 12.84L24.94 13.22C25.4 12.47 25.77 11.59 26.03 10.58L25.37 10.44ZM28.24 10.37L27.64 10.53C27.92 11.13 28.15 11.75 28.34 12.38L28.94 12.15C28.78 11.61 28.54 11.02 28.24 10.37Z" fill="white"></path><path data-v-0a54c80a="" d="M18.8284 14L21.6568 16.8284L19.1112 19.374C18.955 19.5302 18.7017 19.5302 18.5455 19.374L15.9999 16.8284L18.8284 14Z" fill="#F53F3F"></path></svg> <button class="add-btn" data-v-0a54c80a="">
    创作者中心
  </button> <div class="more" data-v-0a54c80a=""><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="unfold12-icon" data-v-0a54c80a=""><path d="M2.45025 4.82383C2.17422 4.49908 2.40501 4 2.83122 4H9.16878C9.59499 4 9.82578 4.49908 9.54975 4.82382L6.38097 8.5518C6.1813 8.7867 5.8187 8.7867 5.61903 8.5518L2.45025 4.82383Z" fill="white" data-v-0a54c80a=""></path></svg></div> <ul class="more-list" data-v-0a54c80a=""><li class="item" data-v-0a54c80a=""><span class="icon write-article" data-v-0a54c80a="">写文章</span></li><li class="item" data-v-0a54c80a=""><span class="icon issue-points" data-v-0a54c80a="">发沸点</span></li><li class="item" data-v-0a54c80a=""><span class="icon write-note" data-v-0a54c80a="">写笔记</span></li><li class="item" data-v-0a54c80a=""><span class="icon create-jcode" data-v-0a54c80a="">写代码</span></li><li class="item" data-v-0a54c80a=""><span class="icon drafts" data-v-0a54c80a="">草稿箱</span></li></ul> <!----></div></li></ul></li> <!----> <li class="nav-item vip-entry" data-v-ec958a82=""><div class="vip-title" data-v-ec958a82=""><div class="vip-entry-img" data-v-ec958a82=""><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/24127194d5b158d7eaf8f09a256c5d01.svg" alt="vip" class="vip-img" data-v-ec958a82=""> </div> <div class="vip-words" data-v-ec958a82="">会员</div></div></li> <li class="nav-item notification" data-v-ec958a82=""><a class="app-link notification-a" data-v-ec958a82="" href="https://juejin.cn/notification"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="notification-icon" data-v-ec958a82=""><path d="M6.01132 10.2856C6.28115 6.54234 8.68619 4.28564 11.9999 4.28564C15.3136 4.28564 17.7186 6.54234 17.9885 10.2856C18.1219 12.1363 18.4093 13.708 19.9473 15.8848C20.1889 16.2267 19.953 16.7142 19.5343 16.7142H4.46546C4.04679 16.7142 3.81092 16.2267 4.05252 15.8848C5.59053 13.708 5.87793 12.1363 6.01132 10.2856Z" stroke-width="1.5" stroke-linecap="round" data-v-ec958a82=""></path><path d="M11.9573 3.21436V4.28578" stroke-width="3" stroke-linecap="round" data-v-ec958a82=""></path><path d="M9.57495 18.8569C9.92795 19.8557 10.8804 20.5712 12.0001 20.5712C13.1197 20.5712 14.0722 19.8557 14.4252 18.8569H9.57495Z" stroke-linecap="round" stroke-linejoin="round" data-v-ec958a82=""></path></svg> <!----></a> <ul class="menu-list notification-dropdown-menu" data-v-4e288a04="" data-v-ec958a82=""><li class="menu-item" data-v-4e288a04=""><a href="https://juejin.cn/notification" class="item-link" data-v-4e288a04=""><span class="item-name" data-v-4e288a04="">评论</span> <!----></a></li><li class="menu-item" data-v-4e288a04=""><a href="https://juejin.cn/notification/digg" class="item-link" data-v-4e288a04=""><span class="item-name" data-v-4e288a04="">点赞</span> <!----></a></li><li class="menu-item" data-v-4e288a04=""><a href="https://juejin.cn/notification/follow" class="item-link" data-v-4e288a04=""><span class="item-name" data-v-4e288a04="">关注</span> <!----></a></li><li class="menu-item" data-v-4e288a04=""><a href="https://juejin.cn/notification/im" class="item-link" data-v-4e288a04=""><span class="item-name" data-v-4e288a04="">私信</span> <!----></a></li><li class="menu-item" data-v-4e288a04=""><a href="https://juejin.cn/notification/system" class="item-link" data-v-4e288a04=""><span class="item-name" data-v-4e288a04="">系统消息</span> <!----></a></li></ul></li>  <li class="nav-item menu" data-v-ec958a82=""><div class="avatar-wrapper" data-v-ec958a82=""><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/3044413937_100x100.awebp" alt="Leon0206的头像" class="lazy avatar avatar immediate" data-v-248050e4="" data-v-0b45085c="" data-v-ec958a82="" loading="lazy"> <!----></div> <!----></li> <!----></ul></ul></nav></div> <!----></header></div>  <main class="container main-container" style="max-width:1140px;" data-v-4b9f9746=""><div class="view column-view" data-v-4b9f9746="" data-v-1c9ebbff=""><div class="main-area article-area" data-v-4b9f9746="" data-v-1c9ebbff=""><article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7061891716931911687" data-draft-id="7061859706158972965" data-original-type="0" class="article" data-v-1c9ebbff="" data-v-4b9f9746=""><!----> <meta itemprop="headline" content="Swift Protocol 背后的故事(理论)"> <meta itemprop="keywords" content="Swift,iOS"> <meta itemprop="datePublished" content="2022-02-07T09:07:03.000Z"> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="峰之巅"> <meta itemprop="url" content="https://juejin.cn/user/1556564198033991"></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"> <meta itemprop="width" content="180"> <meta itemprop="height" content="180"></div></div> <h1 class="article-title" data-v-1c9ebbff="">
            Swift Protocol 背后的故事(理论)
            <!----></h1> <div class="author-info-block" data-v-1c9ebbff=""><a href="https://juejin.cn/user/1556564198033991" target="_blank" rel="" class="avatar-link" data-v-1c9ebbff=""><img loading="eager" src="./Swift Protocol 背后的故事(理论) - 掘金_files/ca0dc6fa206bce240c1650e7da6ef516_100x100.awebp" alt="" class="lazy avatar avatar" data-v-248050e4="" data-v-0b45085c="" data-v-1c9ebbff=""></a> <div class="author-info-box" data-v-1c9ebbff=""><div class="author-name" data-v-1c9ebbff=""><a href="https://juejin.cn/user/1556564198033991" target="_blank" rel="" class="username username ellipsis" data-v-68a20f0a="" data-v-1c9ebbff=""><span class="name" style="max-width:128px;" data-v-68a20f0a="">
    峰之巅
  </span> <span blank="true" class="rank" data-v-3c1a13dc="" data-v-68a20f0a=""><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/05be64d75fee4dbdb290ba23afd21fcf_tplv-k3u1fbpfcp-no-mark_0_0_0_0.awebp" alt="lv-4" title="创作等级" class="lazy" style="aspect-ratio:NaN;" data-v-248050e4="" data-v-3c1a13dc="" loading="lazy"></span> <!----> <!----> </a> <!----></div> <div class="meta-box" data-v-1c9ebbff=""><time datetime="2022-02-07T09:07:03.000Z" title="Mon Feb 07 2022 17:07:03 GMT+0800 (China Standard Time)" class="time" data-v-1c9ebbff="">
                    2022年02月07日 17:07
                  </time> <span class="views-count" data-v-1c9ebbff="">
                    ·&nbsp;&nbsp;阅读 6440
                  </span> <!----></div></div> <button class="follow-button follow followed" data-v-0ed911bc="" data-v-1c9ebbff=""><span class="icon icon-followed" data-v-0ed911bc=""></span> <span class="text" data-v-0ed911bc="">已关注</span></button></div> <!----> <!----> <!----> <!----> <div itemprop="articleBody" class="article-content" data-v-1c9ebbff=""><div class="markdown-body cache"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本系列文章将从实践技巧、实现原理以及追踪语言更新等方面对 Swift Protocol 展开深入讨论。主要内容有：</p>
<ul>
<li>
<p><a href="https://juejin.cn/post/7061874172560949279" target="_blank" title="https://juejin.cn/post/7061874172560949279">Swift Protocol 背后的故事(实践)</a></p>
</li>
<li>
<p>Swift Protocol 背后的故事(理论)</p>
</li>
<li>
<p><a href="https://juejin.cn/post/7115050654170628127/" target="_blank" title="https://juejin.cn/post/7115050654170628127/">Swift Protocol 背后的故事(Swift 5.6/5.7)</a></p>
</li>
<li>
<p>...</p>
</li>
</ul>
<p>本文是系列文章第二篇，主要讨论 Swift Protocol 实现机制。</p>
<p>内容涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理以及泛型特化等。</p>

<p>本文同时发表于我的<a href="https://link.juejin.cn/?target=https%3A%2F%2Fzxfcumtcs.github.io%2F2022%2F02%2F04%2FSwiftProtocol2%2F" target="_blank" title="https://zxfcumtcs.github.io/2022/02/04/SwiftProtocol2/" ref="nofollow noopener noreferrer">个人博客</a></p>
<h1 data-id="heading-0">Type Metadata</h1>
<hr>
<p>在 Objective-C 中，通过 MetaClass 模型来表达类的元信息，并通过实例的 <code>isa</code> 指针来引用 MetaClass。这是整个 Objective-C runtime 的核心机制。</p>
<p>那在 Swift 中类型信息 (Type Metadata) 是如何表达的呢？</p>
<p>Swift runtime 为每种类型 (Class、Struct、Enum、Protocol、Tuple、Function 等等) 生成了一份元信息记录 (Metadata Record)，几个关键点：</p>
<ul>
<li>
<p>对于常规类型 (nominal types，如：类、结构体、枚举)，其对应的 Metadata Record 在编译期由编译器静态生成；</p>
</li>
<li>
<p>对于内在类型 (intrinsic types) 以及泛型实例，对应的 Metadata Record 则在运行时动态生成，如：元组、函数、协议等；</p>
</li>
<li>
<p>每个类型的 Metadata Record 都是唯一的，相同类型的 Metadata Record 是同一个</p>
</li>
</ul>
<p>不同类型的 Metadata 所包含的信息也不一样 (Metadata Layout)，但它们有一个共同的头部，其包含：</p>
<ul>
<li>
<p>VWT (Value Witness Table) Poniter — 指向 VWT (虚函数表) 的指针，在 VWT 中包含了该类型的实例如何分配内存 (allocating)、copy (copying)、销毁 (destroying) 等基础操作 (函数指针)；</p>
<blockquote>
<p>在 VWT 中除了包含上述函数指针外，还有该类型实例的 size、alignment、stride 等基础信息。</p>
</blockquote>
</li>
<li>
<p>Kind — 标记 Metadata 的类型，如：0 -- Class，1 -- Struct，2 -- Enum，12 -- Protocol 等等。</p>
</li>
</ul>
<p><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/1f930ea0470244f581af6b5812772271_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp" alt="MetadataType.png" loading="lazy" class="medium-zoom-image"></p>
<p>与本文讨论相关的是 VWT，关于 Metadata 的更多信息请参考：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeMetadata.rst%23protocol-metadata" target="_blank" title="https://github.com/apple/swift/blob/main/docs/ABI/TypeMetadata.rst#protocol-metadata" ref="nofollow noopener noreferrer">swift/TypeMetadata.rst at main · apple/swift · GitHub</a>。</p>
<h1 data-id="heading-1">Inside Protocol</h1>
<hr>
<h2 data-id="heading-2">Existential Container</h2>
<p>Class、Struct 以及 Enum 对应的实例都有确定的『模型』用于指导其内存布局。</p>
<blockquote>
<p>『模型』就是 Class、Struct 以及 Enum 本身的定义，它们包含的成员。</p>
</blockquote>
<p>而 Protocol 并没有确定的『模型』，因为其背后的真实类型可能千奇百怪，那么 Protocol 类型的变量按什么进行内存布局？</p>
<p>Swift 用了一种称之为 <strong>Existential Container</strong> 的模型来指导 Protocol 变量布局内存。</p>
<p>Existential Container 又分为两类：</p>
<ul>
<li>
<p><em>Opaque Existential Container</em> — 用于没有<strong>类</strong>约束的 Protocol (no class constraint on protocol)，也就是说这种协议背后的真实类型可能是类、结构体以及枚举等。因此其存储就非常复杂。</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">OpaqueExistentialContainer</span> {
  void <span class="hljs-operator">*</span>fixedSizeBuffer[<span class="hljs-number">3</span>];
  <span class="hljs-type">Metadata</span> <span class="hljs-operator">*</span>type;
  <span class="hljs-type">WitnessTable</span> <span class="hljs-operator">*</span>witnessTables[<span class="hljs-type">NUM_WITNESS_TABLES</span>];
};
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如上，<code>OpaqueExistentialContainer</code> 包含3个成员：</p>
<ul>
<li>
<p><code>fixedSizeBuffer</code> — 3 个指针大小的 buffer 空间，当真实类型的 size (内存对齐后的大小) 小于 3 个字时则其内容直接存储在 fixedSizeBuffer 中，否则在 heap 上另辟空间存储，并将指针存储在 fixedSizeBuffer 中；</p>
</li>
<li>
<p><code>type</code> — 指向真实类型的 Metadata，最重要的就是引用其中的 VWT 用于完成内存的各种操作；</p>
</li>
<li>
<p><code>witnessTables</code> — 指向协议函数表 (Protocol Witness Table, PWT)，协议函数表中存储的是真实类型中对应函数的地址。</p>
</li>
</ul>
</li>
<li>
<p><em>Class Existential Container</em> — 用于有<strong>类</strong>约束的 Protocol，该协议背后真实的类型只能是类，而类的实例都是在 Heap 上分配内存的。</p>
<p>因此，在 Existential Container 中只需要一个指向堆内存的指针即可。</p>
<p>同时，由于类的实例含有指向其 Metadata 的指针，故在 Existential Container 中也就没必要再存一份 Metadata 的指针了：</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ClassExistentialContainer</span> {
  <span class="hljs-type">HeapObject</span> <span class="hljs-operator">*</span>value;
  <span class="hljs-type">WitnessTable</span> <span class="hljs-operator">*</span>witnessTables[<span class="hljs-type">NUM_WITNESS_TABLES</span>];
};
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如上，<code>ClassExistentialContainer</code> 只包含2个成员：</p>
<ul>
<li>
<p><code>value</code> — 指向堆内存的指针；</p>
</li>
<li>
<p><code>witnessTables</code> — PWT 指针。</p>
</li>
</ul>
</li>
</ul>
<p>下面我们来看一个例子：</p>
<p><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/4fdfe9986ded46ef8e34a9237f785310_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp" alt="ExistentialContainer.png" loading="lazy" class="medium-zoom-image"></p>
<p>如图，由于  <code>protocol Drawable</code> 没有 class constraint，故其对应的 Existential Container 是 <code>OpaqueExistentialContainer</code>：</p>
<ul>
<li>
<p>由于 <code>Point</code> 实例占用 2 个字的内存空间 (小于 3)，故对于 <code>Drawable</code> 协议类型的变量 <code>point</code> 直接使用 <code>OpaqueExistentialContainer#buffer</code> 来存储其内容(<code>x</code>、<code>y</code>)；</p>
</li>
<li>
<p>而 <code>Line</code> 的实例要占用 4 个字的内存空间，故 <code>line</code> 需要在 heap 上分配内存用于存储其内容(<code>x0</code>、<code>y0</code>、<code>x1</code>、<code>y1</code>)；</p>
</li>
<li>
<p>Existential Container 中的 <code>type</code> 分别指向了其背后真实类型的 Metadata；</p>
</li>
<li>
<p>PWT 中的函数指针则指向真实类型中的函数。</p>
</li>
</ul>
<p>对应编译器生成的(伪)代码如下：</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-keyword">let</span> point: <span class="hljs-type">Drawable</span> <span class="hljs-operator">=</span> <span class="hljs-type">Point</span>(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>)
point.draw()

<span class="hljs-comment">// 编译器生成的(伪)代码</span>
<span class="hljs-keyword">let</span> _point: <span class="hljs-type">Point</span> <span class="hljs-operator">=</span> <span class="hljs-type">Point</span>(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>)
<span class="hljs-keyword">var</span> point: <span class="hljs-type">OpaqueExistentialContainer</span> <span class="hljs-operator">=</span> <span class="hljs-type">OpaqueExistentialContainer</span>()
<span class="hljs-keyword">let</span> metadata <span class="hljs-operator">=</span> _point.type
<span class="hljs-keyword">let</span> vwt <span class="hljs-operator">=</span> metadata.vwt
vwt.copy(<span class="hljs-operator">&amp;</span>(point.fixedSizeBuffer), _point)
point.type <span class="hljs-operator">=</span> metadata
point.witnessTables <span class="hljs-operator">=</span> <span class="hljs-type">PWT</span>(<span class="hljs-type">Point</span>.draw)
point.pwt.draw()
vwt.dealloc(point)
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-keyword">let</span> line: <span class="hljs-type">Drawable</span> <span class="hljs-operator">=</span> <span class="hljs-type">Line</span>(x0: <span class="hljs-number">0</span>, y0: <span class="hljs-number">0</span>, x1: <span class="hljs-number">1</span>, y1: <span class="hljs-number">1</span>)
line.draw()

<span class="hljs-comment">// 编译器生成的(伪)代码</span>
<span class="hljs-keyword">let</span> _line: <span class="hljs-type">Line</span> <span class="hljs-operator">=</span> <span class="hljs-type">Line</span>(x0: <span class="hljs-number">0</span>, y0: <span class="hljs-number">0</span>, x1: <span class="hljs-number">1</span>, y1: <span class="hljs-number">1</span>)
<span class="hljs-keyword">var</span> line：<span class="hljs-type">OpaqueExistentialContainer</span> <span class="hljs-operator">=</span> <span class="hljs-type">OpaqueExistentialContainer</span>()
<span class="hljs-keyword">let</span> metadata <span class="hljs-operator">=</span> _line.type
<span class="hljs-keyword">let</span> vwt <span class="hljs-operator">=</span> metadata.vwt
line.fixedSizeBuffer[<span class="hljs-number">0</span>] <span class="hljs-operator">=</span> vwt.allocate()
vwt.copy(line.fixedSizeBuffer, _line)
line.type <span class="hljs-operator">=</span> metadata
line.witnessTables <span class="hljs-operator">=</span> <span class="hljs-type">PWT</span>(<span class="hljs-type">Line</span>.draw)
line.pwt.draw()
vwt.dealloc(line)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>关于更多 Type Layout 的信息请参考: <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeLayout.rst" target="_blank" title="https://github.com/apple/swift/blob/main/docs/ABI/TypeLayout.rst" ref="nofollow noopener noreferrer">swift/TypeLayout.rst at main · apple/swift · GitHub</a></p>
<p>从上面的伪代码可以看到对于协议类型的变量，编译器在背后做了大量的工作。也有一定的性能损耗。</p>
<h2 data-id="heading-3">Protocol Type Stored Properties</h2>
<p>从上一小节可知，协议类型的变量其实质类型是 Existential Container (<code>OpaqueExistentialContainer</code> / <code>ClassExistentialContainer</code>)。</p>
<p>因此，当协议类型变量作为存储属性时，其在寄主实例中的内存占用就是一个 Existential Container 实例 (下图来自: <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2016%2F416%2F" target="_blank" title="https://developer.apple.com/videos/play/wwdc2016/416/" ref="nofollow noopener noreferrer">Understanding Swift Performance · WWDC2016</a>)：</p>
<p><img src="./Swift Protocol 背后的故事(理论) - 掘金_files/9d7481161e844b98a945ca280c9cfc12_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.awebp" alt="ProtocolTypeStoredProperties.png" loading="lazy" class="medium-zoom-image"></p>
<h2 data-id="heading-4">小结</h2>
<p>Protocol 不同于一般类型 (Class、Struct、Enum)，具有以下特点：</p>
<ul>
<li>
<p>使用 Existential Container (<code>OpaqueExistentialContainer</code> / <code>ClassExistentialContainer</code>) 作为内存模型；</p>
</li>
<li>
<p>内存占用 &lt;= 3 的实例，直接存储在 Existential Container buffer 中，否则在 heap 上另行分配内存，并将指针存储在 Existential Container buffer[0] 中；</p>
</li>
<li>
<p>内存管理 (allocating、copying、destroying) 相关的方法保存在 VWT 中；</p>
</li>
<li>
<p>通过 PWT 实现方法动态派发 (Dynamic dispatch)。</p>
</li>
</ul>
<h1 data-id="heading-5">Generics</h1>
<hr>
<p>泛型作为提升代码灵活性、可复用性的重要手段被大多数语言所支持，如：Swift、Java、C++ (模板)。</p>
<p>Swift 结合 Protocol 赋以泛型更多的灵活性。</p>
<p>下面我们简单探讨一下泛型在 Swift 中是如何实现的。</p>
<p>Swift 中泛型可以添加类型约束 (Type Constraints)，约束可以是类，也可以是协议。</p>
<p>因此，Swift 泛型根据类型约束可以分为 3 类：</p>
<ul>
<li>
<p>No Constraints</p>
</li>
<li>
<p>Class Constraints</p>
</li>
<li>
<p>Protocol Constraints</p>
</li>
</ul>
<p>下面，分别对这 3 类情况进行简要分析。</p>
<blockquote>
<p>通过 SIL (<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FSIL.rst" target="_blank" title="https://github.com/apple/swift/blob/main/docs/SIL.rst" ref="nofollow noopener noreferrer">swift/SIL.rst at main · apple/swift · GitHub</a>) 可以大致了解 Swift 背后的实现原理。</p>
<p><code>swiftc demo.swift -O -emit-sil -o demo-sil.s</code></p>
<p>如上，通过 swiftc 命令可以生成 SIL。</p>
<p>其中的 <code>-O</code> 是对生成的 SIL 代码进行编译优化，使 SIL 更简洁高效。</p>
<p>后面要讲到的泛型特化 (Specialization of Generics) 也只有在 <code>-O</code> 优化下会发生。</p>
</blockquote>
<h2 data-id="heading-6">No Constraints</h2>
<p>其实，这类泛型能执行的操作非常少。无法在 heap 上实例化 (创建) 对象，也不能执行任何方法。</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-meta">@inline</span>(never)  <span class="hljs-comment">// 禁止编译器做 inline 优化</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">swapTwoValues</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">a</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>) {
    <span class="hljs-keyword">let</span> temp <span class="hljs-operator">=</span> a
    a <span class="hljs-operator">=</span> b
    b <span class="hljs-operator">=</span> temp
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如上，<code>swapTwoValues</code> 用于交换 2 个变量的值，其泛型参数 <code>T</code> 没有任何约束。</p>
<p>其对应的 SIL 如下，关键点：</p>
<ul>
<li>
<p>第<code>8</code>行，通过 <code>alloc_stack</code> 在栈上为类型 <code>T</code> 分配内存 (<code>temp</code>);</p>
</li>
<li>
<p>第<code>9</code>行，通过 <code>copy_addr</code> 进行内存级拷贝 (不会执行任何 <code>init</code> 方法)；</p>
</li>
<li>
<p>第<code>12</code>行，通过 <code>dealloc_stack</code> 销毁上述开辟的内存；</p>
</li>
<li>
<p>其他就是做一些内存拷贝的操作。</p>
</li>
</ul>
<blockquote>
<p>需要注意的是，对于引用类型，<code>$T</code>是指针，即在栈上开辟的是存储指针的内存，而非引用类型本身。</p>
</blockquote>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-number">1</span>   <span class="hljs-comment">// swapTwoValues&lt;A&gt;(_:_:)</span>
<span class="hljs-number">2</span>   sil hidden [noinline] @<span class="hljs-variable">$s4main13swapTwoValuesyyxz_xztlF</span> : $<span class="hljs-meta">@convention</span>(thin) <span class="hljs-operator">&lt;</span><span class="hljs-type">T</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@inout</span> <span class="hljs-type">T</span>, <span class="hljs-meta">@inout</span> <span class="hljs-type">T</span>) -&gt; () {
<span class="hljs-number">3</span>   <span class="hljs-comment">// %0 "a"                                         // users: %5, %6, %2</span>
<span class="hljs-number">4</span>   <span class="hljs-comment">// %1 "b"                                         // users: %7, %6, %3</span>
<span class="hljs-number">5</span>   bb0(<span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>):
<span class="hljs-number">6</span>    debug_value_addr <span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-keyword">var</span>, name <span class="hljs-string">"a"</span>, argno <span class="hljs-number">1</span> <span class="hljs-comment">// id: %2</span>
<span class="hljs-number">7</span>    debug_value_addr <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-keyword">var</span>, name <span class="hljs-string">"b"</span>, argno <span class="hljs-number">2</span> <span class="hljs-comment">// id: %3</span>
<span class="hljs-number">8</span>    <span class="hljs-operator">%</span><span class="hljs-number">4</span> <span class="hljs-operator">=</span> alloc_stack <span class="hljs-variable">$T</span>, <span class="hljs-keyword">let</span>, name <span class="hljs-string">"temp"</span>           <span class="hljs-comment">// users: %8, %7, %5</span>
<span class="hljs-number">9</span>    copy_addr <span class="hljs-operator">%</span><span class="hljs-number">0</span> to [initialization] <span class="hljs-operator">%</span><span class="hljs-number">4</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>       <span class="hljs-comment">// id: %5</span>
<span class="hljs-number">10</span>   copy_addr [take] <span class="hljs-operator">%</span><span class="hljs-number">1</span> to <span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>                 <span class="hljs-comment">// id: %6</span>
<span class="hljs-number">11</span>   copy_addr [take] <span class="hljs-operator">%</span><span class="hljs-number">4</span> to [initialization] <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span> <span class="hljs-comment">// id: %7</span>
<span class="hljs-number">12</span>   dealloc_stack <span class="hljs-operator">%</span><span class="hljs-number">4</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>                          <span class="hljs-comment">// id: %8</span>
<span class="hljs-number">13</span>   <span class="hljs-operator">%</span><span class="hljs-number">9</span> <span class="hljs-operator">=</span> tuple ()                                   <span class="hljs-comment">// user: %10</span>
<span class="hljs-number">14</span>   <span class="hljs-keyword">return</span> <span class="hljs-operator">%</span><span class="hljs-number">9</span> : $()                                 <span class="hljs-comment">// id: %10</span>
<span class="hljs-number">15</span> } <span class="hljs-comment">// end sil function '$s4main13swapTwoValuesyyxz_xztlF'</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-7">Class Constraints</h2>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
  <span class="hljs-keyword">required</span>
  <span class="hljs-keyword">init</span>() {}

  <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Triangle</span>: <span class="hljs-title class_">Shape</span> {
  <span class="hljs-keyword">required</span>
  <span class="hljs-keyword">init</span>() {}

  <span class="hljs-keyword">override</span>
  <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
}

<span class="hljs-meta">@inline</span>(never)
<span class="hljs-keyword">func</span> <span class="hljs-title function_">drawShape</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Shape</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">s</span>: <span class="hljs-type">T</span>) {
  <span class="hljs-keyword">let</span> s0 <span class="hljs-operator">=</span> <span class="hljs-type">T</span>()
  s0.draw()
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如例：</p>
<ul>
<li>
<p>将泛型类型 upcast 到约束类型 (第 <code>5~6</code>行)；</p>
</li>
<li>
<p>通过 <code>class_method</code> 指令找到要执行的方法 (<code>init</code>、<code>draw</code> 方法 [第 <code>7~10</code> 行]，在 vtable 中找)；</p>
</li>
<li>
<p>可以在 Heap 上创建泛型类型的实例 (第 <code>8</code> 行)；</p>
</li>
<li>
<p>其实质就是通过虚函数表实现的多态。</p>
</li>
</ul>
<p>总之，由于有基础类作为类型约束，通过虚函数表就可以执行所有基础类公开的方法。</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-number">1</span>  <span class="hljs-comment">// drawShape&lt;A&gt;(_:)</span>
<span class="hljs-number">2</span>  sil hidden [noinline] @<span class="hljs-variable">$s4main9drawShapeyyxAA0C0CRbzlF</span> : $<span class="hljs-meta">@convention</span>(thin) <span class="hljs-operator">&lt;</span><span class="hljs-type">T</span> <span class="hljs-keyword">where</span> <span class="hljs-type">T</span> : <span class="hljs-type">Shape</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@guaranteed</span> <span class="hljs-type">T</span>) -&gt; () {
<span class="hljs-number">3</span>  <span class="hljs-comment">// %0 "s"</span>
<span class="hljs-number">4</span>  bb0(<span class="hljs-operator">%</span><span class="hljs-number">0</span> : <span class="hljs-variable">$T</span>):
<span class="hljs-number">5</span>    <span class="hljs-operator">%</span><span class="hljs-number">1</span> <span class="hljs-operator">=</span> metatype $<span class="hljs-meta">@thick</span> <span class="hljs-type">T</span>.<span class="hljs-keyword">Type</span>                    <span class="hljs-comment">// user: %2</span>
<span class="hljs-number">6</span>    <span class="hljs-operator">%</span><span class="hljs-number">2</span> <span class="hljs-operator">=</span> upcast <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-meta">@thick</span> <span class="hljs-type">T</span>.<span class="hljs-keyword">Type</span> to $<span class="hljs-meta">@thick</span> <span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span> <span class="hljs-comment">// users: %4, %3</span>
<span class="hljs-number">7</span>    <span class="hljs-operator">%</span><span class="hljs-number">3</span> <span class="hljs-operator">=</span> class_method <span class="hljs-operator">%</span><span class="hljs-number">2</span> : $<span class="hljs-meta">@thick</span> <span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span>, #<span class="hljs-type">Shape</span>.<span class="hljs-keyword">init</span><span class="hljs-operator">!</span>allocator : (<span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span>) -&gt; () -&gt; <span class="hljs-type">Shape</span>, $<span class="hljs-meta">@convention</span>(method) (<span class="hljs-meta">@thick</span> <span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-meta">@owned</span> <span class="hljs-type">Shape</span> <span class="hljs-comment">// user: %4</span>
<span class="hljs-number">8</span>    <span class="hljs-operator">%</span><span class="hljs-number">4</span> <span class="hljs-operator">=</span> apply <span class="hljs-operator">%</span><span class="hljs-number">3</span>(<span class="hljs-operator">%</span><span class="hljs-number">2</span>) : $<span class="hljs-meta">@convention</span>(method) (<span class="hljs-meta">@thick</span> <span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-meta">@owned</span> <span class="hljs-type">Shape</span> <span class="hljs-comment">// users: %7, %5, %6</span>
<span class="hljs-number">9</span>    <span class="hljs-operator">%</span><span class="hljs-number">5</span> <span class="hljs-operator">=</span> class_method <span class="hljs-operator">%</span><span class="hljs-number">4</span> : <span class="hljs-variable">$Shape</span>, #<span class="hljs-type">Shape</span>.draw : (<span class="hljs-type">Shape</span>) -&gt; () -&gt; <span class="hljs-type">Bool</span>, $<span class="hljs-meta">@convention</span>(method) (<span class="hljs-meta">@guaranteed</span> <span class="hljs-type">Shape</span>) -&gt; <span class="hljs-type">Bool</span> <span class="hljs-comment">// user: %6</span>
<span class="hljs-number">10</span>   <span class="hljs-operator">%</span><span class="hljs-number">6</span> <span class="hljs-operator">=</span> apply <span class="hljs-operator">%</span><span class="hljs-number">5</span>(<span class="hljs-operator">%</span><span class="hljs-number">4</span>) : $<span class="hljs-meta">@convention</span>(method) (<span class="hljs-meta">@guaranteed</span> <span class="hljs-type">Shape</span>) -&gt; <span class="hljs-type">Bool</span>
<span class="hljs-number">11</span>   strong_release <span class="hljs-operator">%</span><span class="hljs-number">4</span> : <span class="hljs-variable">$Shape</span>                      <span class="hljs-comment">// id: %7</span>
<span class="hljs-number">12</span>   <span class="hljs-operator">%</span><span class="hljs-number">8</span> <span class="hljs-operator">=</span> tuple ()                                   <span class="hljs-comment">// user: %9</span>
<span class="hljs-number">13</span>   <span class="hljs-keyword">return</span> <span class="hljs-operator">%</span><span class="hljs-number">8</span> : $()                                 <span class="hljs-comment">// id: %9</span>
<span class="hljs-number">14</span> } <span class="hljs-comment">// end sil function '$s4main9drawShapeyyxAA0C0CRbzlF'</span>
<span class="hljs-number">15</span>
<span class="hljs-number">16</span> sil_vtable <span class="hljs-type">Shape</span> {
<span class="hljs-number">17</span>   #<span class="hljs-type">Shape</span>.<span class="hljs-keyword">init</span><span class="hljs-operator">!</span>allocator: (<span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span>) -&gt; () -&gt; <span class="hljs-type">Shape</span> : @<span class="hljs-variable">$s4main5ShapeCACycfC</span>    <span class="hljs-comment">// Shape.__allocating_init()</span>
<span class="hljs-number">18</span>   #<span class="hljs-type">Shape</span>.draw: (<span class="hljs-type">Shape</span>) -&gt; () -&gt; <span class="hljs-type">Bool</span> : @<span class="hljs-variable">$s4main5ShapeC4drawSbyF</span>    <span class="hljs-comment">// Shape.draw()</span>
<span class="hljs-number">19</span>   #<span class="hljs-type">Shape</span>.deinit<span class="hljs-operator">!</span>deallocator: @<span class="hljs-variable">$s4main5ShapeCfD</span>    <span class="hljs-comment">// Shape.__deallocating_deinit</span>
<span class="hljs-number">20</span> }
<span class="hljs-number">21</span>
<span class="hljs-number">22</span> sil_vtable <span class="hljs-type">Triangle</span> {
<span class="hljs-number">23</span>   #<span class="hljs-type">Shape</span>.<span class="hljs-keyword">init</span><span class="hljs-operator">!</span>allocator: (<span class="hljs-type">Shape</span>.<span class="hljs-keyword">Type</span>) -&gt; () -&gt; <span class="hljs-type">Shape</span> : @<span class="hljs-variable">$s4main8TriangleCACycfC</span> [<span class="hljs-keyword">override</span>]    <span class="hljs-comment">// Triangle.__allocating_init()</span>
<span class="hljs-number">24</span>   #<span class="hljs-type">Shape</span>.draw: (<span class="hljs-type">Shape</span>) -&gt; () -&gt; <span class="hljs-type">Bool</span> : @<span class="hljs-variable">$s4main8TriangleC4drawSbyF</span> [<span class="hljs-keyword">override</span>]    <span class="hljs-comment">// Triangle.draw()</span>
<span class="hljs-number">25</span>   #<span class="hljs-type">Triangle</span>.deinit<span class="hljs-operator">!</span>deallocator: @<span class="hljs-variable">$s4main8TriangleCfD</span>    <span class="hljs-comment">// Triangle.__deallocating_deinit</span>
<span class="hljs-number">26</span> }
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-8">Protocol Constraints</h2>
<blockquote>
<p>这里讨论的 Protocol 是没有 class constraint 的，对于只能由类实现的协议作为泛型约束时，其效果同上节讨论的 Class Constraints。</p>
</blockquote>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-meta">@inline</span>(never)
<span class="hljs-keyword">func</span> <span class="hljs-title function_">equal</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Equatable</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">a</span>: <span class="hljs-type">T</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Bool</span> {
  <span class="hljs-keyword">let</span> a0 <span class="hljs-operator">=</span> a
  <span class="hljs-keyword">let</span> b0 <span class="hljs-operator">=</span> b
  <span class="hljs-keyword">return</span> a0 <span class="hljs-operator">==</span> b
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>从下列 SIL 可以看到：</p>
<ul>
<li>
<p>通过 <code>alloc_stack</code> 可以为泛型类型在 Stack 上分配内存 (无论泛型类型是值类型还是引用类型)；</p>
</li>
<li>
<p>同样通过 <code>copy_addr</code> 执行内存拷贝；</p>
</li>
<li>
<p>通过 <code>witness_method</code> 指令在泛型类型上查找 Protocol 指定的方法 (查 PWT 表)。</p>
</li>
</ul>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-comment">// equal&lt;A&gt;(_:_:)</span>
sil hidden [noinline] @<span class="hljs-variable">$s4main5equalySbx_xtSQRzlF</span> : $<span class="hljs-meta">@convention</span>(thin) <span class="hljs-operator">&lt;</span><span class="hljs-type">T</span> <span class="hljs-keyword">where</span> <span class="hljs-type">T</span> : <span class="hljs-type">Equatable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@in_guaranteed</span> <span class="hljs-type">T</span>, <span class="hljs-meta">@in_guaranteed</span> <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Bool</span> {
<span class="hljs-comment">// %0 "a"                                         // users: %5, %2</span>
<span class="hljs-comment">// %1 "b"                                         // users: %8, %3</span>
bb0(<span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>):
  debug_value_addr <span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-keyword">let</span>, name <span class="hljs-string">"a"</span>, argno <span class="hljs-number">1</span> <span class="hljs-comment">// id: %2</span>
  debug_value_addr <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-keyword">let</span>, name <span class="hljs-string">"b"</span>, argno <span class="hljs-number">2</span> <span class="hljs-comment">// id: %3</span>
  <span class="hljs-operator">%</span><span class="hljs-number">4</span> <span class="hljs-operator">=</span> alloc_stack <span class="hljs-variable">$T</span>, <span class="hljs-keyword">let</span>, name <span class="hljs-string">"a0"</span>             <span class="hljs-comment">// users: %9, %10, %8, %5</span>
  copy_addr <span class="hljs-operator">%</span><span class="hljs-number">0</span> to [initialization] <span class="hljs-operator">%</span><span class="hljs-number">4</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>       <span class="hljs-comment">// id: %5</span>
  <span class="hljs-operator">%</span><span class="hljs-number">6</span> <span class="hljs-operator">=</span> metatype $<span class="hljs-meta">@thick</span> <span class="hljs-type">T</span>.<span class="hljs-keyword">Type</span>                    <span class="hljs-comment">// user: %8</span>
  <span class="hljs-operator">%</span><span class="hljs-number">7</span> <span class="hljs-operator">=</span> witness_method <span class="hljs-variable">$T</span>, #<span class="hljs-type">Equatable</span>.<span class="hljs-string">"=="</span> : <span class="hljs-operator">&lt;</span><span class="hljs-keyword">Self</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span> : <span class="hljs-type">Equatable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">Self</span>.<span class="hljs-keyword">Type</span>) -&gt; (<span class="hljs-keyword">Self</span>, <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-type">Bool</span> : $<span class="hljs-meta">@convention</span>(witness_method: <span class="hljs-type">Equatable</span>) <span class="hljs-operator">&lt;</span>τ_0_0 <span class="hljs-keyword">where</span> τ_0_0 : <span class="hljs-type">Equatable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@in_guaranteed</span> τ_0_0, <span class="hljs-meta">@in_guaranteed</span> τ_0_0, <span class="hljs-meta">@thick</span> τ_0_0.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-type">Bool</span> <span class="hljs-comment">// user: %8</span>
  <span class="hljs-operator">%</span><span class="hljs-number">8</span> <span class="hljs-operator">=</span> apply <span class="hljs-operator">%</span><span class="hljs-number">7</span><span class="hljs-operator">&lt;</span><span class="hljs-type">T</span><span class="hljs-operator">&gt;</span>(<span class="hljs-operator">%</span><span class="hljs-number">4</span>, <span class="hljs-operator">%</span><span class="hljs-number">1</span>, <span class="hljs-operator">%</span><span class="hljs-number">6</span>) : $<span class="hljs-meta">@convention</span>(witness_method: <span class="hljs-type">Equatable</span>) <span class="hljs-operator">&lt;</span>τ_0_0 <span class="hljs-keyword">where</span> τ_0_0 : <span class="hljs-type">Equatable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@in_guaranteed</span> τ_0_0, <span class="hljs-meta">@in_guaranteed</span> τ_0_0, <span class="hljs-meta">@thick</span> τ_0_0.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-type">Bool</span> <span class="hljs-comment">// user: %11</span>
  destroy_addr <span class="hljs-operator">%</span><span class="hljs-number">4</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>                           <span class="hljs-comment">// id: %9</span>
  dealloc_stack <span class="hljs-operator">%</span><span class="hljs-number">4</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>                          <span class="hljs-comment">// id: %10</span>
  <span class="hljs-keyword">return</span> <span class="hljs-operator">%</span><span class="hljs-number">8</span> : <span class="hljs-variable">$Bool</span>                               <span class="hljs-comment">// id: %11</span>
} <span class="hljs-comment">// end sil function '$s4main5equalySbx_xtSQRzlF'</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>再看一个例子：</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Drawable</span> {
  <span class="hljs-keyword">init</span>()
  <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() -&gt; <span class="hljs-type">Bool</span>
}

<span class="hljs-meta">@inline</span>(never)
<span class="hljs-keyword">func</span> <span class="hljs-title function_">drawShape</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Drawable</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">s</span>: <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">T</span> {
  <span class="hljs-keyword">var</span> s0 <span class="hljs-operator">=</span> <span class="hljs-type">T</span>()
  s0.draw()
  <span class="hljs-keyword">return</span> s0
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>从下列 SIL 可以看出：</p>
<ul>
<li>可以在 Heap 上创建泛型类型实例 (无论是值类型还是引用类型)；</li>
</ul>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-comment">// drawShape&lt;A&gt;(_:)</span>
sil hidden [noinline] @<span class="hljs-variable">$s4main9drawShapeyxxAA8DrawableRzlF</span> : $<span class="hljs-meta">@convention</span>(thin) <span class="hljs-operator">&lt;</span><span class="hljs-type">T</span> <span class="hljs-keyword">where</span> <span class="hljs-type">T</span> : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@in_guaranteed</span> <span class="hljs-type">T</span>) -&gt; <span class="hljs-meta">@out</span> <span class="hljs-type">T</span> {
<span class="hljs-comment">// %0 "$return_value"                             // users: %4, %6</span>
<span class="hljs-comment">// %1 "s"</span>
bb0(<span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>, <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">T</span>):
  <span class="hljs-operator">%</span><span class="hljs-number">2</span> <span class="hljs-operator">=</span> metatype $<span class="hljs-meta">@thick</span> <span class="hljs-type">T</span>.<span class="hljs-keyword">Type</span>                    <span class="hljs-comment">// user: %4</span>
  <span class="hljs-operator">%</span><span class="hljs-number">3</span> <span class="hljs-operator">=</span> witness_method <span class="hljs-variable">$T</span>, #<span class="hljs-type">Drawable</span>.<span class="hljs-keyword">init</span><span class="hljs-operator">!</span>allocator : <span class="hljs-operator">&lt;</span><span class="hljs-keyword">Self</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span> : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">Self</span>.<span class="hljs-keyword">Type</span>) -&gt; () -&gt; <span class="hljs-keyword">Self</span> : $<span class="hljs-meta">@convention</span>(witness_method: <span class="hljs-type">Drawable</span>) <span class="hljs-operator">&lt;</span>τ_0_0 <span class="hljs-keyword">where</span> τ_0_0 : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@thick</span> τ_0_0.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-meta">@out</span> τ_0_0 <span class="hljs-comment">// user: %4</span>
  <span class="hljs-operator">%</span><span class="hljs-number">4</span> <span class="hljs-operator">=</span> apply <span class="hljs-operator">%</span><span class="hljs-number">3</span><span class="hljs-operator">&lt;</span><span class="hljs-type">T</span><span class="hljs-operator">&gt;</span>(<span class="hljs-operator">%</span><span class="hljs-number">0</span>, <span class="hljs-operator">%</span><span class="hljs-number">2</span>) : $<span class="hljs-meta">@convention</span>(witness_method: <span class="hljs-type">Drawable</span>) <span class="hljs-operator">&lt;</span>τ_0_0 <span class="hljs-keyword">where</span> τ_0_0 : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@thick</span> τ_0_0.<span class="hljs-keyword">Type</span>) -&gt; <span class="hljs-meta">@out</span> τ_0_0
  <span class="hljs-operator">%</span><span class="hljs-number">5</span> <span class="hljs-operator">=</span> witness_method <span class="hljs-variable">$T</span>, #<span class="hljs-type">Drawable</span>.draw : <span class="hljs-operator">&lt;</span><span class="hljs-keyword">Self</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span> : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">Self</span>) -&gt; () -&gt; <span class="hljs-type">Bool</span> : $<span class="hljs-meta">@convention</span>(witness_method: <span class="hljs-type">Drawable</span>) <span class="hljs-operator">&lt;</span>τ_0_0 <span class="hljs-keyword">where</span> τ_0_0 : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@in_guaranteed</span> τ_0_0) -&gt; <span class="hljs-type">Bool</span> <span class="hljs-comment">// user: %6</span>
  <span class="hljs-operator">%</span><span class="hljs-number">6</span> <span class="hljs-operator">=</span> apply <span class="hljs-operator">%</span><span class="hljs-number">5</span><span class="hljs-operator">&lt;</span><span class="hljs-type">T</span><span class="hljs-operator">&gt;</span>(<span class="hljs-operator">%</span><span class="hljs-number">0</span>) : $<span class="hljs-meta">@convention</span>(witness_method: <span class="hljs-type">Drawable</span>) <span class="hljs-operator">&lt;</span>τ_0_0 <span class="hljs-keyword">where</span> τ_0_0 : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-meta">@in_guaranteed</span> τ_0_0) -&gt; <span class="hljs-type">Bool</span>
  <span class="hljs-operator">%</span><span class="hljs-number">7</span> <span class="hljs-operator">=</span> tuple ()                                   <span class="hljs-comment">// user: %8</span>
  <span class="hljs-keyword">return</span> <span class="hljs-operator">%</span><span class="hljs-number">7</span> : $()                                 <span class="hljs-comment">// id: %8</span>
} <span class="hljs-comment">// end sil function '$s4main9drawShapeyxxAA8DrawableRzlF'</span>


sil_witness_table hidden <span class="hljs-type">Shape</span>: <span class="hljs-type">Drawable</span> module main {
  method #<span class="hljs-type">Drawable</span>.<span class="hljs-keyword">init</span><span class="hljs-operator">!</span>allocator: <span class="hljs-operator">&lt;</span><span class="hljs-keyword">Self</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span> : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">Self</span>.<span class="hljs-keyword">Type</span>) -&gt; () -&gt; <span class="hljs-keyword">Self</span> : @<span class="hljs-variable">$s4main5ShapeCAA8DrawableA2aDPxycfCTW</span>    <span class="hljs-comment">// protocol witness for Drawable.init() in conformance Shape</span>
  method #<span class="hljs-type">Drawable</span>.draw: <span class="hljs-operator">&lt;</span><span class="hljs-keyword">Self</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">Self</span> : <span class="hljs-type">Drawable</span><span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">Self</span>) -&gt; () -&gt; <span class="hljs-type">Bool</span> : @<span class="hljs-variable">$s4main5ShapeCAA8DrawableA2aDP4drawSbyFTW</span>    <span class="hljs-comment">// protocol witness for Drawable.draw() in conformance Shape</span>
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>通过上面简单的分析可以看出 No Constraints、Class Constraints 以及 Protocol Constraints 的泛型类型在实现上的区别：</p>
<ul>
<li>
<p>No Constraints 泛型能做的事很少，不能执行任何方法，只能 Stack 上为泛型类型分配内存并执行内存拷贝；</p>
</li>
<li>
<p>Class Constraints 泛型可以在 Heap 上创建新实例，方法调用通过虚函数表 (vtable) 实现；</p>
</li>
<li>
<p>Protocol Constraints 泛型可以在 Stack 上也可以在 Heap 上按需创建泛型类型实例，无论泛型是值类型还是引用类型；</p>
</li>
<li>
<p>Protocol Constraints 泛型通过 PWT 实现方法调用；</p>
</li>
<li>
<p>也就是说泛型中的方法调用都是动态派发 (Dynamic dispatch)，通过 vtable 或者 PWT。</p>
</li>
</ul>
<h2 data-id="heading-9">Specialization of Generics</h2>
<p>从上一小节可知，泛型方法调用都是动态派发 (通过 vtable 或 PWT)，有一定的性能损耗。</p>
<p>为了优化此类损耗，Swift 编译器会对泛型进行特化 (Specialization of Generics)。</p>
<p>所谓特化就是为具体类型生成相应版本的函数，从而将泛型转成非泛型，实现方法调用的静态派发。</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-meta">@inline</span>(never)
<span class="hljs-keyword">func</span> <span class="hljs-title function_">swapTwoValues</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">a</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>) {
  <span class="hljs-keyword">let</span> temp <span class="hljs-operator">=</span> a
  a <span class="hljs-operator">=</span> b
  b <span class="hljs-operator">=</span> temp
}

<span class="hljs-keyword">var</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">var</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
swapTwoValues(<span class="hljs-operator">&amp;</span>a, <span class="hljs-operator">&amp;</span>b)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如例，通过 <code>Int</code> 型参数调用 <code>swapTwoValues</code> 时，编译器就会生成该方法的 <code>Int</code> 版本：</p>
<pre><code class="hljs language-swift copyable" lang="swift"><span class="hljs-comment">// specialized swapTwoValues&lt;A&gt;(_:_:)</span>
sil shared [noinline] @<span class="hljs-variable">$s4main13swapTwoValuesyyxz_xztlFSi_Tg5</span> : $<span class="hljs-meta">@convention</span>(thin) (<span class="hljs-meta">@inout</span> <span class="hljs-type">Int</span>, <span class="hljs-meta">@inout</span> <span class="hljs-type">Int</span>) -&gt; () {
<span class="hljs-comment">// %0 "a"                                         // users: %6, %4, %2</span>
<span class="hljs-comment">// %1 "b"                                         // users: %7, %5, %3</span>
bb0(<span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>, <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>):
  debug_value_addr <span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>, <span class="hljs-keyword">var</span>, name <span class="hljs-string">"a"</span>, argno <span class="hljs-number">1</span> <span class="hljs-comment">// id: %2</span>
  debug_value_addr <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>, <span class="hljs-keyword">var</span>, name <span class="hljs-string">"b"</span>, argno <span class="hljs-number">2</span> <span class="hljs-comment">// id: %3</span>
  <span class="hljs-operator">%</span><span class="hljs-number">4</span> <span class="hljs-operator">=</span> load <span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>                            <span class="hljs-comment">// user: %7</span>
  <span class="hljs-operator">%</span><span class="hljs-number">5</span> <span class="hljs-operator">=</span> load <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>                            <span class="hljs-comment">// user: %6</span>
  store <span class="hljs-operator">%</span><span class="hljs-number">5</span> to <span class="hljs-operator">%</span><span class="hljs-number">0</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>                          <span class="hljs-comment">// id: %6</span>
  store <span class="hljs-operator">%</span><span class="hljs-number">4</span> to <span class="hljs-operator">%</span><span class="hljs-number">1</span> : $<span class="hljs-operator">*</span><span class="hljs-type">Int</span>                          <span class="hljs-comment">// id: %7</span>
  <span class="hljs-operator">%</span><span class="hljs-number">8</span> <span class="hljs-operator">=</span> tuple ()                                   <span class="hljs-comment">// user: %9</span>
  <span class="hljs-keyword">return</span> <span class="hljs-operator">%</span><span class="hljs-number">8</span> : $()                                 <span class="hljs-comment">// id: %9</span>
} <span class="hljs-comment">// end sil function '$s4main13swapTwoValuesyyxz_xztlFSi_Tg5'</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>那么，什么时候会进行泛型特化呢？</p>
<p>总的原则是在编译泛型方法时知道有哪些调用方，同时调用方的类型是可推演的。</p>
<p>最简单的情况就是泛型方法与调用方在同一个源文件里，一起进行编译。</p>
<p>另外在编译时若开启了 Whole-Module Optimization ，同一模块内部的泛型调用也可以被特化。</p>
<blockquote>
<p>关于全模块优化请参考<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.swift.org%2Fblog%2Fwhole-module-optimizations%2F" target="_blank" title="https://www.swift.org/blog/whole-module-optimizations/" ref="nofollow noopener noreferrer">Swift.org - Whole-Module Optimization in Swift 3</a>，在此不再赘述。</p>
</blockquote>
<h1 data-id="heading-10">小结</h1>
<ul>
<li>
<p>Swift 为每种类型生成了一份 Metadata Record，其中包含了 VWT (Value Witness Table)；</p>
</li>
<li>
<p>Protocol 使用 Existential Container 作为其内存模型，所有 Protocol 类型的变量都是 Existential Container 的实例；</p>
</li>
<li>
<p>Protocol 通过 PWT 实现方法动态派发 (Dynamic dispatch)；</p>
</li>
<li>
<p>泛型调用在满足一定条件时会进行特化，以提升性能。</p>
</li>
</ul>
<h1 data-id="heading-11">参考资料</h1>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0244-opaque-result-types.md" target="_blank" title="https://github.com/apple/swift-evolution/blob/master/proposals/0244-opaque-result-types.md" ref="nofollow noopener noreferrer">swift-evolution · Opaque Result Types</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdocs.swift.org%2Fswift-book%2FLanguageGuide%2FOpaqueTypes.html" target="_blank" title="https://docs.swift.org/swift-book/LanguageGuide/OpaqueTypes.html" ref="nofollow noopener noreferrer">OpaqueTypes</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.swiftbysundell.com%2Farticles%2Fdifferent-flavors-of-type-erasure-in-swift%2F%23closures-to-the-rescue" target="_blank" title="https://www.swiftbysundell.com/articles/different-flavors-of-type-erasure-in-swift/#closures-to-the-rescue" ref="nofollow noopener noreferrer">Different flavors of type erasure in Swift</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.raywenderlich.com%2F24942207-opaque-return-types-and-type-erasure" target="_blank" title="https://www.raywenderlich.com/24942207-opaque-return-types-and-type-erasure" ref="nofollow noopener noreferrer">Opaque Return Types and Type Erasure</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.swiftbysundell.com%2Farticles%2Fphantom-types-in-swift%2F" target="_blank" title="https://www.swiftbysundell.com/articles/phantom-types-in-swift/" ref="nofollow noopener noreferrer">Phantom types in Swift</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.hackingwithswift.com%2Fplus%2Fadvanced-swift%2Fhow-to-use-phantom-types-in-swift" target="_blank" title="https://www.hackingwithswift.com/plus/advanced-swift/how-to-use-phantom-types-in-swift" ref="nofollow noopener noreferrer">How to use phantom types in Swift</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeMetadata.rst%23protocol-metadata" target="_blank" title="https://github.com/apple/swift/blob/main/docs/ABI/TypeMetadata.rst#protocol-metadata" ref="nofollow noopener noreferrer">swift/TypeMetadata.rst at main · apple/swift · GitHub</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeLayout.rst" target="_blank" title="https://github.com/apple/swift/blob/main/docs/ABI/TypeLayout.rst" ref="nofollow noopener noreferrer">swift/TypeLayout.rst at main · apple/swift · GitHub</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fspeakerdeck.com%2Fkateinoigakukun%2Fswift-type-metadata%3Fslide%3D48" target="_blank" title="https://speakerdeck.com/kateinoigakukun/swift-type-metadata?slide=48" ref="nofollow noopener noreferrer">Swift Type&nbsp;Metadata</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2016%2F416%2F" target="_blank" title="https://developer.apple.com/videos/play/wwdc2016/416/" ref="nofollow noopener noreferrer">Understanding Swift Performance · WWDC2016</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.swift.org%2Fblog%2Fwhole-module-optimizations%2F" target="_blank" title="https://www.swift.org/blog/whole-module-optimizations/" ref="nofollow noopener noreferrer">Swift.org - Whole-Module Optimization in Swift 3</a></p></div></div></article> <!----> <div class="article-end" data-v-4b9f9746="" data-v-1c9ebbff=""><div class="tag-list-box" data-v-4b9f9746="" data-v-1c9ebbff=""><div class="tag-list" data-v-4b9f9746="" data-v-1c9ebbff=""><div class="tag-list-title" data-v-4b9f9746="" data-v-1c9ebbff="">分类：</div> <a href="https://juejin.cn/ios" target="_blank" rel="" class="item category-item" data-v-1c9ebbff="" data-v-4b9f9746=""><span class="tag-title" data-v-1c9ebbff="">iOS</span></a></div> <div class="tag-list" data-v-4b9f9746="" data-v-1c9ebbff=""><div class="tag-list-title" data-v-4b9f9746="" data-v-1c9ebbff="">标签：</div> <div class="tag-list-container" data-v-4b9f9746="" data-v-1c9ebbff=""><a href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="item tag-item" data-v-1c9ebbff="" data-v-4b9f9746=""><span class="tag-title" data-v-1c9ebbff="">Swift</span></a><a href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="item tag-item" data-v-1c9ebbff="" data-v-4b9f9746=""><span class="tag-title" data-v-1c9ebbff="">iOS</span></a></div></div></div> <!----> <div data-fetch-key="1" class="extension-banner" data-v-224127ff="" data-v-1c9ebbff="" data-v-4b9f9746=""><span class="banner-icon" data-v-224127ff=""></span> <div class="banner-wrapper" data-v-224127ff=""><a class="banner-title" data-v-224127ff="" href="https://juejin.cn/extension/?utm_source=standalone&amp;utm_medium=post&amp;utm_campaign=extension_promotion" target="_blank">
      安装掘金浏览器插件
    </a> <div class="banner-content" data-v-224127ff="">多内容聚合浏览、多引擎快捷搜索、多工具便捷提效、多模式随心畅享，你想要的，这里都有！</div></div> <a class="banner-action" data-v-224127ff="" href="https://juejin.cn/extension/?utm_source=standalone&amp;utm_medium=post&amp;utm_campaign=extension_promotion" target="_blank">前往安装</a></div></div> <!----> <!----> <div data-v-33dabfcc="" data-v-1c9ebbff="" data-jj-helper="comment-container" class="container comment-list-box" id="comment-box" data-v-4b9f9746=""><div data-v-14a3249a="" data-v-33dabfcc="" class="comment-form"><div data-v-14a3249a="" class="header"><span data-v-14a3249a="" class="header-title">评论</span></div><div data-v-14a3249a="" class="content"><div data-v-14a3249a="" class="avatar-box"><img data-v-248050e4="" data-v-0b45085c="" data-v-14a3249a="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/3044413937_100x100.awebp" alt="" class="lazy avatar avatar" loading="lazy"></div><div data-v-14a3249a="" class="form-box"><div data-v-7c7c7498="" data-v-14a3249a="" class="auth-card"><!----> <div data-v-14a3249a="" data-v-7c7c7498="" class="input-box"><div data-v-14a3249a="" data-v-7c7c7498="" contenteditable="true" spellcheck="false" placeholder="输入评论（Enter换行，⌘ + Enter发送）" disabled="disabled" class="rich-input empty"></div><!----><!----></div></div><div data-v-14a3249a="" class="action-box"><div data-v-33ab0a29="" data-v-14a3249a="" class="emoji-container emoji-btn" style="display: none;"><div data-v-33ab0a29="" class="emoji-box"><svg data-v-33ab0a29="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon"><path data-v-33ab0a29="" fill-rule="evenodd" clip-rule="evenodd" d="M8.00002 0.666504C12.0501 0.666504 15.3334 3.94975 15.3334 7.99984C15.3334 12.0499 12.0501 15.3332 8.00002 15.3332C3.94993 15.3332 0.666687 12.0499 0.666687 7.99984C0.666687 3.94975 3.94993 0.666504 8.00002 0.666504ZM8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2ZM10.6667 5.66667V7.66667H9.33333V5.66667H10.6667ZM6.66667 5.66667V7.66667H5.33333V5.66667H6.66667ZM10.0767 9.33333H11.0495C11.1804 9.33333 11.2866 9.43951 11.2866 9.57048C11.2866 9.60754 11.2779 9.64409 11.2612 9.67718L11.244 9.71053C10.6294 10.8739 9.40726 11.6667 7.99998 11.6667C6.61523 11.6667 5.40977 10.8991 4.7859 9.76612L4.73786 9.67593C4.67845 9.56052 4.72385 9.4188 4.83926 9.35939C4.87253 9.34226 4.90941 9.33333 4.94683 9.33333H5.92347C6.02396 9.33332 6.11908 9.37865 6.18238 9.4567C6.26207 9.55496 6.32833 9.62955 6.38117 9.68046C6.80074 10.0847 7.37133 10.3333 7.99998 10.3333C8.63289 10.3333 9.20694 10.0814 9.62728 9.67224C9.67791 9.62296 9.74135 9.55121 9.8176 9.45698C9.88089 9.37877 9.97611 9.33333 10.0767 9.33333Z"></path></svg> <span data-v-33ab0a29="">表情</span></div> <!----></div><div data-v-14a3249a="" class="image-btn" style="display: none;"><svg data-v-14a3249a="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon"><path data-v-14a3249a="" fill-rule="evenodd" clip-rule="evenodd" d="M14 1.3335C14.3514 1.3335 14.6394 1.60546 14.6648 1.95041L14.6666 2.00016V14.0002C14.6666 14.3516 14.3947 14.6396 14.0497 14.665L14 14.6668H1.99998C1.64853 14.6668 1.36059 14.3949 1.33514 14.0499L1.33331 14.0002V2.00016C1.33331 1.64871 1.60527 1.36077 1.95023 1.33532L1.99998 1.3335H14ZM13.3333 2.66618H2.66664V13.3328H13.3333V2.66618ZM11.9219 6.7879C11.9719 6.83791 12 6.90574 12 6.97647V11.7993C12 11.9098 11.9104 11.9993 11.8 11.9993H6.81615C6.7975 11.9993 6.77945 11.9968 6.76232 11.992L3.91042 11.9847C3.79996 11.9844 3.71063 11.8947 3.7109 11.7842C3.71102 11.7313 3.73209 11.6807 3.76948 11.6433L6.52468 8.88807C6.62882 8.78393 6.79766 8.78393 6.9018 8.88807L8.17297 10.1593L11.5447 6.7879C11.6489 6.68376 11.8177 6.68376 11.9219 6.7879ZM5.99997 3.99951V5.99951H3.99997V3.99951H5.99997Z"></path></svg><span data-v-14a3249a="">图片</span></div><div data-v-14a3249a="" class="submit" style="display: none;"><span data-v-14a3249a="">⌘ + Enter</span><button data-v-14a3249a="" disabled="disabled" class="submit-btn">发表评论</button></div></div></div><input data-v-14a3249a="" type="file" class="hidden"></div></div> <!----> <div data-v-33dabfcc="" class="comment-list-wrapper"><div data-v-33dabfcc="" class="title">
      全部评论 5
      <div data-v-33dabfcc="" class="sort"><div data-v-33dabfcc="" class="item active"><svg data-v-33dabfcc="" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-33dabfcc="" fill-rule="evenodd" clip-rule="evenodd" d="M5.99951 0.5C9.03708 0.5 11.4995 2.96243 11.4995 6C11.4995 9.03757 9.03708 11.5 5.99951 11.5C2.96195 11.5 0.499512 9.03757 0.499512 6C0.499512 2.96243 2.96195 0.5 5.99951 0.5ZM6.25 3.49988C6.38807 3.49988 6.5 3.61181 6.5 3.74988V5.49988H8.25C8.38807 5.49988 8.5 5.61181 8.5 5.74988V6.24988C8.5 6.38795 8.38807 6.49988 8.25 6.49988H5.75C5.61193 6.49988 5.5 6.38795 5.5 6.24988V3.74988C5.5 3.61181 5.61193 3.49988 5.75 3.49988H6.25Z"></path></svg>
          最新
        </div> <div data-v-33dabfcc="" class="item"><svg data-v-33dabfcc="" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-33dabfcc="" d="M4.88933 0.613974C4.92947 0.616946 4.96831 0.629568 5.00253 0.650767C6.67348 1.68589 7.55141 3.13884 7.63632 5.00962C7.947 5.00962 8.2245 4.65999 8.46882 3.96072L8.49487 3.88447C8.53862 3.75351 8.68025 3.68282 8.8112 3.72656C8.83398 3.73417 8.85554 3.74502 8.87522 3.75878C9.96316 4.5193 10.5048 5.50231 10.5 6.70782C10.4999 6.73762 10.4982 6.76675 10.495 6.7952C10.4985 6.86294 10.5 6.93131 10.5 7.00005C10.5 9.48533 8.48528 11.5 6 11.5C3.51472 11.5 1.5 9.48533 1.5 7.00005C1.5 6.90255 1.5031 6.80578 1.50921 6.70983C1.5062 6.70917 1.5031 6.70849 1.5 6.70782C1.50864 6.60849 1.52139 6.50994 1.53824 6.41219C1.54515 6.35775 1.55321 6.30373 1.56222 6.25003L1.57017 6.24983C1.7622 5.3813 2.28426 4.57601 3.13635 3.83394C4.00892 3.07405 4.50079 2.11523 4.61198 0.957499L4.62156 0.844839C4.63175 0.707146 4.75163 0.603784 4.88933 0.613974Z"></path></svg>
          最热
        </div></div></div> <div data-v-51124a88="" data-v-33dabfcc="" class="comment-list comment-list"><div data-v-5ca9a68f="" data-v-51124a88="" class="image-viewer-box"><!----></div> <div data-v-18fef07e="" data-v-51124a88="" class="comment" data-jj-helper-comment-id="7128588144785769252"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover popover"><!---->  <a data-v-18fef07e="" href="https://juejin.cn/user/2075520156571831" target="_blank" rel="" class="user-link" data-v-f1a2074a=""><img data-v-248050e4="" data-v-0b45085c="" data-v-18fef07e="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/3033762272_100x100.awebp" alt="user4517841299085的头像" class="lazy avatar avatar" loading="lazy"></a></div> <div data-v-18fef07e="" class="content-box"><div data-v-18fef07e="" class="comment-main"><span data-v-18fef07e="" class="delete">
        删除
      </span> <div data-v-18fef07e="" class="user-box"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover"><!---->  <a data-v-68a20f0a="" data-v-18fef07e="" href="https://juejin.cn/user/2075520156571831" target="_blank" rel="" class="username username" data-v-f1a2074a=""><span data-v-68a20f0a="" class="name" style="max-width: 128px;">
    user4517841299085
  </span> <!----> <img data-v-7b42e73d="" data-v-68a20f0a="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/9b2f31c663d17de59dd9e5fff272bb85.svg" alt="掘友等级" title="掘友等级" class="jueyou-level"> <!----> </a></div> <!----> <!----> <time data-v-18fef07e="" datetime="1659753839000" title="Sat Aug 06 2022 10:43:59 GMT+0800 (中国标准时间)" class="time">
          7月前
        </time></div> <div data-v-18fef07e="" class="content"><img class="emoji" draggable="false" "="" loading="lazy" alt="[666]" src="./Swift Protocol 背后的故事(理论) - 掘金_files/jj_emoji_128.e55728c.png"></div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        展开
      </div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        收起
      </div> <!----> <div data-v-18fef07e="" class="action-box"><div data-v-18fef07e="" class="item dig-item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M8.56162 2.16952C8.66569 2.09661 8.78195 2.06124 8.88247 2.0912C8.97653 2.11923 9.23851 2.25916 9.50988 2.96799C9.64419 3.31881 9.9356 4.2424 9.42155 6.05431C9.29751 6.49152 9.61394 6.95303 10.0926 6.95971L13.492 7.00716L13.492 7.00721H13.4991C13.6049 7.00721 13.7228 7.01986 13.8134 7.05898C13.8544 7.07671 13.8815 7.09639 13.8999 7.116C13.9166 7.13375 13.9368 7.16247 13.9515 7.21636C13.9848 7.33784 14.0228 7.74712 13.9473 8.42262C13.874 9.07857 13.698 9.94479 13.341 10.9598C13.0424 11.8088 12.6601 12.5292 12.0684 13.4879C12.0558 13.5052 12.0462 13.5197 12.0418 13.5265L12.0404 13.5285C12.0292 13.5454 12.0242 13.5531 12.018 13.5618C12.0076 13.5764 12.0018 13.582 11.9983 13.585C11.996 13.587 11.9908 13.5912 11.9777 13.5959C11.9638 13.6009 11.9311 13.61 11.8706 13.61H5.56278L5.56373 6.58489C5.87126 6.41901 6.19881 6.20128 6.54112 5.84059C6.93883 5.42152 7.33789 4.8294 7.76254 3.94183C7.84974 3.75957 7.91745 3.55962 7.97574 3.37762C7.99264 3.32486 8.0087 3.27379 8.02438 3.22393L8.02439 3.22389C8.066 3.09158 8.10495 2.96776 8.14985 2.84312C8.2758 2.49352 8.40247 2.28101 8.56162 2.16952ZM10.452 2.60729C10.1323 1.77209 9.70208 1.28277 9.17063 1.12437C8.64564 0.967902 8.20308 1.18891 7.98278 1.34325C7.55169 1.64525 7.33837 2.11908 7.20071 2.5012C7.14817 2.64705 7.10002 2.80016 7.05661 2.93824C7.0422 2.98405 7.02832 3.02821 7.01496 3.0699C6.95791 3.24804 6.90763 3.39115 6.85248 3.50643C6.45683 4.3334 6.1121 4.8271 5.80935 5.14611C5.51322 5.45815 5.23983 5.6219 4.9473 5.76821C4.71095 5.88641 4.55494 6.12906 4.55491 6.40159L4.55388 13.9125C4.55383 14.3026 4.87002 14.6188 5.26008 14.6188H11.8706C12.2097 14.6188 12.4663 14.5113 12.6519 14.3535C12.7387 14.2797 12.7988 14.2043 12.8387 14.1484C12.8556 14.1248 12.8704 14.1025 12.8786 14.09L12.8813 14.0859L12.8826 14.0839L12.8955 14.0685L12.9142 14.0382C13.5304 13.0414 13.9578 12.247 14.2927 11.2945C14.6745 10.209 14.8679 9.26811 14.9499 8.5347C15.0297 7.82084 15.009 7.25845 14.9246 6.95014C14.805 6.51285 14.5104 6.26112 14.2134 6.13284C13.9385 6.01407 13.661 5.99859 13.5028 5.99836L10.4907 5.95631C10.9296 4.15791 10.648 3.11902 10.452 2.60729ZM1.0008 6.46783C0.981809 6.0652 1.30313 5.72836 1.70621 5.72836H2.75264C3.14266 5.72836 3.45883 6.04454 3.45883 6.43456V13.9442C3.45883 14.3342 3.14266 14.6504 2.75264 14.6504H2.06044C1.68335 14.6504 1.37279 14.3541 1.35502 13.9775L1.0008 6.46783Z"></path></svg>
          点赞
        </div> <div data-v-18fef07e="" class="item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M2.30136 10.1142L2.30019 3.45191C2.30024 2.6778 2.92779 2.05019 3.70191 2.05019H12.3989C13.1731 2.05019 13.8006 2.67785 13.8006 3.452L13.8018 10.1144C13.8017 10.8885 13.1742 11.516 12.4001 11.516H10.1322C9.97329 11.516 9.81862 11.5675 9.69142 11.6629L6.65162 13.9406C6.62173 13.9598 6.58148 13.9444 6.57209 13.91L6.15416 12.0869C6.07758 11.7528 5.78033 11.516 5.43761 11.516H3.70308C2.92893 11.516 2.30136 10.8884 2.30136 10.1142ZM3.70191 1C2.34776 1 1.25 2.09776 1.25 3.45191L1.25117 10.1144C1.25122 11.4685 2.34896 12.5662 3.70308 12.5662H5.18661L5.54953 14.1495L5.55107 14.1558C5.73515 14.9153 6.62879 15.248 7.26458 14.7937L10.2372 12.5662H12.4001C13.7542 12.5662 14.852 11.4684 14.852 10.1142L14.8508 3.45182C14.8508 2.09771 13.753 1 12.3989 1H3.70191ZM4.78612 7.91404C5.35027 7.91404 5.8076 7.45671 5.8076 6.89257C5.8076 6.32842 5.35027 5.87109 4.78612 5.87109C4.22198 5.87109 3.76465 6.32842 3.76465 6.89257C3.76465 7.45671 4.22198 7.91404 4.78612 7.91404ZM8.98631 6.89257C8.98631 7.45671 8.52898 7.91404 7.96483 7.91404C7.40069 7.91404 6.94336 7.45671 6.94336 6.89257C6.94336 6.32842 7.40069 5.87109 7.96483 5.87109C8.52898 5.87109 8.98631 6.32842 8.98631 6.89257ZM11.1484 7.91404C11.7126 7.91404 12.1699 7.45671 12.1699 6.89257C12.1699 6.32842 11.7126 5.87109 11.1484 5.87109C10.5843 5.87109 10.127 6.32842 10.127 6.89257C10.127 7.45671 10.5843 7.91404 11.1484 7.91404Z"></path></svg>
          回复
        </div></div></div> <div data-v-18fef07e="" class="subcomment-wrapper"><!----> <!----></div></div></div><div data-v-18fef07e="" data-v-51124a88="" class="comment" data-jj-helper-comment-id="7126409981464871716"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover popover"><!---->  <a data-v-18fef07e="" href="https://juejin.cn/user/3417698647428653" target="_blank" rel="" class="user-link" data-v-f1a2074a=""><img data-v-248050e4="" data-v-0b45085c="" data-v-18fef07e="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/5070639578_100x100.awebp" alt="user6351742822118的头像" class="lazy avatar avatar" loading="lazy"></a></div> <div data-v-18fef07e="" class="content-box"><div data-v-18fef07e="" class="comment-main"><span data-v-18fef07e="" class="delete">
        删除
      </span> <div data-v-18fef07e="" class="user-box"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover"><!---->  <a data-v-68a20f0a="" data-v-18fef07e="" href="https://juejin.cn/user/3417698647428653" target="_blank" rel="" class="username username" data-v-f1a2074a=""><span data-v-68a20f0a="" class="name" style="max-width: 128px;">
    user6351742822118
  </span> <!----> <img data-v-7b42e73d="" data-v-68a20f0a="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/9b2f31c663d17de59dd9e5fff272bb85.svg" alt="掘友等级" title="掘友等级" class="jueyou-level"> <!----> </a></div> <!----> <!----> <time data-v-18fef07e="" datetime="1659246710000" title="Sun Jul 31 2022 13:51:50 GMT+0800 (中国标准时间)" class="time">
          7月前
        </time></div> <div data-v-18fef07e="" class="content"><img class="emoji old" draggable="false" "="" loading="lazy" alt="👏" src="./Swift Protocol 背后的故事(理论) - 掘金_files/1f44f.svg_tplv-t2oaga2asx-image.image"></div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        展开
      </div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        收起
      </div> <!----> <div data-v-18fef07e="" class="action-box"><div data-v-18fef07e="" class="item dig-item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M8.56162 2.16952C8.66569 2.09661 8.78195 2.06124 8.88247 2.0912C8.97653 2.11923 9.23851 2.25916 9.50988 2.96799C9.64419 3.31881 9.9356 4.2424 9.42155 6.05431C9.29751 6.49152 9.61394 6.95303 10.0926 6.95971L13.492 7.00716L13.492 7.00721H13.4991C13.6049 7.00721 13.7228 7.01986 13.8134 7.05898C13.8544 7.07671 13.8815 7.09639 13.8999 7.116C13.9166 7.13375 13.9368 7.16247 13.9515 7.21636C13.9848 7.33784 14.0228 7.74712 13.9473 8.42262C13.874 9.07857 13.698 9.94479 13.341 10.9598C13.0424 11.8088 12.6601 12.5292 12.0684 13.4879C12.0558 13.5052 12.0462 13.5197 12.0418 13.5265L12.0404 13.5285C12.0292 13.5454 12.0242 13.5531 12.018 13.5618C12.0076 13.5764 12.0018 13.582 11.9983 13.585C11.996 13.587 11.9908 13.5912 11.9777 13.5959C11.9638 13.6009 11.9311 13.61 11.8706 13.61H5.56278L5.56373 6.58489C5.87126 6.41901 6.19881 6.20128 6.54112 5.84059C6.93883 5.42152 7.33789 4.8294 7.76254 3.94183C7.84974 3.75957 7.91745 3.55962 7.97574 3.37762C7.99264 3.32486 8.0087 3.27379 8.02438 3.22393L8.02439 3.22389C8.066 3.09158 8.10495 2.96776 8.14985 2.84312C8.2758 2.49352 8.40247 2.28101 8.56162 2.16952ZM10.452 2.60729C10.1323 1.77209 9.70208 1.28277 9.17063 1.12437C8.64564 0.967902 8.20308 1.18891 7.98278 1.34325C7.55169 1.64525 7.33837 2.11908 7.20071 2.5012C7.14817 2.64705 7.10002 2.80016 7.05661 2.93824C7.0422 2.98405 7.02832 3.02821 7.01496 3.0699C6.95791 3.24804 6.90763 3.39115 6.85248 3.50643C6.45683 4.3334 6.1121 4.8271 5.80935 5.14611C5.51322 5.45815 5.23983 5.6219 4.9473 5.76821C4.71095 5.88641 4.55494 6.12906 4.55491 6.40159L4.55388 13.9125C4.55383 14.3026 4.87002 14.6188 5.26008 14.6188H11.8706C12.2097 14.6188 12.4663 14.5113 12.6519 14.3535C12.7387 14.2797 12.7988 14.2043 12.8387 14.1484C12.8556 14.1248 12.8704 14.1025 12.8786 14.09L12.8813 14.0859L12.8826 14.0839L12.8955 14.0685L12.9142 14.0382C13.5304 13.0414 13.9578 12.247 14.2927 11.2945C14.6745 10.209 14.8679 9.26811 14.9499 8.5347C15.0297 7.82084 15.009 7.25845 14.9246 6.95014C14.805 6.51285 14.5104 6.26112 14.2134 6.13284C13.9385 6.01407 13.661 5.99859 13.5028 5.99836L10.4907 5.95631C10.9296 4.15791 10.648 3.11902 10.452 2.60729ZM1.0008 6.46783C0.981809 6.0652 1.30313 5.72836 1.70621 5.72836H2.75264C3.14266 5.72836 3.45883 6.04454 3.45883 6.43456V13.9442C3.45883 14.3342 3.14266 14.6504 2.75264 14.6504H2.06044C1.68335 14.6504 1.37279 14.3541 1.35502 13.9775L1.0008 6.46783Z"></path></svg>
          点赞
        </div> <div data-v-18fef07e="" class="item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M2.30136 10.1142L2.30019 3.45191C2.30024 2.6778 2.92779 2.05019 3.70191 2.05019H12.3989C13.1731 2.05019 13.8006 2.67785 13.8006 3.452L13.8018 10.1144C13.8017 10.8885 13.1742 11.516 12.4001 11.516H10.1322C9.97329 11.516 9.81862 11.5675 9.69142 11.6629L6.65162 13.9406C6.62173 13.9598 6.58148 13.9444 6.57209 13.91L6.15416 12.0869C6.07758 11.7528 5.78033 11.516 5.43761 11.516H3.70308C2.92893 11.516 2.30136 10.8884 2.30136 10.1142ZM3.70191 1C2.34776 1 1.25 2.09776 1.25 3.45191L1.25117 10.1144C1.25122 11.4685 2.34896 12.5662 3.70308 12.5662H5.18661L5.54953 14.1495L5.55107 14.1558C5.73515 14.9153 6.62879 15.248 7.26458 14.7937L10.2372 12.5662H12.4001C13.7542 12.5662 14.852 11.4684 14.852 10.1142L14.8508 3.45182C14.8508 2.09771 13.753 1 12.3989 1H3.70191ZM4.78612 7.91404C5.35027 7.91404 5.8076 7.45671 5.8076 6.89257C5.8076 6.32842 5.35027 5.87109 4.78612 5.87109C4.22198 5.87109 3.76465 6.32842 3.76465 6.89257C3.76465 7.45671 4.22198 7.91404 4.78612 7.91404ZM8.98631 6.89257C8.98631 7.45671 8.52898 7.91404 7.96483 7.91404C7.40069 7.91404 6.94336 7.45671 6.94336 6.89257C6.94336 6.32842 7.40069 5.87109 7.96483 5.87109C8.52898 5.87109 8.98631 6.32842 8.98631 6.89257ZM11.1484 7.91404C11.7126 7.91404 12.1699 7.45671 12.1699 6.89257C12.1699 6.32842 11.7126 5.87109 11.1484 5.87109C10.5843 5.87109 10.127 6.32842 10.127 6.89257C10.127 7.45671 10.5843 7.91404 11.1484 7.91404Z"></path></svg>
          回复
        </div></div></div> <div data-v-18fef07e="" class="subcomment-wrapper"><!----> <!----></div></div></div><div data-v-18fef07e="" data-v-51124a88="" class="comment" data-jj-helper-comment-id="7115059010847654669"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover popover"><!---->  <a data-v-18fef07e="" href="https://juejin.cn/user/3417698647428653" target="_blank" rel="" class="user-link" data-v-f1a2074a=""><img data-v-248050e4="" data-v-0b45085c="" data-v-18fef07e="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/5070639578_100x100.awebp" alt="user6351742822118的头像" class="lazy avatar avatar" loading="lazy"></a></div> <div data-v-18fef07e="" class="content-box"><div data-v-18fef07e="" class="comment-main"><span data-v-18fef07e="" class="delete">
        删除
      </span> <div data-v-18fef07e="" class="user-box"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover"><!---->  <a data-v-68a20f0a="" data-v-18fef07e="" href="https://juejin.cn/user/3417698647428653" target="_blank" rel="" class="username username" data-v-f1a2074a=""><span data-v-68a20f0a="" class="name" style="max-width: 128px;">
    user6351742822118
  </span> <!----> <img data-v-7b42e73d="" data-v-68a20f0a="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/9b2f31c663d17de59dd9e5fff272bb85.svg" alt="掘友等级" title="掘友等级" class="jueyou-level"> <!----> </a></div> <!----> <!----> <time data-v-18fef07e="" datetime="1656603935000" title="Thu Jun 30 2022 23:45:35 GMT+0800 (中国标准时间)" class="time">
          8月前
        </time></div> <div data-v-18fef07e="" class="content"><img class="emoji old" draggable="false" "="" loading="lazy" alt="👍" src="./Swift Protocol 背后的故事(理论) - 掘金_files/1f44d.svg_tplv-t2oaga2asx-image.image"></div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        展开
      </div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        收起
      </div> <!----> <div data-v-18fef07e="" class="action-box"><div data-v-18fef07e="" class="item dig-item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M8.56162 2.16952C8.66569 2.09661 8.78195 2.06124 8.88247 2.0912C8.97653 2.11923 9.23851 2.25916 9.50988 2.96799C9.64419 3.31881 9.9356 4.2424 9.42155 6.05431C9.29751 6.49152 9.61394 6.95303 10.0926 6.95971L13.492 7.00716L13.492 7.00721H13.4991C13.6049 7.00721 13.7228 7.01986 13.8134 7.05898C13.8544 7.07671 13.8815 7.09639 13.8999 7.116C13.9166 7.13375 13.9368 7.16247 13.9515 7.21636C13.9848 7.33784 14.0228 7.74712 13.9473 8.42262C13.874 9.07857 13.698 9.94479 13.341 10.9598C13.0424 11.8088 12.6601 12.5292 12.0684 13.4879C12.0558 13.5052 12.0462 13.5197 12.0418 13.5265L12.0404 13.5285C12.0292 13.5454 12.0242 13.5531 12.018 13.5618C12.0076 13.5764 12.0018 13.582 11.9983 13.585C11.996 13.587 11.9908 13.5912 11.9777 13.5959C11.9638 13.6009 11.9311 13.61 11.8706 13.61H5.56278L5.56373 6.58489C5.87126 6.41901 6.19881 6.20128 6.54112 5.84059C6.93883 5.42152 7.33789 4.8294 7.76254 3.94183C7.84974 3.75957 7.91745 3.55962 7.97574 3.37762C7.99264 3.32486 8.0087 3.27379 8.02438 3.22393L8.02439 3.22389C8.066 3.09158 8.10495 2.96776 8.14985 2.84312C8.2758 2.49352 8.40247 2.28101 8.56162 2.16952ZM10.452 2.60729C10.1323 1.77209 9.70208 1.28277 9.17063 1.12437C8.64564 0.967902 8.20308 1.18891 7.98278 1.34325C7.55169 1.64525 7.33837 2.11908 7.20071 2.5012C7.14817 2.64705 7.10002 2.80016 7.05661 2.93824C7.0422 2.98405 7.02832 3.02821 7.01496 3.0699C6.95791 3.24804 6.90763 3.39115 6.85248 3.50643C6.45683 4.3334 6.1121 4.8271 5.80935 5.14611C5.51322 5.45815 5.23983 5.6219 4.9473 5.76821C4.71095 5.88641 4.55494 6.12906 4.55491 6.40159L4.55388 13.9125C4.55383 14.3026 4.87002 14.6188 5.26008 14.6188H11.8706C12.2097 14.6188 12.4663 14.5113 12.6519 14.3535C12.7387 14.2797 12.7988 14.2043 12.8387 14.1484C12.8556 14.1248 12.8704 14.1025 12.8786 14.09L12.8813 14.0859L12.8826 14.0839L12.8955 14.0685L12.9142 14.0382C13.5304 13.0414 13.9578 12.247 14.2927 11.2945C14.6745 10.209 14.8679 9.26811 14.9499 8.5347C15.0297 7.82084 15.009 7.25845 14.9246 6.95014C14.805 6.51285 14.5104 6.26112 14.2134 6.13284C13.9385 6.01407 13.661 5.99859 13.5028 5.99836L10.4907 5.95631C10.9296 4.15791 10.648 3.11902 10.452 2.60729ZM1.0008 6.46783C0.981809 6.0652 1.30313 5.72836 1.70621 5.72836H2.75264C3.14266 5.72836 3.45883 6.04454 3.45883 6.43456V13.9442C3.45883 14.3342 3.14266 14.6504 2.75264 14.6504H2.06044C1.68335 14.6504 1.37279 14.3541 1.35502 13.9775L1.0008 6.46783Z"></path></svg>
          点赞
        </div> <div data-v-18fef07e="" class="item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M2.30136 10.1142L2.30019 3.45191C2.30024 2.6778 2.92779 2.05019 3.70191 2.05019H12.3989C13.1731 2.05019 13.8006 2.67785 13.8006 3.452L13.8018 10.1144C13.8017 10.8885 13.1742 11.516 12.4001 11.516H10.1322C9.97329 11.516 9.81862 11.5675 9.69142 11.6629L6.65162 13.9406C6.62173 13.9598 6.58148 13.9444 6.57209 13.91L6.15416 12.0869C6.07758 11.7528 5.78033 11.516 5.43761 11.516H3.70308C2.92893 11.516 2.30136 10.8884 2.30136 10.1142ZM3.70191 1C2.34776 1 1.25 2.09776 1.25 3.45191L1.25117 10.1144C1.25122 11.4685 2.34896 12.5662 3.70308 12.5662H5.18661L5.54953 14.1495L5.55107 14.1558C5.73515 14.9153 6.62879 15.248 7.26458 14.7937L10.2372 12.5662H12.4001C13.7542 12.5662 14.852 11.4684 14.852 10.1142L14.8508 3.45182C14.8508 2.09771 13.753 1 12.3989 1H3.70191ZM4.78612 7.91404C5.35027 7.91404 5.8076 7.45671 5.8076 6.89257C5.8076 6.32842 5.35027 5.87109 4.78612 5.87109C4.22198 5.87109 3.76465 6.32842 3.76465 6.89257C3.76465 7.45671 4.22198 7.91404 4.78612 7.91404ZM8.98631 6.89257C8.98631 7.45671 8.52898 7.91404 7.96483 7.91404C7.40069 7.91404 6.94336 7.45671 6.94336 6.89257C6.94336 6.32842 7.40069 5.87109 7.96483 5.87109C8.52898 5.87109 8.98631 6.32842 8.98631 6.89257ZM11.1484 7.91404C11.7126 7.91404 12.1699 7.45671 12.1699 6.89257C12.1699 6.32842 11.7126 5.87109 11.1484 5.87109C10.5843 5.87109 10.127 6.32842 10.127 6.89257C10.127 7.45671 10.5843 7.91404 11.1484 7.91404Z"></path></svg>
          回复
        </div></div></div> <div data-v-18fef07e="" class="subcomment-wrapper"><!----> <!----></div></div></div><div data-v-18fef07e="" data-v-51124a88="" class="comment" data-jj-helper-comment-id="7062164463097119502"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover popover"><!---->  <a data-v-18fef07e="" href="https://juejin.cn/user/3368559355106503" target="_blank" rel="" class="user-link" data-v-f1a2074a=""><img data-v-248050e4="" data-v-0b45085c="" data-v-18fef07e="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/815f341ad30c42958cc8a15fcefe8976_tplv-k3u1fbpfcp-no-mark_100_100_100_100.awebp" alt="谢什么的头像" class="lazy avatar avatar" loading="lazy"></a></div> <div data-v-18fef07e="" class="content-box"><div data-v-18fef07e="" class="comment-main"><span data-v-18fef07e="" class="delete">
        删除
      </span> <div data-v-18fef07e="" class="user-box"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-18fef07e="" class="popover-box user-popover"><!---->  <a data-v-68a20f0a="" data-v-18fef07e="" href="https://juejin.cn/user/3368559355106503" target="_blank" rel="" class="username username" data-v-f1a2074a=""><span data-v-68a20f0a="" class="name" style="max-width: 128px;">
    谢什么
  </span> <span data-v-3c1a13dc="" data-v-68a20f0a="" blank="true" class="rank"><img data-v-248050e4="" data-v-3c1a13dc="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/05be64d75fee4dbdb290ba23afd21fcf_tplv-k3u1fbpfcp-no-mark_0_0_0_0.awebp" alt="lv-4" class="lazy" title="创作等级" loading="lazy"></span> <img data-v-7b42e73d="" data-v-68a20f0a="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/8c6985e2aa4c06f307ae3734da4b43ac.svg" alt="掘友等级" title="掘友等级" class="jueyou-level"> <!----> </a></div> <!----> <span data-v-18fef07e="" class="position">
          👨🏻‍💻📲 移动开发
        </span> <time data-v-18fef07e="" datetime="1644288301000" title="Tue Feb 08 2022 10:45:01 GMT+0800 (中国标准时间)" class="time">
          1年前
        </time></div> <div data-v-18fef07e="" class="content">大佬尼好，iOS 和 Flutter 双精哇，大胆认识一哈<img class="emoji" draggable="false" "="" loading="lazy" alt="[加好友]" src="./Swift Protocol 背后的故事(理论) - 掘金_files/jj_emoji_78.28310a5.png"></div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        展开
      </div> <div data-v-18fef07e="" class="limit-btn" style="display: none;">
        收起
      </div> <!----> <div data-v-18fef07e="" class="action-box"><div data-v-18fef07e="" class="item dig-item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M8.56162 2.16952C8.66569 2.09661 8.78195 2.06124 8.88247 2.0912C8.97653 2.11923 9.23851 2.25916 9.50988 2.96799C9.64419 3.31881 9.9356 4.2424 9.42155 6.05431C9.29751 6.49152 9.61394 6.95303 10.0926 6.95971L13.492 7.00716L13.492 7.00721H13.4991C13.6049 7.00721 13.7228 7.01986 13.8134 7.05898C13.8544 7.07671 13.8815 7.09639 13.8999 7.116C13.9166 7.13375 13.9368 7.16247 13.9515 7.21636C13.9848 7.33784 14.0228 7.74712 13.9473 8.42262C13.874 9.07857 13.698 9.94479 13.341 10.9598C13.0424 11.8088 12.6601 12.5292 12.0684 13.4879C12.0558 13.5052 12.0462 13.5197 12.0418 13.5265L12.0404 13.5285C12.0292 13.5454 12.0242 13.5531 12.018 13.5618C12.0076 13.5764 12.0018 13.582 11.9983 13.585C11.996 13.587 11.9908 13.5912 11.9777 13.5959C11.9638 13.6009 11.9311 13.61 11.8706 13.61H5.56278L5.56373 6.58489C5.87126 6.41901 6.19881 6.20128 6.54112 5.84059C6.93883 5.42152 7.33789 4.8294 7.76254 3.94183C7.84974 3.75957 7.91745 3.55962 7.97574 3.37762C7.99264 3.32486 8.0087 3.27379 8.02438 3.22393L8.02439 3.22389C8.066 3.09158 8.10495 2.96776 8.14985 2.84312C8.2758 2.49352 8.40247 2.28101 8.56162 2.16952ZM10.452 2.60729C10.1323 1.77209 9.70208 1.28277 9.17063 1.12437C8.64564 0.967902 8.20308 1.18891 7.98278 1.34325C7.55169 1.64525 7.33837 2.11908 7.20071 2.5012C7.14817 2.64705 7.10002 2.80016 7.05661 2.93824C7.0422 2.98405 7.02832 3.02821 7.01496 3.0699C6.95791 3.24804 6.90763 3.39115 6.85248 3.50643C6.45683 4.3334 6.1121 4.8271 5.80935 5.14611C5.51322 5.45815 5.23983 5.6219 4.9473 5.76821C4.71095 5.88641 4.55494 6.12906 4.55491 6.40159L4.55388 13.9125C4.55383 14.3026 4.87002 14.6188 5.26008 14.6188H11.8706C12.2097 14.6188 12.4663 14.5113 12.6519 14.3535C12.7387 14.2797 12.7988 14.2043 12.8387 14.1484C12.8556 14.1248 12.8704 14.1025 12.8786 14.09L12.8813 14.0859L12.8826 14.0839L12.8955 14.0685L12.9142 14.0382C13.5304 13.0414 13.9578 12.247 14.2927 11.2945C14.6745 10.209 14.8679 9.26811 14.9499 8.5347C15.0297 7.82084 15.009 7.25845 14.9246 6.95014C14.805 6.51285 14.5104 6.26112 14.2134 6.13284C13.9385 6.01407 13.661 5.99859 13.5028 5.99836L10.4907 5.95631C10.9296 4.15791 10.648 3.11902 10.452 2.60729ZM1.0008 6.46783C0.981809 6.0652 1.30313 5.72836 1.70621 5.72836H2.75264C3.14266 5.72836 3.45883 6.04454 3.45883 6.43456V13.9442C3.45883 14.3342 3.14266 14.6504 2.75264 14.6504H2.06044C1.68335 14.6504 1.37279 14.3541 1.35502 13.9775L1.0008 6.46783Z"></path></svg>
          点赞
        </div> <div data-v-18fef07e="" class="item"><svg data-v-18fef07e="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-18fef07e="" fill-rule="evenodd" clip-rule="evenodd" d="M2.30136 10.1142L2.30019 3.45191C2.30024 2.6778 2.92779 2.05019 3.70191 2.05019H12.3989C13.1731 2.05019 13.8006 2.67785 13.8006 3.452L13.8018 10.1144C13.8017 10.8885 13.1742 11.516 12.4001 11.516H10.1322C9.97329 11.516 9.81862 11.5675 9.69142 11.6629L6.65162 13.9406C6.62173 13.9598 6.58148 13.9444 6.57209 13.91L6.15416 12.0869C6.07758 11.7528 5.78033 11.516 5.43761 11.516H3.70308C2.92893 11.516 2.30136 10.8884 2.30136 10.1142ZM3.70191 1C2.34776 1 1.25 2.09776 1.25 3.45191L1.25117 10.1144C1.25122 11.4685 2.34896 12.5662 3.70308 12.5662H5.18661L5.54953 14.1495L5.55107 14.1558C5.73515 14.9153 6.62879 15.248 7.26458 14.7937L10.2372 12.5662H12.4001C13.7542 12.5662 14.852 11.4684 14.852 10.1142L14.8508 3.45182C14.8508 2.09771 13.753 1 12.3989 1H3.70191ZM4.78612 7.91404C5.35027 7.91404 5.8076 7.45671 5.8076 6.89257C5.8076 6.32842 5.35027 5.87109 4.78612 5.87109C4.22198 5.87109 3.76465 6.32842 3.76465 6.89257C3.76465 7.45671 4.22198 7.91404 4.78612 7.91404ZM8.98631 6.89257C8.98631 7.45671 8.52898 7.91404 7.96483 7.91404C7.40069 7.91404 6.94336 7.45671 6.94336 6.89257C6.94336 6.32842 7.40069 5.87109 7.96483 5.87109C8.52898 5.87109 8.98631 6.32842 8.98631 6.89257ZM11.1484 7.91404C11.7126 7.91404 12.1699 7.45671 12.1699 6.89257C12.1699 6.32842 11.7126 5.87109 11.1484 5.87109C10.5843 5.87109 10.127 6.32842 10.127 6.89257C10.127 7.45671 10.5843 7.91404 11.1484 7.91404Z"></path></svg>
          1
        </div></div></div> <div data-v-18fef07e="" class="subcomment-wrapper"><!----> <div data-v-7a1becc4="" data-v-18fef07e="" class="sub-comment-list"><div data-v-7a1becc4=""><div data-v-33f5a680="" data-v-7a1becc4="" class="subcomment sub-comment" data-jj-helper-comment-id="7062201255435322120"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-33f5a680="" class="popover-box user-popover"><!---->  <a data-v-33f5a680="" href="https://juejin.cn/user/1556564198033991" target="_blank" rel="" class="user-link" data-v-f1a2074a=""><img data-v-248050e4="" data-v-0b45085c="" data-v-33f5a680="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/ca0dc6fa206bce240c1650e7da6ef516_100x100.awebp" alt="" class="lazy avatar avatar" loading="lazy"></a></div> <div data-v-33f5a680="" class="content-box"><div data-v-33f5a680="" class="content-wrapper"><span data-v-33f5a680="" class="delete">
        删除
      </span> <div data-v-33f5a680="" class="user-box"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-33f5a680="" class="popover-box user-popover"><!---->  <a data-v-68a20f0a="" data-v-33f5a680="" href="https://juejin.cn/user/1556564198033991" target="_blank" rel="" class="username username" data-v-f1a2074a=""><span data-v-68a20f0a="" class="name" style="max-width: 10em;">
    峰之巅
  </span> <!----> <!----> <!----> </a></div> <span data-v-33f5a680="" class="author-badge-text">
          （作者）
        </span> <!----> <time data-v-33f5a680="" datetime="1644296867000" title="Tue Feb 08 2022 13:07:47 GMT+0800 (中国标准时间)" class="time">
          1年前
        </time></div> <div data-v-33f5a680="" class="content">哈哈，好啊！多交流<img class="emoji" draggable="false" "="" loading="lazy" alt="[微笑]" src="./Swift Protocol 背后的故事(理论) - 掘金_files/jj_emoji_1.7d9f699.png"></div> <div data-v-33f5a680="" class="limit-btn" style="display: none;">
        展开
      </div> <div data-v-33f5a680="" class="limit-btn" style="display: none;">
        收起
      </div> <!----> <!----> <div data-v-33f5a680="" class="action-box"><div data-v-33f5a680="" class="item dig-item"><svg data-v-33f5a680="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-33f5a680="" fill-rule="evenodd" clip-rule="evenodd" d="M8.56162 2.16952C8.66569 2.09661 8.78195 2.06124 8.88247 2.0912C8.97653 2.11923 9.23851 2.25916 9.50988 2.96799C9.64419 3.31881 9.9356 4.2424 9.42155 6.05431C9.29751 6.49152 9.61394 6.95303 10.0926 6.95971L13.492 7.00716L13.492 7.00721H13.4991C13.6049 7.00721 13.7228 7.01986 13.8134 7.05898C13.8544 7.07671 13.8815 7.09639 13.8999 7.116C13.9166 7.13375 13.9368 7.16247 13.9515 7.21636C13.9848 7.33784 14.0228 7.74712 13.9473 8.42262C13.874 9.07857 13.698 9.94479 13.341 10.9598C13.0424 11.8088 12.6601 12.5292 12.0684 13.4879C12.0558 13.5052 12.0462 13.5197 12.0418 13.5265L12.0404 13.5285C12.0292 13.5454 12.0242 13.5531 12.018 13.5618C12.0076 13.5764 12.0018 13.582 11.9983 13.585C11.996 13.587 11.9908 13.5912 11.9777 13.5959C11.9638 13.6009 11.9311 13.61 11.8706 13.61H5.56278L5.56373 6.58489C5.87126 6.41901 6.19881 6.20128 6.54112 5.84059C6.93883 5.42152 7.33789 4.8294 7.76254 3.94183C7.84974 3.75957 7.91745 3.55962 7.97574 3.37762C7.99264 3.32486 8.0087 3.27379 8.02438 3.22393L8.02439 3.22389C8.066 3.09158 8.10495 2.96776 8.14985 2.84312C8.2758 2.49352 8.40247 2.28101 8.56162 2.16952ZM10.452 2.60729C10.1323 1.77209 9.70208 1.28277 9.17063 1.12437C8.64564 0.967902 8.20308 1.18891 7.98278 1.34325C7.55169 1.64525 7.33837 2.11908 7.20071 2.5012C7.14817 2.64705 7.10002 2.80016 7.05661 2.93824C7.0422 2.98405 7.02832 3.02821 7.01496 3.0699C6.95791 3.24804 6.90763 3.39115 6.85248 3.50643C6.45683 4.3334 6.1121 4.8271 5.80935 5.14611C5.51322 5.45815 5.23983 5.6219 4.9473 5.76821C4.71095 5.88641 4.55494 6.12906 4.55491 6.40159L4.55388 13.9125C4.55383 14.3026 4.87002 14.6188 5.26008 14.6188H11.8706C12.2097 14.6188 12.4663 14.5113 12.6519 14.3535C12.7387 14.2797 12.7988 14.2043 12.8387 14.1484C12.8556 14.1248 12.8704 14.1025 12.8786 14.09L12.8813 14.0859L12.8826 14.0839L12.8955 14.0685L12.9142 14.0382C13.5304 13.0414 13.9578 12.247 14.2927 11.2945C14.6745 10.209 14.8679 9.26811 14.9499 8.5347C15.0297 7.82084 15.009 7.25845 14.9246 6.95014C14.805 6.51285 14.5104 6.26112 14.2134 6.13284C13.9385 6.01407 13.661 5.99859 13.5028 5.99836L10.4907 5.95631C10.9296 4.15791 10.648 3.11902 10.452 2.60729ZM1.0008 6.46783C0.981809 6.0652 1.30313 5.72836 1.70621 5.72836H2.75264C3.14266 5.72836 3.45883 6.04454 3.45883 6.43456V13.9442C3.45883 14.3342 3.14266 14.6504 2.75264 14.6504H2.06044C1.68335 14.6504 1.37279 14.3541 1.35502 13.9775L1.0008 6.46783Z"></path></svg>
          点赞
        </div> <div data-v-33f5a680="" class="item"><svg data-v-33f5a680="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-33f5a680="" fill-rule="evenodd" clip-rule="evenodd" d="M2.30136 10.1142L2.30019 3.45191C2.30024 2.6778 2.92779 2.05019 3.70191 2.05019H12.3989C13.1731 2.05019 13.8006 2.67785 13.8006 3.452L13.8018 10.1144C13.8017 10.8885 13.1742 11.516 12.4001 11.516H10.1322C9.97329 11.516 9.81862 11.5675 9.69142 11.6629L6.65162 13.9406C6.62173 13.9598 6.58148 13.9444 6.57209 13.91L6.15416 12.0869C6.07758 11.7528 5.78033 11.516 5.43761 11.516H3.70308C2.92893 11.516 2.30136 10.8884 2.30136 10.1142ZM3.70191 1C2.34776 1 1.25 2.09776 1.25 3.45191L1.25117 10.1144C1.25122 11.4685 2.34896 12.5662 3.70308 12.5662H5.18661L5.54953 14.1495L5.55107 14.1558C5.73515 14.9153 6.62879 15.248 7.26458 14.7937L10.2372 12.5662H12.4001C13.7542 12.5662 14.852 11.4684 14.852 10.1142L14.8508 3.45182C14.8508 2.09771 13.753 1 12.3989 1H3.70191ZM4.78612 7.91404C5.35027 7.91404 5.8076 7.45671 5.8076 6.89257C5.8076 6.32842 5.35027 5.87109 4.78612 5.87109C4.22198 5.87109 3.76465 6.32842 3.76465 6.89257C3.76465 7.45671 4.22198 7.91404 4.78612 7.91404ZM8.98631 6.89257C8.98631 7.45671 8.52898 7.91404 7.96483 7.91404C7.40069 7.91404 6.94336 7.45671 6.94336 6.89257C6.94336 6.32842 7.40069 5.87109 7.96483 5.87109C8.52898 5.87109 8.98631 6.32842 8.98631 6.89257ZM11.1484 7.91404C11.7126 7.91404 12.1699 7.45671 12.1699 6.89257C12.1699 6.32842 11.7126 5.87109 11.1484 5.87109C10.5843 5.87109 10.127 6.32842 10.127 6.89257C10.127 7.45671 10.5843 7.91404 11.1484 7.91404Z"></path></svg>
          回复
        </div></div></div> <!----></div></div></div> <!----></div></div></div></div></div> <!----></div></div> <div data-v-1b688d7c="" data-v-1c9ebbff="" class="action-box action-bar" data-v-4b9f9746=""><div data-v-1b688d7c="" class="praise-action action"><div data-v-1b688d7c="" class="action-title-box"><img data-v-1b688d7c="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/00ba359ecd0075e59ffbc3d810af551d.svg"> <span data-v-1b688d7c="" class="action-title">
          46
        </span></div></div> <div data-v-1b688d7c="" class="comment-action action"><div data-v-1b688d7c="" class="action-title-box"><img data-v-1b688d7c="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/336af4d1fafabcca3b770c8ad7a50781.svg"> <span data-v-1b688d7c="" class="action-title">
          5
        </span></div></div> <div data-v-1b688d7c="" class="collect-action action"><div data-v-1b688d7c="" class="action-title-box"><img data-v-1b688d7c="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/3d482c7a948bac826e155953b2a28a9e.svg"> <span data-v-1b688d7c="" class="action-title">收藏</span></div></div> <!----></div></div> <div data-v-1c9ebbff="" data-v-4b9f9746="" class="main-area recommended-area shadow"><div data-v-1c9ebbff="" data-v-4b9f9746="" class="recommended-list-title-wrapper"><div data-v-1c9ebbff="" data-v-4b9f9746="" class="title"><span data-v-1c9ebbff="" data-v-4b9f9746="" class="title-content">相关推荐</span></div></div> <div data-v-3ff8f708="" data-v-57c9777c="" data-v-1c9ebbff="" name="entry-list" tag="div" class="entry-list list recommended-entry-list" data-v-4b9f9746=""><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7028859459363405837" data-original-type="0" data-draft-id="7028849662090018846" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3589280541719383" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        iOS小王
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7028859459363405837" target="_blank" rel="" title="一篇来自喵神的Swift 并发初步。喵神出品，必属精品！" class="title">一篇来自喵神的Swift 并发初步。喵神出品，必属精品！</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7028859459363405837" target="_blank" rel=""><div data-v-5380cbb8="">前言 学如逆水行舟，不进则退。共勉！！今天主要是分享一篇关于Swift并发初步的文章。 原文|地址 一些基本概念 同步和异步 在我们说到线程的执行方式时，同步 (synchronous) 和异步 (a</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">2.4w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            104
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            1
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/e564e2a035d54f628feeca64fb8819be_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="一篇来自喵神的Swift 并发初步。喵神出品，必属精品！" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7028506186743808008" data-original-type="0" data-draft-id="7028383975391854628" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/870468937846638" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        DamonLu
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7028506186743808008" target="_blank" rel="" title="让你的 Swift 代码更 Swift" class="title">让你的 Swift 代码更 Swift</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7028506186743808008" target="_blank" rel=""><div data-v-5380cbb8="">Swift 有很多其他语言所没有的独特的结构和方法，因此很多刚开始接触 Swift 的开发者并没有发挥它本身的优势。 所以，我们就来看一看那些让你的 Swift 代码更 Swift 的写法吧~</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">1.5w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            149
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            7
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/0a6b9147ea4f42f6a53e696aee24037c_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="让你的 Swift 代码更 Swift" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6983904373508145189" data-original-type="0" data-draft-id="6982201612479496228" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/2981531265821416" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        杰出D
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E7%AE%97%E6%B3%95" target="_blank" rel="" class="tag">
        算法
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6983904373508145189" target="_blank" rel="" title="面试了十几个高级前端，竟然连（扁平数据结构转Tree）都写不出来" class="title">面试了十几个高级前端，竟然连（扁平数据结构转Tree）都写不出来</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6983904373508145189" target="_blank" rel=""><div data-v-5380cbb8="">「本文已参与好文召集令活动，点击查看：后端、大前端双赛道投稿，2万元奖池等你挑战！」 前言 招聘季节一般都在金三银四，或者金九银十。最近在这五六月份，陆陆续续面试了十几个高级前端。有一套考察算法的小题</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">26.9w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            3827
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            1962
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/b9459a35f2c64193b5f85d87d9e71cc5_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="面试了十几个高级前端，竟然连（扁平数据结构转Tree）都写不出来" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7034323356459466760" data-original-type="0" data-draft-id="7034312504008409119" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3984285870341288" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        非优秀程序员
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/JavaScript" target="_blank" rel="" class="tag">
        JavaScript
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7034323356459466760" target="_blank" rel="" title="如何用 CSS 中写出超级美丽的阴影效果" class="title">如何用 CSS 中写出超级美丽的阴影效果</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7034323356459466760" target="_blank" rel=""><div data-v-5380cbb8="">「这是我参与11月更文挑战的第7天，活动详情查看：2021最后一次更文挑战」。 在我看来，最好的网站和Web应用程序对它们具有切实的"真实"质量。实现这种质量涉及很多因素，但阴影是一个关键因素。 然而</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">114.4w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            1028
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            67
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7066341701815631909" data-original-type="0" data-draft-id="7066226640119939103" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/405083464942519" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        LabLawliet
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7066341701815631909" target="_blank" rel="" title="iOS防截屏录屏｜担心App内容被截屏泄露吗？这个开源库就是你要的" class="title">iOS防截屏录屏｜担心App内容被截屏泄露吗？这个开源库就是你要的</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7066341701815631909" target="_blank" rel=""><div data-v-5380cbb8="">试了一些主流应用，发现很多都想去防止截图，但是最终实现的效果并不理想，只能在截图完成后去做一些提示，甚至访问相册删除图片。看起来好像是一个不好解决的问题。</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">1.8w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            152
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            39
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/6f1ce38d60bd40fdb992dde72a7341ad_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="iOS防截屏录屏｜担心App内容被截屏泄露吗？这个开源库就是你要的" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903721596354567" data-original-type="0" data-draft-id="6845075771900297223" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3456520286645208" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        小顾Bruce
      </div></a> <div data-v-5380cbb8="" class="date">4年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/IGListKit" target="_blank" rel="" class="tag">
        IGListKit
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903721596354567" target="_blank" rel="" title="抛弃UITableView,让所有列表页不再难构建" class="title">抛弃UITableView,让所有列表页不再难构建</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903721596354567" target="_blank" rel=""><div data-v-5380cbb8="">首先要对点进来的看官说声sorry，我标题党了。😏 虽然抛弃UITableView是不存在的，但是看完这篇文章确实能让90%的列表页抛弃UITableView，让界面易实现易复用。 下面我将以第三人称的叙述方式，通过一个例子比较传统实现和最新实现的手段说明如何让列表页不再难构…</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">1.6w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            196
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            32
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7166063196434857991" data-original-type="0" data-draft-id="7137206160515727397" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/4353721778057997" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        season_zhu
      </div></a> <div data-v-5380cbb8="" class="date">3月前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E6%8E%98%E9%87%91%C2%B7%E9%87%91%E7%9F%B3%E8%AE%A1%E5%88%92" target="_blank" rel="" class="tag">
        掘金·金石计划
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7166063196434857991" target="_blank" rel="" title="Swift：通过Protocol封装统和入参" class="title">Swift：通过Protocol封装统和入参</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7166063196434857991" target="_blank" rel=""><div data-v-5380cbb8="">本篇围绕一个简单的API封装，逐步推演展示出Swift面向协议的封装思路，相信对于日常开发会有不少的启发。</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">5213</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            24
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            1
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/18901b7ad92d47f6a08802c1afbaf6f6_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="Swift：通过Protocol封装统和入参" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7041105468852273166" data-original-type="0" data-draft-id="7041100032824573965" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/4213782311876343" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        会飞的金鱼
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7041105468852273166" target="_blank" rel="" title="Swift高级进阶-Swift编译过程，”SIL代码“，“IR语法”" class="title">Swift高级进阶-Swift编译过程，”SIL代码“，“IR语法”</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7041105468852273166" target="_blank" rel=""><div data-v-5380cbb8="">本文来探索一下 Swift 的编译过程。Swift 的编译过程中使用 Swiftc ，与 Clang 一样，Swiftc 是LLVM编译架构的一个前端。</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">9132</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            22
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            2
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/2ac8524d4d1c4a9797d1542f7bad7c6c_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="Swift高级进阶-Swift编译过程，”SIL代码“，“IR语法”" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903600741679118" data-original-type="0" data-draft-id="6845075419700396040" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/272334611030462" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        Colafornia
      </div></a> <div data-v-5380cbb8="" class="date">4年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/JavaScript" target="_blank" rel="" class="tag">
        JavaScript
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E6%8E%98%E9%87%91%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92" target="_blank" rel="" class="tag">
        掘金翻译计划
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903600741679118" target="_blank" rel="" title="[译] 那些好玩却尚未被 ECMAScript 2017 采纳的提案" class="title">[译] 那些好玩却尚未被 ECMAScript 2017 采纳的提案</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903600741679118" target="_blank" rel=""><div data-v-5380cbb8="">要跟上所有新功能提案的进度并不容易。每年，管理 JavaScript 发展的委员会 TC39 都会收到数十个提案。由于大多数提案都不会到达第二阶段，因此很难确定哪些提案值得关注，哪些提案只是奇思妙想（或者称之为异想天开）。 由于现在越来越多的提案涌现出来，想要只停留在这些特性提…</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">3732</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            70
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            5
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903569322164232" data-original-type="0" data-draft-id="6845075385672024072" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/2242659448272167" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        戴仓薯
      </div></a> <div data-v-5380cbb8="" class="date">5年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903569322164232" target="_blank" rel="" title="我的同事金司机出的 5 道 iOS 多线程“面试题”" class="title">我的同事金司机出的 5 道 iOS 多线程“面试题”</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903569322164232" target="_blank" rel=""><div data-v-5380cbb8="">我有一个同事，他既不姓金，也不是司机，但我们都叫他“金司机”。他跟仓鼠一样是一个 iOS 工程师，至于叫司机的原因就不难想到了…… 为了防止博客被封，在此不举例子。 总之，金司机在这周周会上给组里同事展示了好几道他出的“面试题”，成功淘汰了组里所有同事、甚至包括我们老大，给平淡…</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">9854</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            229
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            35
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7109849826422882312" data-original-type="0" data-draft-id="7109847024392454181" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3897092103223517" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        文如秋雨
      </div></a> <div data-v-5380cbb8="" class="date">8月前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7109849826422882312" target="_blank" rel="" title="Swift实用小册20: Protocol协议的使用" class="title">Swift实用小册20: Protocol协议的使用</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7109849826422882312" target="_blank" rel=""><div data-v-5380cbb8="">持续创作，加速成长！这是我参与「掘金日新计划 · 6 月更文挑战」的第23天，点击查看活动详情。 在本章中，你将学会Protocol协议的使用方法.。Apple官网或者网上分享的教程类文章不同....</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">2952</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            13
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            3
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/756cbe05f2a540ef812fb2d51d207ae8_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="Swift实用小册20: Protocol协议的使用" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7053978539523047437" data-original-type="0" data-draft-id="7052883855530786829" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3544481220795998" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        LevySu
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7053978539523047437" target="_blank" rel="" title="iOS瘦身！一个让50%本地图片消失的方案" class="title">iOS瘦身！一个让50%本地图片消失的方案</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7053978539523047437" target="_blank" rel=""><div data-v-5380cbb8="">安装包瘦身一直是老生常谈的问题，几乎每个大一点的项目都要经历。我们团队也做了很多关于安装包瘦身的事情，通过各种方案在不删减业务的情况下，累计安装包大小减少**100M**+，减少占总包体约**38%+</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">2.8w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            139
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            50
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903885488783374" data-original-type="0" data-draft-id="6845076367613100045" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3720403075993373" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        程序员依扬
      </div></a> <div data-v-5380cbb8="" class="date">3年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E9%9D%A2%E8%AF%95" target="_blank" rel="" class="tag">
        面试
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903885488783374" target="_blank" rel="" title="【1 月最新】前端 100 问：能搞懂 80% 的请把简历给我" class="title">【1 月最新】前端 100 问：能搞懂 80% 的请把简历给我</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903885488783374" target="_blank" rel=""><div data-v-5380cbb8="">半年时间，几千人参与，精选大厂前端面试高频 100 题，这就是「壹题」。 在 2019 年 1 月 21 日这天，「壹题」项目正式开始，在这之后每个工作日都会出一道高频面试题，主要涵盖阿里、腾讯、头条、百度、网易等大公司和常见题型。得益于大家热情参与，现在每道题都有很多答案，提…</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">62.5w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            10892
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            372
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7022130994241077256" data-original-type="0" data-draft-id="7015226486009364510" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/4353721778057997" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        season_zhu
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7022130994241077256" target="_blank" rel="" title="后台返回了一种让我讨厌的JSON" class="title">后台返回了一种让我讨厌的JSON</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7022130994241077256" target="_blank" rel=""><div data-v-5380cbb8="">JSON转Model，明明是个机械活，但是有的时候后台给的接口文档，就是转不出正确的模型，是一件让人非常窝火的事情。 在经受过多次跳坑与爬坑的经历后，我变秃了，也变强了。</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">8734</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            26
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            37
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/7c76f8accdfc4704a50c00b549de7f8b_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="后台返回了一种让我讨厌的JSON" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="7145630021372084232" data-original-type="0" data-draft-id="7145512089539313677" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/2946346894254094" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        jerryfans
      </div></a> <div data-v-5380cbb8="" class="date">5月前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E5%89%8D%E7%AB%AF" target="_blank" rel="" class="tag">
        前端
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/7145630021372084232" target="_blank" rel="" title="可能是全网第一个适配iOS灵动岛的Toast库-JFPopup" class="title">可能是全网第一个适配iOS灵动岛的Toast库-JFPopup</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/7145630021372084232" target="_blank" rel=""><div data-v-5380cbb8="">我编写的一套Swift弹窗组件库一个优雅的Swift弹窗组件-JFPopup。里面适配了一套ToastView，恰逢今年苹果iPhone14 Pro以上系列新出了一套灵动岛的交互风格，所以此文应运而生</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">1.6w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            84
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            42
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/259642c736ca495b917cd4c69b84256a_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="可能是全网第一个适配iOS灵动岛的Toast库-JFPopup" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903458319941646" data-original-type="1" data-draft-id="0" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/1187128285599997" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        江海潮
      </div></a> <div data-v-5380cbb8="" class="date">6年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E6%8E%98%E9%87%91%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92" target="_blank" rel="" class="tag">
        掘金翻译计划
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903458319941646" target="_blank" rel="" title="[译] 在算法横行的时代，仍需要人类把关" class="title">[译] 在算法横行的时代，仍需要人类把关</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903458319941646" target="_blank" rel=""><div data-v-5380cbb8="">算法能解决一切？不见得。</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">2392</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            6
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            评论
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/5469e4bd2fd0b2ee1333.jpeg_tplv-t2oaga2asx-no-mark_300_300_300_200.awebp" alt="[译] 在算法横行的时代，仍需要人类把关" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903680055967757" data-original-type="0" data-draft-id="6845075614945296397" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/1750078239547639" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        York_魚
      </div></a> <div data-v-5380cbb8="" class="date">4年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903680055967757" target="_blank" rel="" title="iOS WebView生成长截图的第三种解决方案" class="title">iOS WebView生成长截图的第三种解决方案</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903680055967757" target="_blank" rel=""><div data-v-5380cbb8="">由于项目需要，新近实现了一个长截图库 SnapshotKit。其中，需要支持 UIWebView、WKWebView 组件生成长截图。为了实现这个特性，查阅了很多资料，同时也做了不同的新奇思路尝试，最终实现了一个新的、取巧的技术方案。 以下主要总结了在“WebView生成长截图…</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">6867</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            105
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            6
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903800331845640" data-original-type="1" data-draft-id="0" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/1926000101569870" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        老司机技术
      </div></a> <div data-v-5380cbb8="" class="date">3年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903800331845640" target="_blank" rel="" title="下一个新项目，我要不要用 Swift 来写?" class="title">下一个新项目，我要不要用 Swift 来写?</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903800331845640" target="_blank" rel=""><div data-v-5380cbb8="">前两天，在我们「老司机 iOS 周报读者群」里面，有个读者问了这样一个问题 “ 今年如果新起一个项目，大家觉得适合用 Swift 来写吗？” 群里马上引起了一个不小的讨论，我想可能是很多 iOS 开发者目前比较困惑的问题，就找了几个周报的编辑，聊了聊他们对于这个问题的看法。</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">8421</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            20
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            30
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6844903778429190158" data-original-type="0" data-draft-id="6845076178454183943" class="entry" style="margin-bottom: 0px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/3298190611456638" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        iOS成长指北
      </div></a> <div data-v-5380cbb8="" class="date">4年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" target="_blank" rel="" class="tag">
        性能优化
      </a><a data-v-5380cbb8="" href="https://juejin.cn/tag/iOS" target="_blank" rel="" class="tag">
        iOS
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 1px solid rgba(228, 230, 235, 0.5);"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6844903778429190158" target="_blank" rel="" title="[译] 用这些 iOS 技巧让你的 APP 性能更佳" class="title">[译] 用这些 iOS 技巧让你的 APP 性能更佳</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6844903778429190158" target="_blank" rel=""><div data-v-5380cbb8="">简要概括: 良好的性能对于提供良好的用户体验至关重要，iOS 用户通常对其应用程序抱有很高的期望。缓慢且无响应的应用可能会让用户放弃使用你的应用，或者更糟糕的是，对应用留下差评。 虽然现代 iOS 硬件功能十分强大，足以处理许多密集和复杂的任务，但是如果你不关心你的 APP 是…</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">1.5w</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            75
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            7
          </span></li> <!----></ul></div> <!----></div> <!----> <!----></div> <!----></li><li data-v-57c9777c="" data-growing-container="true" data-growing-title="entryList" class="item"><div data-v-5380cbb8="" data-v-805bdd7e="" data-v-57c9777c="" data-entry-id="6976986336267862052" data-original-type="0" data-draft-id="6976940277453815838" class="entry" style="margin-bottom: 20px;"><div data-v-5380cbb8="" class="meta-container"><a data-v-5380cbb8="" href="https://juejin.cn/user/405083464942519" target="_blank" rel="" class="user-message"><div data-v-f1a2074a="" data-v-1120b3da="" data-v-5380cbb8="" class="popover-box user-popover"><!---->  
        LabLawliet
      </div></a> <div data-v-5380cbb8="" class="date">1年前</div> <div data-v-5380cbb8="" class="tag_list"><a data-v-5380cbb8="" href="https://juejin.cn/tag/Swift" target="_blank" rel="" class="tag">
        Swift
      </a></div></div> <div data-v-5380cbb8="" class="content-wrapper" style="border-bottom: 0px;"><div data-v-5380cbb8="" class="content-main"><div data-v-5380cbb8="" class="title-row"> <!----> <!----> <!----> <a data-v-5380cbb8="" href="https://juejin.cn/post/6976986336267862052" target="_blank" rel="" title="Swift轻量级网络封装：SwiftyServiceProtocol（适用于混编或纯Swift项目）" class="title">Swift轻量级网络封装：SwiftyServiceProtocol（适用于混编或纯Swift项目）</a></div> <div data-v-5380cbb8="" class="abstract"><a data-v-5380cbb8="" href="https://juejin.cn/post/6976986336267862052" target="_blank" rel=""><div data-v-5380cbb8="">灵感来自Moya。用Swift封装的一个超轻量级Protocol，让你混编或者纯Swift项目更加Swifty~</div></a></div> <ul data-v-5380cbb8="" class="action-list jh-timeline-action-area"><li data-v-5380cbb8="" class="item view"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">624</span></li> <li data-v-5380cbb8="" class="item like"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            3
          </span></li> <li data-v-5380cbb8="" class="item comment"><i data-v-5380cbb8=""></i> <span data-v-5380cbb8="">
            评论
          </span></li> <!----></ul></div> <img data-v-248050e4="" data-v-5380cbb8="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/6018e88c16ab4fc7989a0877d018c0cc_tplv-k3u1fbpfcp-no-mark_300_300_300_200.awebp" alt="Swift轻量级网络封装：SwiftyServiceProtocol（适用于混编或纯Swift项目）" class="lazy thumb" loading="lazy" style=""></div> <!----> <!----></div> <!----></li></div></div> <!----> <div data-v-65597ac0="" data-v-1c9ebbff="" st:block="sidebar" class="sidebar sidebar" data-v-4b9f9746=""><div data-v-71f2d09e="" data-v-bdf6e7fa="" data-v-65597ac0="" class="sidebar-block author-block pure"><a data-v-bdf6e7fa="" href="https://juejin.cn/user/1556564198033991" target="_blank" rel="" class="user-item item" data-v-71f2d09e=""><img data-v-248050e4="" data-v-0b45085c="" data-v-bdf6e7fa="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/ca0dc6fa206bce240c1650e7da6ef516_100x100.awebp" alt="" class="lazy avatar avatar" loading="lazy"> <div data-v-bdf6e7fa="" class="info-box"><a data-v-68a20f0a="" data-v-bdf6e7fa="" href="https://juejin.cn/user/1556564198033991" target="_blank" rel="" class="username"><span data-v-68a20f0a="" class="name" style="max-width: 128px;">
      峰之巅
    </span> <span data-v-3c1a13dc="" data-v-68a20f0a="" blank="true" class="rank"><img data-v-248050e4="" data-v-3c1a13dc="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/05be64d75fee4dbdb290ba23afd21fcf_tplv-k3u1fbpfcp-no-mark_0_0_0_0.awebp" alt="lv-4" class="lazy" title="创作等级" loading="lazy"></span> <!----> <!----> </a> <div data-v-bdf6e7fa="" title="移动开发" class="position">
        移动开发
      </div></div></a> <div data-v-bdf6e7fa="" data-v-71f2d09e="" class="operate-btn"><button data-v-2afc21b6="" data-v-bdf6e7fa="" class="ui-btn follow-btn primary large default cancel attention" st:name="followBtn" data-v-71f2d09e=""><!----> 
    已关注
  </button> <a data-v-11443840="" data-v-bdf6e7fa="" href="https://juejin.cn/notification/im?participantId=1556564198033991" class="im-button im-btn" data-v-71f2d09e=""><!----> <div data-v-11443840="">私信</div></a></div> <div data-v-bdf6e7fa="" data-v-71f2d09e="" class="cut-off"></div>  <div data-v-bdf6e7fa="" data-v-71f2d09e="" class="stat-item item"><svg data-v-bdf6e7fa="" data-v-71f2d09e="" xmlns="http://www.w3.org/2000/svg" width="25" height="26" viewBox="0 0 25 26" class="zan"><g data-v-bdf6e7fa="" data-v-71f2d09e="" fill="none" fill-rule="evenodd" transform="translate(0 .57)"><ellipse data-v-bdf6e7fa="" data-v-71f2d09e="" cx="12.5" cy="12.57" fill="#E1EFFF" rx="12.5" ry="12.57"></ellipse><path data-v-bdf6e7fa="" data-v-71f2d09e="" fill="#7BB9FF" d="M8.596 11.238V19H7.033C6.463 19 6 18.465 6 17.807v-5.282c0-.685.483-1.287 1.033-1.287h1.563zm4.275-4.156A1.284 1.284 0 0 1 14.156 6c.885.016 1.412.722 1.595 1.07.334.638.343 1.687.114 2.361-.207.61-.687 1.412-.687 1.412h3.596c.38 0 .733.178.969.488.239.317.318.728.21 1.102l-1.628 5.645a1.245 1.245 0 0 1-1.192.922h-7.068v-7.889c1.624-.336 2.623-2.866 2.806-4.029z"></path></g></svg> <span data-v-bdf6e7fa="" data-v-71f2d09e="" class="content">
      获得点赞
      <span data-v-bdf6e7fa="" data-v-71f2d09e="" class="count">&nbsp;1,644</span></span></div> <div data-v-bdf6e7fa="" data-v-71f2d09e="" class="stat-item item"><svg data-v-bdf6e7fa="" data-v-71f2d09e="" width="25" height="25" viewBox="0 0 25 25" class="icon stat-view-icon"><g data-v-bdf6e7fa="" data-v-71f2d09e="" fill="none" fill-rule="evenodd"><circle data-v-bdf6e7fa="" data-v-71f2d09e="" cx="12.5" cy="12.5" r="12.5" fill="#E1EFFF"></circle><path data-v-bdf6e7fa="" data-v-71f2d09e="" fill="#7BB9FF" d="M4 12.5S6.917 7 12.75 7s8.75 5.5 8.75 5.5-2.917 5.5-8.75 5.5S4 12.5 4 12.5zm8.75 2.292c1.208 0 2.188-1.026 2.188-2.292 0-1.266-.98-2.292-2.188-2.292-1.208 0-2.188 1.026-2.188 2.292 0 1.266.98 2.292 2.188 2.292z"></path></g></svg> <span data-v-bdf6e7fa="" data-v-71f2d09e="" class="content">
      文章被阅读
      <span data-v-bdf6e7fa="" data-v-71f2d09e="" class="count">&nbsp;128,274</span></span></div> <!----></div> <!----> <a data-v-65597ac0="" href="https://juejin.cn/user/center/signin?from=item" target="" rel=""></a> <div data-v-71f2d09e="" data-v-7571c026="" data-v-65597ac0="" class="sidebar-block wechat-sidebar-block pure"><div data-v-19814543="" data-v-7571c026="" class="wechat-banner" data-v-71f2d09e=""><img data-v-19814543="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/default.640d9a7.png" loading="lazy" class="wechat-img square"></div> <div data-v-7571c026="" data-v-71f2d09e="" title="关闭" class="close-btn"><i data-v-7571c026="" class="byte-icon byte-icon--close-circle" data-v-71f2d09e=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"></path><path d="M24 2c12.2 0 22 9.8 22 22s-9.8 22-22 22S2 36.2 2 24 11.8 2 24 2zm0 4C14.1 6 6 14.1 6 24s8.1 18 18 18 18-8.1 18-18S33.9 6 24 6zm-4.9 10.2l4.9 4.9 5-4.9c.4-.4 1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4l-5 4.9 5 5c.4.4.4 1 0 1.4l-1.4 1.4c-.4.4-1 .4-1.4 0l-5-5-4.9 5c-.4.4-1 .4-1.4 0l-1.4-1.4c-.4-.4-.4-1 0-1.4l4.9-5-4.9-4.9c-.4-.4-.4-1 0-1.4l1.4-1.4c.3-.4 1-.4 1.4 0z"></path></svg></i></div></div> <div data-v-71f2d09e="" data-v-17139de4="" data-v-65597ac0="" class="sidebar-block related-entry-sidebar-block shadow" st:block="relatedEntrySidebarBlock"><div data-v-71f2d09e="" class="block-title">相关文章</div> <div data-v-71f2d09e="" class="block-body"><div data-v-17139de4="" data-v-71f2d09e="" class="entry-list"><a data-v-17139de4="" href="https://juejin.cn/post/6870781128632664071" target="_blank" rel="" st:name="link" title="Swift 利器 -  Protocols 和 Extensions" class="item" data-v-71f2d09e=""><div data-v-17139de4="" class="entry-title">Swift 利器 -  Protocols 和 Extensions</div> <div data-v-17139de4="" class="entry-meta-box"><div data-v-17139de4="" class="entry-meta">21点赞</div> <div data-v-17139de4="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-17139de4="" class="entry-meta">6评论</div></div></a><a data-v-17139de4="" href="https://juejin.cn/post/7087517164046909448" target="_blank" rel="" st:name="link" title="写点 Swift: 为什么你需要使用泛型而不是 protocol" class="item" data-v-71f2d09e=""><div data-v-17139de4="" class="entry-title">写点 Swift: 为什么你需要使用泛型而不是 protocol</div> <div data-v-17139de4="" class="entry-meta-box"><div data-v-17139de4="" class="entry-meta">39点赞</div> <div data-v-17139de4="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-17139de4="" class="entry-meta">9评论</div></div></a><a data-v-17139de4="" href="https://juejin.cn/post/7166063196434857991" target="_blank" rel="" st:name="link" title="Swift：通过Protocol封装统和入参" class="item" data-v-71f2d09e=""><div data-v-17139de4="" class="entry-title">Swift：通过Protocol封装统和入参</div> <div data-v-17139de4="" class="entry-meta-box"><div data-v-17139de4="" class="entry-meta">24点赞</div> <div data-v-17139de4="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-17139de4="" class="entry-meta">1评论</div></div></a><a data-v-17139de4="" href="https://juejin.cn/post/6844904003625566222" target="_blank" rel="" st:name="link" title="函数式思维" class="item" data-v-71f2d09e=""><div data-v-17139de4="" class="entry-title">函数式思维</div> <div data-v-17139de4="" class="entry-meta-box"><div data-v-17139de4="" class="entry-meta">39点赞</div> <div data-v-17139de4="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-17139de4="" class="entry-meta">1评论</div></div></a><a data-v-17139de4="" href="https://juejin.cn/post/6844904079458566152" target="_blank" rel="" st:name="link" title="深度理解 NSURLProtocol" class="item" data-v-71f2d09e=""><div data-v-17139de4="" class="entry-title">深度理解 NSURLProtocol</div> <div data-v-17139de4="" class="entry-meta-box"><div data-v-17139de4="" class="entry-meta">27点赞</div> <div data-v-17139de4="" class="entry-meta">&nbsp;·&nbsp;</div> <div data-v-17139de4="" class="entry-meta">2评论</div></div></a></div></div></div> <div data-v-65597ac0="" class="sticky-block-box"><div data-v-71f2d09e="" data-v-65597ac0="" class="sidebar-block catalog-block catalog-block pure isExpand" style=""><nav data-v-21dfbf50="" class="article-catalog" data-v-71f2d09e="" style=""><div data-v-21dfbf50="" class="catalog-title">目录</div> <div data-v-21dfbf50="" class="catalog-body"><ul data-v-21dfbf50="" class="catalog-list" style="margin-top: 0px;"><li data-v-21dfbf50="" class="item d1 active"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-0" title="Type Metadata" class="catalog-aTag">
      Type Metadata
    </a></div> <!----></li><li data-v-21dfbf50="" class="item d1"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-1" title="Inside Protocol" class="catalog-aTag">
      Inside Protocol
    </a></div> <ul class="sub-list"><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-2" title="Existential Container" class="catalog-aTag">
      Existential Container
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-3" title="Protocol Type Stored Properties" class="catalog-aTag">
      Protocol Type Stored Properties
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-4" title="小结" class="catalog-aTag">
      小结
    </a></div> <!----></li></ul></li><li data-v-21dfbf50="" class="item d1"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-5" title="Generics" class="catalog-aTag">
      Generics
    </a></div> <ul class="sub-list"><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-6" title="No Constraints" class="catalog-aTag">
      No Constraints
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-7" title="Class Constraints" class="catalog-aTag">
      Class Constraints
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-8" title="Protocol Constraints" class="catalog-aTag">
      Protocol Constraints
    </a></div> <!----></li><li class="item d2"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-9" title="Specialization of Generics" class="catalog-aTag">
      Specialization of Generics
    </a></div> <!----></li></ul></li><li data-v-21dfbf50="" class="item d1"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-10" title="小结" class="catalog-aTag">
      小结
    </a></div> <!----></li><li data-v-21dfbf50="" class="item d1"><div class="a-container"><a href="https://juejin.cn/post/7061891716931911687#heading-11" title="参考资料" class="catalog-aTag">
      参考资料
    </a></div> <!----></li></ul></div></nav></div> <!----></div></div> <div data-v-fe76cb40="" data-v-1c9ebbff="" class="article-suspended-panel article-suspended-panel"><svg data-v-fe76cb40="" xmlns="http://www.w3.org/2000/svg" class="" style="display: none;"><symbol data-v-fe76cb40="" id="icon-collect" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M5.24287 18.3845C4.89724 18.5507 4.48229 18.4053 4.31605 18.0596C4.26029 17.9437 4.23783 17.8146 4.25117 17.6866L4.75725 12.8332C4.77762 12.6379 4.71431 12.443 4.583 12.297L1.29207 8.63594C1.03567 8.35071 1.05905 7.91164 1.34428 7.65524C1.43464 7.574 1.54475 7.5179 1.66358 7.49254L6.47789 6.46509C6.66998 6.42409 6.83572 6.30367 6.93407 6.13365L9.39894 1.87248C9.59098 1.54049 10.0158 1.42704 10.3478 1.61907C10.453 1.67992 10.5403 1.76729 10.6012 1.87248L13.0661 6.13365C13.1644 6.30367 13.3301 6.42409 13.5222 6.46509L18.3365 7.49254C18.7116 7.57259 18.9508 7.94155 18.8707 8.31664C18.8454 8.43547 18.7893 8.54557 18.708 8.63594L15.4171 12.297C15.2858 12.443 15.2225 12.6379 15.2429 12.8332L15.7489 17.6866C15.7887 18.0681 15.5117 18.4096 15.1303 18.4493C15.0023 18.4627 14.8732 18.4402 14.7572 18.3845L10.3011 16.2412C10.1108 16.1497 9.8893 16.1497 9.69906 16.2412L5.24287 18.3845Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-comment" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M4.62739 1.25C2.9347 1.25 1.5625 2.6222 1.5625 4.31489L1.56396 12.643C1.56403 14.3356 2.9362 15.7078 4.62885 15.7078H6.48326L6.93691 17.6869L6.93884 17.6948C7.16894 18.6441 8.28598 19.0599 9.08073 18.4921L12.7965 15.7078H15.5001C17.1928 15.7078 18.565 14.3355 18.565 12.6428L18.5635 4.31477C18.5635 2.62213 17.1913 1.25 15.4986 1.25H4.62739ZM5.98265 9.89255C6.68783 9.89255 7.2595 9.32089 7.2595 8.61571C7.2595 7.91053 6.68783 7.33887 5.98265 7.33887C5.27747 7.33887 4.70581 7.91053 4.70581 8.61571C4.70581 9.32089 5.27747 9.89255 5.98265 9.89255ZM9.95604 9.89255C10.6612 9.89255 11.2329 9.32089 11.2329 8.61571C11.2329 7.91053 10.6612 7.33887 9.95604 7.33887C9.25086 7.33887 8.6792 7.91053 8.6792 8.61571C8.6792 9.32089 9.25086 9.89255 9.95604 9.89255ZM15.2124 8.61571C15.2124 9.32089 14.6407 9.89255 13.9355 9.89255C13.2304 9.89255 12.6587 9.32089 12.6587 8.61571C12.6587 7.91053 13.2304 7.33887 13.9355 7.33887C14.6407 7.33887 15.2124 7.91053 15.2124 8.61571Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-zan" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M13.0651 3.25923C12.6654 2.21523 12.1276 1.60359 11.4633 1.40559C10.8071 1.21 10.2539 1.48626 9.97848 1.67918C9.43962 2.05668 9.17297 2.64897 9.0009 3.12662C8.93522 3.30893 8.87504 3.50032 8.82077 3.67291L8.82077 3.67292C8.80276 3.73019 8.78541 3.78539 8.76872 3.8375C8.6974 4.06017 8.63455 4.23905 8.56561 4.38315C8.07104 5.41687 7.64014 6.034 7.2617 6.43277C6.89154 6.8228 6.5498 7.0275 6.18413 7.21038C5.8887 7.35813 5.69369 7.66144 5.69365 8.00211L5.69237 17.3908C5.6923 17.8783 6.08754 18.2736 6.57511 18.2736H14.8382C15.2621 18.2736 15.5829 18.1393 15.8149 17.9421C15.9234 17.8497 15.9985 17.7554 16.0484 17.6856C16.0695 17.6561 16.088 17.6282 16.0983 17.6126L16.1017 17.6075L16.1033 17.6051L16.1194 17.5857L16.1428 17.5478C16.913 16.3019 17.4472 15.3088 17.8659 14.1183C18.3431 12.7613 18.5849 11.5853 18.6874 10.6685C18.7871 9.77617 18.7612 9.07318 18.6558 8.68779C18.5062 8.14118 18.138 7.82653 17.7668 7.66617C17.4231 7.51771 17.0763 7.49836 16.8785 7.49807L13.1134 7.44551C13.662 5.19751 13.31 3.89889 13.0651 3.25923ZM1.251 8.0848C1.22726 7.5815 1.62891 7.16046 2.13277 7.16046H3.4408C3.92832 7.16046 4.32354 7.55568 4.32354 8.04321V17.4303C4.32354 17.9178 3.92832 18.313 3.4408 18.313H2.57554C2.10419 18.313 1.71599 17.9427 1.69378 17.4718L1.251 8.0848Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-share" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M10.4167 6.40399C5.35406 6.40399 1.25 10.5675 1.25 15.7035C1.25 16.0225 1.28448 16.4512 1.35344 16.9898C1.36807 17.1039 1.47243 17.1846 1.58655 17.17C1.6483 17.1621 1.70328 17.127 1.73643 17.0743L1.86865 16.8676C1.99553 16.6731 2.10644 16.5147 2.20137 16.3925C3.69554 14.4692 6.13777 13.3823 9.35515 13.3378L10.4167 13.3364V17.0757C10.4167 17.3101 10.6086 17.5 10.8453 17.5C10.959 17.5 11.068 17.4553 11.1483 17.3757L18.145 10.45C18.3961 10.2015 18.3961 9.79853 18.145 9.55L11.1483 2.62426C10.981 2.45858 10.7096 2.45858 10.5422 2.62426C10.4618 2.70383 10.4167 2.81174 10.4167 2.92426V6.40399Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-report" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M10.8389 1.89381C11.0873 2.03868 11.2939 2.24532 11.4388 2.49366L18.9369 15.0065C19.4007 15.8015 19.1322 16.8221 18.3371 17.2859C18.0822 17.4346 17.7924 17.5129 17.4973 17.5129H2.50041C1.57993 17.5129 0.83374 16.7667 0.83374 15.8462C0.83374 15.5512 0.912088 15.2614 1.06078 15.0065L8.5595 2.49366C9.0233 1.69857 10.0438 1.43001 10.8389 1.89381ZM10.3118 13.3459C10.6283 13.3459 10.8848 13.6025 10.8848 13.9189V14.4918C10.8848 14.8082 10.6283 15.0647 10.3118 15.0647H9.73893C9.42252 15.0647 9.16602 14.8082 9.16602 14.4918V13.9189C9.16602 13.6025 9.42252 13.3459 9.73893 13.3459H10.3118ZM10.8356 7.09513C10.8356 6.86502 10.6491 6.67847 10.419 6.67847H9.58512C9.35501 6.67847 9.16846 6.86502 9.16846 7.09513V12.0956C9.16846 12.3257 9.35501 12.5123 9.58512 12.5123H10.419C10.6491 12.5123 10.8356 12.3257 10.8356 12.0956V7.09513Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-immerse" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M0.25 1C0.25 0.585786 0.585786 0.25 1 0.25H4C4.41421 0.25 4.75 0.585786 4.75 1C4.75 1.41421 4.41421 1.75 4 1.75H1.75V4C1.75 4.41421 1.41421 4.75 1 4.75C0.585786 4.75 0.25 4.41421 0.25 4V1ZM0.25 19C0.25 19.4142 0.585786 19.75 1 19.75H4C4.41421 19.75 4.75 19.4142 4.75 19C4.75 18.5858 4.41421 18.25 4 18.25H1.75V16C1.75 15.5858 1.41421 15.25 1 15.25C0.585786 15.25 0.25 15.5858 0.25 16V19ZM19 0.25C19.4142 0.25 19.75 0.585786 19.75 1V4C19.75 4.41421 19.4142 4.75 19 4.75C18.5858 4.75 18.25 4.41421 18.25 4V1.75H16C15.5858 1.75 15.25 1.41421 15.25 1C15.25 0.585786 15.5858 0.25 16 0.25H19ZM19.75 19C19.75 19.4142 19.4142 19.75 19 19.75H16C15.5858 19.75 15.25 19.4142 15.25 19C15.25 18.5858 15.5858 18.25 16 18.25H18.25V16C18.25 15.5858 18.5858 15.25 19 15.25C19.4142 15.25 19.75 15.5858 19.75 16V19ZM7 5C5.89543 5 5 5.89543 5 7V13C5 14.1046 5.89543 15 7 15H13C14.1046 15 15 14.1046 15 13V7C15 5.89543 14.1046 5 13 5H7Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-wechat" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M13.5578 5.34061C12.0476 2.85722 8.90911 1.73257 6.11813 2.05358C4.56413 2.23231 3.0449 2.85861 1.88463 3.92471C1.00689 4.72863 0.354462 5.78486 0.109889 6.95889C-0.187864 8.37395 0.125815 9.85314 0.957723 11.0298C1.28982 11.4994 1.68479 11.9193 2.11951 12.2941C2.25136 12.4079 2.38694 12.5172 2.52543 12.6228C2.59301 12.6742 2.66115 12.7249 2.73011 12.7745C2.74195 12.7831 2.75392 12.7902 2.76512 12.7969C2.80389 12.8201 2.83351 12.8378 2.81653 12.8887L2.67458 13.3177C2.53986 13.7252 2.40492 14.1325 2.26998 14.5399C2.22084 14.6883 2.17169 14.8366 2.12256 14.985L2.61572 14.7368C2.85714 14.6151 3.09863 14.4935 3.34012 14.3719C3.58099 14.2507 3.82186 14.1294 4.06266 14.0081L4.40902 13.8337C4.42474 13.8257 4.44104 13.8164 4.45775 13.8069C4.51759 13.7728 4.58265 13.7356 4.64501 13.7481C4.76613 13.7723 4.88708 13.7972 5.00801 13.8221C5.08094 13.8372 5.15386 13.8522 5.22681 13.867C6.06287 14.0373 6.88508 14.1348 7.73859 14.0675C7.4486 13.0669 7.44915 12.0016 7.7559 11.0045C8.09853 9.88624 8.81438 8.89831 9.74448 8.19773C11.0171 7.23915 12.6431 6.81493 14.2212 6.99199C14.0895 6.4081 13.8688 5.85148 13.5578 5.34061ZM4.77922 5.02147C4.28094 5.02147 3.71299 5.35514 3.71299 5.90829C3.71299 6.46088 4.28066 6.79844 4.77922 6.79844C5.29233 6.79844 5.66293 6.42291 5.66293 5.90829C5.66293 5.39311 5.29205 5.02147 4.77922 5.02147ZM10.6158 5.90829C10.6158 6.42444 10.2434 6.79844 9.7296 6.79844C9.23076 6.79844 8.66641 6.46032 8.66641 5.90829C8.66641 5.3557 9.23104 5.02147 9.7296 5.02147C10.2431 5.02147 10.6158 5.39158 10.6158 5.90829ZM17.7911 8.53846C15.3552 6.80489 11.734 6.93368 9.53048 9.01108C8.77779 9.72181 8.22909 10.6485 8.04061 11.6744C7.78288 13.0799 8.22536 14.5441 9.17304 15.605C10.0674 16.6063 11.2889 17.2564 12.5986 17.5166C13.4216 17.6806 14.2559 17.6931 15.0799 17.5344C15.2863 17.4948 15.4911 17.4481 15.6954 17.3986C15.7826 17.3774 15.8697 17.3559 15.9568 17.334C15.9655 17.3319 15.9784 17.3272 15.9934 17.3219C16.0359 17.3068 16.0949 17.2858 16.118 17.2984C16.2476 17.3695 16.3771 17.4408 16.5066 17.5122L17.0557 17.8142L17.0577 17.8153L17.0598 17.8164C17.3912 17.9986 17.7227 18.1809 18.054 18.3634C17.9748 18.0977 17.895 17.832 17.8153 17.5664L17.8146 17.5641L17.6749 17.0981L17.5814 16.7863L17.5332 16.6257C17.5159 16.5675 17.5927 16.5183 17.6556 16.4779C17.6753 16.4653 17.6937 16.4535 17.7073 16.4426C18.0608 16.1622 18.3952 15.8558 18.6963 15.5191C19.1832 14.9747 19.5895 14.3498 19.8161 13.6505C20.0122 13.039 20.0488 12.392 19.9377 11.7604C19.7098 10.438 18.8643 9.30511 17.7911 8.53846ZM15.2396 11.0049C15.1595 10.6088 15.5334 10.1787 15.931 10.1787C16.3063 10.1787 16.7409 10.3931 16.8096 10.7989C16.8724 11.1695 16.556 11.4696 16.227 11.5617C15.8032 11.6802 15.3326 11.4649 15.2396 11.0049ZM12.0348 10.1787C11.6369 10.1787 11.2573 10.6064 11.3385 11.0049C11.4325 11.4667 11.9081 11.68 12.3327 11.5617C12.6626 11.4696 12.9753 11.1695 12.9134 10.7989C12.8453 10.3914 12.4112 10.1787 12.0348 10.1787Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-weibo" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M-0.000244141 13.0984C-0.000244141 8.70757 6.6145 3.5004 9.18008 4.57052C10.1717 4.98415 9.97381 6.1693 9.85415 6.88576C9.8069 7.16863 9.77186 7.37844 9.82705 7.43887C9.92921 7.55074 10.2955 7.42054 10.7994 7.2414C11.8362 6.87286 13.4557 6.2972 14.5566 7.19617C15.2665 7.77576 14.9657 8.72382 14.7905 9.27603C14.7289 9.4701 14.6829 9.61528 14.7017 9.6784C14.741 9.81053 14.9858 9.91133 15.317 10.0477C15.926 10.2984 16.8269 10.6692 17.2784 11.5759C18.3716 13.7713 15.2036 18.2504 8.62234 18.2504C3.25024 18.2504 -0.000244141 15.6688 -0.000244141 13.0984ZM8.45309 17.057C11.7733 16.7393 14.2944 14.7397 14.0842 12.5908C13.874 10.4418 11.012 8.95732 7.69179 9.27503C4.37159 9.59274 1.85045 11.5924 2.06068 13.7413C2.2709 15.8902 5.13288 17.3747 8.45309 17.057Z"></path><path data-v-fe76cb40="" fill-rule="evenodd" clip-rule="evenodd" d="M10.7098 12.7012C11.1162 14.1374 10.0604 15.6852 8.35157 16.1581C6.64275 16.6311 4.92801 15.8502 4.5216 14.4139C4.11518 12.9777 5.171 11.4299 6.87982 10.957C8.58865 10.484 10.3034 11.2649 10.7098 12.7012ZM7.67026 13.6265C7.89619 14.1072 7.61751 14.7092 7.04779 14.9711C6.47808 15.2331 5.83308 15.0558 5.60715 14.5751C5.38122 14.0945 5.6599 13.4925 6.22962 13.2306C6.79933 12.9686 7.44433 13.1459 7.67026 13.6265ZM8.41746 13.3766C8.63945 13.2745 8.74804 13.0399 8.66001 12.8526C8.57197 12.6654 8.32065 12.5963 8.09866 12.6984C7.87667 12.8004 7.76808 13.035 7.85612 13.2223C7.94415 13.4095 8.19547 13.4786 8.41746 13.3766Z"></path><path data-v-fe76cb40="" d="M13.648 3.54836C13.9523 3.47388 14.2712 3.43418 14.6004 3.43418C16.7813 3.43418 18.5492 5.18267 18.5492 7.33955C18.5492 7.81593 18.4633 8.27085 18.3066 8.69104C18.168 9.06261 18.3602 9.47493 18.7359 9.61199C19.1116 9.74904 19.5285 9.55894 19.6671 9.18737C19.8822 8.61063 19.9993 7.98781 19.9993 7.33955C19.9993 4.3906 17.5822 2 14.6004 2C14.1528 2 13.717 2.05403 13.2996 2.15619C12.9109 2.25133 12.6738 2.64011 12.77 3.02455C12.8662 3.40899 13.2593 3.6435 13.648 3.54836Z"></path><path data-v-fe76cb40="" d="M14.2887 6.05162C14.388 6.02824 14.4923 6.01569 14.6004 6.01569C15.3397 6.01569 15.939 6.6084 15.939 7.33955C15.939 7.49914 15.9108 7.65062 15.8596 7.7904C15.7232 8.16277 15.9179 8.57396 16.2944 8.70881C16.6709 8.84366 17.0867 8.65112 17.2231 8.27875C17.3307 7.98466 17.3891 7.66805 17.3891 7.33955C17.3891 5.81633 16.1406 4.58152 14.6004 4.58152C14.3784 4.58152 14.1614 4.60734 13.9529 4.65643C13.5633 4.74813 13.3227 5.1348 13.4154 5.52008C13.5082 5.90535 13.8991 6.14333 14.2887 6.05162Z"></path></symbol><symbol data-v-fe76cb40="" id="icon-qq" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path data-v-fe76cb40="" d="M11.8841 17.1943C11.1815 17.1943 10.5625 17.2136 10.0541 17.26C9.44625 17.2112 8.8365 17.1898 8.22671 17.1956C6.20498 17.1956 4.40588 17.9613 4.40588 18.5263C4.40588 19.0681 5.89998 19.0076 7.91657 18.987C8.64426 18.985 9.3699 18.9096 10.0824 18.7618C10.6796 18.8879 11.4079 18.9677 12.193 18.9741C14.2095 18.9947 15.7024 19.0552 15.7024 18.5173C15.7024 17.9549 13.9045 17.1943 11.8841 17.1943V17.1943Z"></path><path data-v-fe76cb40="" d="M16.9138 11.6311C16.5346 10.6112 16.1212 9.60428 15.6745 8.61206C15.6951 8.37141 15.7054 8.12818 15.7054 7.8811C15.7054 4.08086 13.7622 1 10.0649 1C6.36759 1 4.42307 4.08086 4.42307 7.8811C4.42307 8.11274 4.43208 8.34052 4.45138 8.56573C3.99804 9.5756 3.57913 10.6006 3.19536 11.6389C2.41678 13.7494 2.38203 15.6566 2.65357 15.7982C2.84661 15.8985 3.54797 15.1611 4.21845 13.9669C4.66115 16.7801 6.53102 18.8842 10.0649 18.8842C13.5871 18.8842 15.457 16.7916 15.9074 13.99C16.5728 15.1611 17.2664 15.8818 17.4569 15.7814C17.7284 15.6399 17.6937 13.7365 16.9138 11.6311V11.6311Z"></path><path data-v-fe76cb40="" d="M8.5542 3.2522C8.00598 3.26507 7.57358 3.90981 7.58902 4.69739C7.60447 5.48369 8.06132 6.11299 8.60954 6.1027C9.15776 6.0924 9.59016 5.44637 9.57472 4.65879C9.56056 3.87249 9.10243 3.24319 8.5542 3.25348V3.2522ZM11.5862 3.26764C11.0315 3.25734 10.5695 3.88278 10.5541 4.66651C10.5386 5.44895 10.9749 6.0924 11.5308 6.1027C12.0842 6.11299 12.5475 5.48755 12.5629 4.70512C12.5784 3.92139 12.1408 3.27794 11.5862 3.26764V3.26764Z"></path><path data-v-fe76cb40="" d="M13.6704 9.57861C12.5971 9.76521 11.354 9.87074 10.0285 9.87074C8.7287 9.87074 7.50742 9.76779 6.44959 9.58762C5.71605 10.4962 5.65942 11.8307 5.65942 13.3184C5.65942 16.0505 7.20371 18.2665 10.0645 18.2665C12.924 18.2665 14.4696 16.0505 14.4696 13.3184C14.4696 11.8243 14.4104 10.4859 13.6704 9.57861V9.57861Z"></path><path data-v-fe76cb40="" d="M10.0628 6.56616C8.14273 6.56616 6.58557 6.95223 6.58557 7.26238C6.58557 7.57124 8.62146 8.42188 10.0641 8.42188C11.5054 8.42188 13.5413 7.55065 13.5413 7.26238C13.5413 6.97411 11.9842 6.56745 10.0641 6.56745L10.0628 6.56616Z"></path><path data-v-fe76cb40="" d="M15.6744 8.6121L15.6757 8.59151C14.264 9.05866 12.2718 9.35078 10.0648 9.35078C7.8513 9.35078 5.85402 9.05737 4.441 8.58765C4.14115 9.25684 3.85546 9.93375 3.58521 10.6171C4.45644 10.9054 5.43192 11.1357 6.48332 11.2992V13.8858C6.48332 13.8858 7.22715 14.0235 7.92981 14.0531C8.42784 14.0737 8.95676 13.9888 8.95676 13.9888V11.5398C9.32095 11.5565 9.6903 11.5656 10.0635 11.5656C12.4919 11.5656 14.7311 11.2142 16.5251 10.6222C16.2566 9.94593 15.9729 9.27571 15.6744 8.6121V8.6121Z"></path><path data-v-fe76cb40="" d="M8.87981 4.24829C8.63787 4.24829 8.44226 4.53656 8.44226 4.89174C8.44226 5.24693 8.63787 5.5352 8.87981 5.5352C9.12046 5.5352 9.31736 5.24693 9.31736 4.89174C9.31736 4.53656 9.12046 4.24829 8.87981 4.24829V4.24829ZM12.0997 4.65624C12.0997 4.65624 11.9246 4.41816 11.4819 4.48122C11.0444 4.54428 10.8745 4.83126 10.8423 4.86215C10.8423 4.86215 10.7381 5.0243 10.8115 5.12467C10.8848 5.22505 11.0174 5.06676 11.0174 5.06676C11.0174 5.06676 11.2194 4.78364 11.4806 4.77335C11.6273 4.76349 11.7729 4.80489 11.8925 4.89046C11.8925 4.89046 12.0211 4.99856 12.0984 4.89046C12.1769 4.78364 12.0997 4.65624 12.0997 4.65624V4.65624Z"></path></symbol></svg> <div data-v-fe76cb40="" badge="46" class="panel-btn with-badge"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon icon-zan"><use data-v-0f838daa="" xlink:href="#icon-zan"></use></svg></div> <div data-v-fe76cb40="" badge="5" class="panel-btn with-badge"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon icon-comment"><use data-v-0f838daa="" xlink:href="#icon-comment"></use></svg></div> <div data-v-fe76cb40="" class="panel-btn"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon icon-collect"><use data-v-0f838daa="" xlink:href="#icon-collect"></use></svg> <div data-v-d0b73df6="" data-v-fe76cb40="" class="collect-popover"><div data-v-d0b73df6="" class="title">收藏成功！</div> <div data-v-d0b73df6="" class="sub-title">
    已添加到「」，
    <span data-v-d0b73df6="" class="modify-btn">点击更改</span></div></div> <!----> <!----></div> <div data-v-fe76cb40="" class="share-btn panel-btn"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon icon-share"><use data-v-0f838daa="" xlink:href="#icon-share"></use></svg> <div data-v-fe76cb40="" class="share-popup"><ul data-v-fe76cb40=""><li data-v-fe76cb40="" class="share-item wechat"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon share-icon icon-wechat"><use data-v-0f838daa="" xlink:href="#icon-wechat"></use></svg> <span data-v-fe76cb40="" class="share-item-title">微信</span> <div data-v-fe76cb40="" class="wechat-qrcode"><img data-v-fe76cb40="" src="https://juejin.cn/post/7061891716931911687" class="wechat-qrcode-img" style="display: none;"> <span data-v-fe76cb40="" class="wechat-qrcode-title">微信扫码分享</span></div></li> <li data-v-fe76cb40="" class="share-item weibo"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon share-icon icon-weibo"><use data-v-0f838daa="" xlink:href="#icon-weibo"></use></svg> <span data-v-fe76cb40="" class="share-item-title">新浪微博</span></li> <li data-v-fe76cb40="" class="share-item qq"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon share-icon icon-qq"><use data-v-0f838daa="" xlink:href="#icon-qq"></use></svg> <span data-v-fe76cb40="" class="share-item-title">QQ</span></li></ul></div></div> <div data-v-fe76cb40="" class="divider"></div> <div data-v-fe76cb40="" class="panel-btn"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon icon-report"><use data-v-0f838daa="" xlink:href="#icon-report"></use></svg></div> <span data-v-fe76cb40="" class="tooltip"><span class="byte-tooltip__wrapper"><div data-v-fe76cb40="" class="panel-btn"><svg data-v-0f838daa="" data-v-fe76cb40="" class="sprite-icon icon-immerse"><use data-v-0f838daa="" xlink:href="#icon-immerse"></use></svg></div></span></span></div></div> <!----></main> <!----></div> <!----> <div class="global-component-box"><div data-v-262fe4c6="" class="alert-list alert-list"></div> <div data-v-0b2d23d8="" class="suspension-panel suspension-panel"><!----> <button data-v-0b2d23d8="" title="回到顶部" class="btn to-top-btn" style="display: none;"><svg data-v-0b2d23d8="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class=""><path data-v-0b2d23d8="" fill-rule="evenodd" clip-rule="evenodd" d="M2.75 1C2.33579 1 2 1.33579 2 1.75C2 2.16421 2.33579 2.5 2.75 2.5H13.25C13.6642 2.5 14 2.16421 14 1.75C14 1.33579 13.6642 1 13.25 1H2.75ZM7.24407 3.87287C7.64284 3.41241 8.35716 3.41241 8.75593 3.87287L13.0622 8.84535C13.6231 9.49299 13.163 10.5 12.3063 10.5H10V14C10 14.5523 9.55228 15 9 15H7C6.44772 15 6 14.5523 6 14V10.5H3.69371C2.83696 10.5 2.37691 9.49299 2.93778 8.84535L7.24407 3.87287Z" fill="#8A919F"></path></svg></button> <button data-v-0b2d23d8="" title="建议反馈" class="btn meiqia-btn" style=""><svg data-v-0b2d23d8="" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-feedback"><path data-v-0b2d23d8="" fill-rule="evenodd" clip-rule="evenodd" d="M1.8252 4.002C1.8252 2.80032 2.79935 1.82617 4.00102 1.82617H12.001C13.2027 1.82617 14.1768 2.80032 14.1768 4.002V9.71628C14.1768 10.918 13.2027 11.8921 12.001 11.8921H9.43308L6.92709 14.1281C6.4455 14.5578 5.68234 14.216 5.68234 13.5706V11.8921H4.00102C2.79934 11.8921 1.8252 10.918 1.8252 9.71628V4.002ZM11.2414 7.86753C11.3826 7.65526 11.3249 7.36878 11.1126 7.22764C10.9004 7.08651 10.6139 7.14417 10.4728 7.35643C9.94042 8.15705 9.03153 8.68309 7.99997 8.68309C6.96841 8.68309 6.05952 8.15705 5.52719 7.35643C5.38605 7.14417 5.09957 7.08651 4.88731 7.22764C4.67504 7.36878 4.61738 7.65526 4.75852 7.86753C5.45467 8.91452 6.64645 9.60617 7.99997 9.60617C9.35349 9.60617 10.5453 8.91452 11.2414 7.86753Z" fill="#1E80FF"></path></svg></button></div> <!----> <!----> <!----> <!----> <!----></div> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----></div></div></div><script>window.__NUXT__=(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F){q.loading=a;q.skeleton=b;q.cursor=f;q.data=[];q.total=d;q.hasMore=b;return {layout:"default",data:[{renderPost:b,additionalDataUseCSR:b}],fetch:[{bdPageUrlForNav:"https:\u002F\u002Fbd.juejin.cn?utm_campaign=bd&utm_source=web&utm_medium=nav",queryString:e,isShowUserDropdownList:a,isShowAddMoreList:a,isFocus:a,isPhoneMenuShow:a,visibleBadge:a,placeholder:e,hiddenProperty:"hidden",searchHistoryVisible:a,searchHistoryItems:[],tabBadge:c,isChangePlaceholder:b,showMallBridge:a},{articleBanner:{url:"https:\u002F\u002Fjuejin.cn\u002Fextension\u002F?utm_source=standalone&utm_medium=post&utm_campaign=extension_promotion",title:"安装掘金浏览器插件",content:"多内容聚合浏览、多引擎快捷搜索、多工具便捷提效、多模式随心畅享，你想要的，这里都有！"},showExtension:b}],error:c,state:{view:{activityIndex:{activityList:[],pageInfo:{hasNextPage:a,endCursor:e},afterPosition:e,activityListIsLoading:b,activityListIsError:a,userActivityList:[],placeholder:e,actionType:{FETCH:"@\u002Fview\u002Factivity-index\u002FFETCH",FETCH_RECOMMEND_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_RECOMMEND_LIST",RESET_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FRESET_ACTIVITY_LIST",FETCH_USER_ACTIVITY_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_USER_ACTIVITY_LIST",FETCH_NEW_COUNT:"@\u002Fview\u002Factivity-index\u002FFETCH_NEW_COUNT",DELETE_ACTIVITY:"@\u002Fview\u002Factivity-index\u002FDELETE_ACTIVITY",TOGGLE_FOLLOW_USER:"@\u002Fview\u002Factivity-index\u002FTOGGLE_FOLLOW_USER",FETCH_ENTRY_COMMENT_LIST:"@\u002Fview\u002Factivity-index\u002FFETCH_ENTRY_COMMENT_LIST",UPDATE_LIST_LOADING:"@\u002Fview\u002Factivity-index\u002FUPDATE_LIST_LOADING",RESET:"@\u002Fview\u002Factivity-index\u002FRESET"},hotList:{list:[],after:e,loading:a,hasNextPage:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fhot-list\u002FRESET"}},sidebar:{bannerList:[],actionType:{RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FUPDATE_STATE",FETCH_BANNER:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002FFETCH_BANNER"},recommend:{pageSize:h,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-topic-list\u002FRESET"},after:d},followed:{pageSize:h,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Ffollowed-topic-list\u002FRESET"},after:d},recommendPin:{list:[],after:e,loading:a,hasNextPage:b,actionType:{UPDATE_STATE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FFETCH",RESET:"@\u002Fview\u002Factivity-index\u002Fsidebar\u002Frecommend-pin-list\u002FRESET"}}},topicPinList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FUPDATE",FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FFETCH_MORE",RESET:"@\u002Fview\u002Factivity-index\u002Ftopic-pin-list\u002FRESET"},topicId:e,navList:[{type:k,name:k,title:"推荐 ",id:k},{type:m,name:m,title:"热门 ",id:m},{type:o,name:o,title:"关注 ",id:o},{type:i,name:"opensource",title:"开源推荐 ",id:"5c09ea2b092dcb42c740fe73"},{type:i,name:"recruitment",title:"内推招聘",id:"5abb61e1092dcb4620ca3322"},{type:i,name:"dating",title:"掘金相亲",id:"5abcaa67092dcb4620ca335c"},{type:i,name:"slacking",title:"上班摸鱼",id:"5c106be9092dcb2cc5de7257"},{type:i,name:"app",title:"应用安利",id:"5b514af1092dcb61bd72800d"},{type:i,name:"tool",title:"开发工具",id:"5abb67d2092dcb4620ca3324"},{type:i,name:"news",title:"New资讯",id:"5c46a17f092dcb4737217152"}],sortType:p}},search:{search_result_from:d,query:e,list:[],linkList:[],loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fsearch\u002FFETCH",FETCH_MORE:"@\u002Fview\u002Fsearch\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fsearch\u002FRESET"}},columnIndex:{list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002Flist\u002FRESET"},sort:n,category:"all"},hotList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FUPDATE",FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FFETCH_MORE",RESET:"@\u002Fview\u002FcolumnIndex\u002FhotList\u002FRESET"}}},timelineIndex:{tdkTemplates:[],categoryNavList:[],tagNavList:[],splitTagList:[],timelineAdList:[],list:[],sort:p,category:k,categoryId:e,tagId:e,tag:"全部",actionType:{FETCH_TIMELINE_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TIMELINE_LIST",FETCH_CATEGORY_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_CATEGORY_LIST",FETCH_TAG_LIST:"@\u002Fview\u002FtimelineIndex\u002FFETCH_TAG_LIST",DELETE_ENTRY:"@\u002Fview\u002FtimelineIndex\u002FDELETE_ENTRY",DELETE_USER_ENTRIES:"@\u002Fview\u002FtimelineIndex\u002FDELETE_USER_ENTRIES",DELETE_TAG_ENTRIES:"@\u002Fview\u002FtimelineIndex\u002FDELETE_TAG_ENTRIES",FETCH_MORE:"@\u002Fview\u002FtimelineIndex\u002FFETCH_MORE",FETCH:"@\u002Fview\u002FtimelineIndex\u002FFETCH",RESET:"@\u002Fview\u002FtimelineIndex\u002FRESET"},serverRenderTimelineList:a,timelineList:{list:[],cursor:f,skeleton:b,loading:a,hasMore:b,categoryId:e,tagId:e,sort:e,actionType:{UPDATE_STATE:"timeline-list\u002FUPDATE_STATE",FETCH_MORE:"timeline-list\u002FFETCH_MORE",FETCH:"timeline-list\u002FFETCH",RESET:"timeline-list\u002FRESET"}},recommendList:{list:[],cursor:f,loading:a,skeleton:b,hasMore:b,actionType:{UPDATE_STATE:"recommend-list\u002FUPDATE_STATE",FETCH_MORE:"recommend-list\u002FFETCH_MORE",FETCH:"recommend-list\u002FFETCH",RESET:"recommend-list\u002FRESET"}},followingList:{list:[],cursor:f,skeleton:b,loading:a,hasMore:b,actionType:{UPDATE_STATE:"following-list\u002FUPDATE_STATE",FETCH_MORE:"following-list\u002FFETCH_MORE",FETCH:"following-list\u002FFETCH",RESET:"following-list\u002FRESET"}}},subscribe:{subscribed:{list:[],cursor:f,skeleton:b,loading:a,hasMore:a,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fsubscribed\u002Flist\u002FRESET"}},all:{list:[],cursor:f,loading:a,skeleton:b,hasMore:a,linkList:e,actionType:{UPDATE_STATE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH_MORE",FETCH:"view\u002Fsubscribe\u002Fall\u002Flist\u002FFETCH",RESET:"view\u002Fsubscribe\u002Fall\u002Flist\u002FRESET"}}},entryPublic:{entry:{user:{}},relatedEntryList:[],relatedCollectionList:[],actionType:{FETCH:"@\u002Fview\u002FentryPublic\u002FFETCH",RESET:"@\u002Fview\u002FentryPublic\u002FRESET"}},user:{user:{},serverRendered:a,userAnnuals:[],actionType:{FETCH:"@\u002Fview\u002Fuser\u002FFETCH",RESET:"@\u002Fview\u002Fuser\u002FRESET",UPDATE:"@\u002Fview\u002Fuser\u002FUPDATE",FETCH_ANNUALS:"@\u002Fview\u002Fuser\u002FFETCH_ANNUALS"},detailList:{actionType:{RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FRESET"},likeList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FlikePostList\u002FRESET"}},postList:{list:[],hasMore:a,skeleton:a,loading:a,sort:n,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpostList\u002FRESET"}},searchList:{list:[],hasMore:a,skeleton:a,loading:a,key_word:e,search_type:d,cursor:f,isPostSearch:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FsearchList\u002FRESET"}},tagList:{list:[],loading:a,skeleton:b,hasMore:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FtagList\u002FRESET"}},collectionList:{list:[],userId:e,skeleton:b,hasMore:a,cursor:f,type:"created",loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FRESET",TOGGLE_FOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FTOGGLE_FOLLOW_COLLECTION",FOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FFOLLOW_COLLECTION",UNFOLLOW_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FUNFOLLOW_COLLECTION",DELELTE_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FDELELTE_COLLECTION",ADD_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FADD_COLLECTION",EDIT_COLLECTION:"@\u002Fview\u002Fuser\u002FdetailList\u002FcollectionList\u002FEDIT_COLLECTION"}},followerList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowerList\u002FRESET"}},followingList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingList\u002FRESET"}},followingTeamsList:{list:[],cursor:f,hasMore:a,skeleton:a,loading:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FfollowingTeamsList\u002FRESET"}},activityList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FactivityList\u002FRESET"}},bookList:{list:[],cursor:f,skeleton:b,hasMore:a,loading:a,type:"wrote",actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FbookList\u002FRESET"}},pinList:{list:[],hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinList\u002FRESET"}},courseList:{list:[],hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcourseList\u002FRESET"}},pinPraisedList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FpinPraisedList\u002FRESET"}},eventList:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FeventList\u002FRESET"}},selfColumnList:{list:[],hasMore:a,skeleton:a,loading:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnList\u002FRESET"}},columnFollowedList:{list:[],hasMore:a,skeleton:a,loading:a,cursor:f,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FRESET",FILTER:"@\u002Fview\u002Fuser\u002FdetailList\u002FcolumnFollowedList\u002FFILTER"}},realtimes:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FRESET",DELETE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimes\u002FDELETE"}},realtimeliked:{list:[],cursor:f,hasMore:a,loading:a,skeleton:a,actionType:{FETCH:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FRESET",DELETE:"@\u002Fview\u002Fuser\u002FdetailList\u002Frealtimeliked\u002FDELETE"}}}},tag:{tag:{},actionType:{FETCH:"@\u002Fview\u002Ftag\u002FFETCH",FETCH_LIST:"@\u002Fview\u002Ftag\u002FFETCH_LIST",RESET:"@\u002Fview\u002Ftag\u002FRESET"},list:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,actionType:{UPDATE_STATE:"@\u002Fview\u002Ftag\u002Flist\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Ftag\u002Flist\u002FFETCH",RESET:"@\u002Fview\u002Ftag\u002Flist\u002FRESET"}}},notification:{user:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fuser\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002FRESET"},listState:{list:[],cursor:f,hasMore:a,isLoading:a,messageType:3,msgTotal:d,msgSubMap:{"1":d,"2":d,"3":d,"4":d,"7":d}},list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fuser\u002Flist\u002FRESET"}}},system:{actionType:{READ_ALL:"@\u002Fview\u002Fnotification\u002Fsystem\u002FREAD_ALL",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002FRESET"},list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fnotification\u002Fsystem\u002Flist\u002FRESET"}}}},column:{serverRenderList:a,column:{id:w},entry:{id:w,screenshot:void 0,liked:a,article_id:w,article_info:{article_id:w,user_id:"1556564198033991",category_id:"6809635626661445640",tag_ids:[6809640463633482000,6809640399544517000],visible_level:d,link_url:e,cover_image:e,is_gfw:d,title:"Swift Protocol 背后的故事(理论)",brief_content:"本文主要讨论 Swift Protocol 实现机制，涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理。",is_english:d,is_original:g,user_index:9.126190592678677,original_type:d,original_author:e,content:e,ctime:"1644224823",mtime:"1656603744",rtime:"1644230850",draft_id:"7061859706158972965",view_count:6440,collect_count:26,digg_count:46,comment_count:5,hot_index:373,is_hot:d,rank_index:.0026242,status:l,verify_status:g,audit_status:l,mark_content:"本系列文章将从实践技巧、实现原理以及追踪语言更新等方面对 Swift Protocol 展开深入讨论。主要内容有：\n\n+ [Swift Protocol 背后的故事(实践)](https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7061874172560949279)\n\n+ Swift Protocol 背后的故事(理论)\n\n+ [Swift Protocol 背后的故事(Swift 5.6\u002F5.7)](https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7115050654170628127\u002F)\n\n+ ...\n\n本文是系列文章第二篇，主要讨论 Swift Protocol 实现机制。\n\n内容涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理以及泛型特化等。\n\n\u003C!--more--\u003E\n\n本文同时发表于我的[个人博客](https:\u002F\u002Fzxfcumtcs.github.io\u002F2022\u002F02\u002F04\u002FSwiftProtocol2\u002F)\n\n# Type Metadata\n\n____\n\n在 Objective-C 中，通过 MetaClass 模型来表达类的元信息，并通过实例的 `isa` 指针来引用 MetaClass。这是整个 Objective-C runtime 的核心机制。\n\n那在 Swift 中类型信息 (Type Metadata) 是如何表达的呢？\n\nSwift runtime 为每种类型 (Class、Struct、Enum、Protocol、Tuple、Function 等等) 生成了一份元信息记录 (Metadata Record)，几个关键点：\n\n- 对于常规类型 (nominal types，如：类、结构体、枚举)，其对应的 Metadata Record 在编译期由编译器静态生成；\n\n- 对于内在类型 (intrinsic types) 以及泛型实例，对应的 Metadata Record 则在运行时动态生成，如：元组、函数、协议等；\n\n- 每个类型的 Metadata Record 都是唯一的，相同类型的 Metadata Record 是同一个\n\n不同类型的 Metadata 所包含的信息也不一样 (Metadata Layout)，但它们有一个共同的头部，其包含：\n\n- VWT (Value Witness Table) Poniter — 指向 VWT (虚函数表) 的指针，在 VWT 中包含了该类型的实例如何分配内存 (allocating)、copy (copying)、销毁 (destroying) 等基础操作 (函数指针)；\n  \n  \u003E 在 VWT 中除了包含上述函数指针外，还有该类型实例的 size、alignment、stride 等基础信息。\n\n- Kind — 标记 Metadata 的类型，如：0 -- Class，1 -- Struct，2 -- Enum，12 -- Protocol 等等。\n\n![MetadataType.png](https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F1f930ea0470244f581af6b5812772271~tplv-k3u1fbpfcp-watermark.image?)\n\n与本文讨论相关的是 VWT，关于 Metadata 的更多信息请参考：[swift\u002FTypeMetadata.rst at main · apple\u002Fswift · GitHub](https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeMetadata.rst#protocol-metadata)。\n\n# Inside Protocol\n\n---\n\n## Existential Container\n\nClass、Struct 以及 Enum 对应的实例都有确定的『模型』用于指导其内存布局。\n\n\u003E 『模型』就是 Class、Struct 以及 Enum 本身的定义，它们包含的成员。\n\n而 Protocol 并没有确定的『模型』，因为其背后的真实类型可能千奇百怪，那么 Protocol 类型的变量按什么进行内存布局？\n\nSwift 用了一种称之为 **Existential Container** 的模型来指导 Protocol 变量布局内存。\n\nExistential Container 又分为两类：\n\n- *Opaque Existential Container* — 用于没有**类**约束的 Protocol (no class constraint on protocol)，也就是说这种协议背后的真实类型可能是类、结构体以及枚举等。因此其存储就非常复杂。\n  \n  ```swift\n  struct OpaqueExistentialContainer {\n    void *fixedSizeBuffer[3];\n    Metadata *type;\n    WitnessTable *witnessTables[NUM_WITNESS_TABLES];\n  };\n  ```\n  如上，`OpaqueExistentialContainer` 包含3个成员：\n  \n  - `fixedSizeBuffer` — 3 个指针大小的 buffer 空间，当真实类型的 size (内存对齐后的大小) 小于 3 个字时则其内容直接存储在 fixedSizeBuffer 中，否则在 heap 上另辟空间存储，并将指针存储在 fixedSizeBuffer 中；\n  \n  - `type` — 指向真实类型的 Metadata，最重要的就是引用其中的 VWT 用于完成内存的各种操作；\n  \n  - `witnessTables` — 指向协议函数表 (Protocol Witness Table, PWT)，协议函数表中存储的是真实类型中对应函数的地址。\n\n- *Class Existential Container* — 用于有**类**约束的 Protocol，该协议背后真实的类型只能是类，而类的实例都是在 Heap 上分配内存的。\n  \n  因此，在 Existential Container 中只需要一个指向堆内存的指针即可。\n  \n  同时，由于类的实例含有指向其 Metadata 的指针，故在 Existential Container 中也就没必要再存一份 Metadata 的指针了：\n  \n  ```swift\n  struct ClassExistentialContainer {\n    HeapObject *value;\n    WitnessTable *witnessTables[NUM_WITNESS_TABLES];\n  };\n  ```\n  如上，`ClassExistentialContainer` 只包含2个成员：\n  \n  - `value` — 指向堆内存的指针；\n  \n  - `witnessTables` — PWT 指针。\n\n下面我们来看一个例子：\n\n![ExistentialContainer.png](https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F4fdfe9986ded46ef8e34a9237f785310~tplv-k3u1fbpfcp-watermark.image?)\n\n如图，由于  `protocol Drawable` 没有 class constraint，故其对应的 Existential Container 是 `OpaqueExistentialContainer`：\n\n- 由于 `Point` 实例占用 2 个字的内存空间 (小于 3)，故对于 `Drawable` 协议类型的变量 `point` 直接使用 `OpaqueExistentialContainer#buffer` 来存储其内容(`x`、`y`)；\n\n- 而 `Line` 的实例要占用 4 个字的内存空间，故 `line` 需要在 heap 上分配内存用于存储其内容(`x0`、`y0`、`x1`、`y1`)；\n\n- Existential Container 中的 `type` 分别指向了其背后真实类型的 Metadata；\n\n- PWT 中的函数指针则指向真实类型中的函数。\n\n对应编译器生成的(伪)代码如下：\n\n```swift\nlet point: Drawable = Point(x: 0, y: 0)\npoint.draw()\n\n\u002F\u002F 编译器生成的(伪)代码\nlet _point: Point = Point(x: 0, y: 0)\nvar point: OpaqueExistentialContainer = OpaqueExistentialContainer()\nlet metadata = _point.type\nlet vwt = metadata.vwt\nvwt.copy(&(point.fixedSizeBuffer), _point)\npoint.type = metadata\npoint.witnessTables = PWT(Point.draw)\npoint.pwt.draw()\nvwt.dealloc(point)\n```\n\n```swift\nlet line: Drawable = Line(x0: 0, y0: 0, x1: 1, y1: 1)\nline.draw()\n\n\u002F\u002F 编译器生成的(伪)代码\nlet _line: Line = Line(x0: 0, y0: 0, x1: 1, y1: 1)\nvar line：OpaqueExistentialContainer = OpaqueExistentialContainer()\nlet metadata = _line.type\nlet vwt = metadata.vwt\nline.fixedSizeBuffer[0] = vwt.allocate()\nvwt.copy(line.fixedSizeBuffer, _line)\nline.type = metadata\nline.witnessTables = PWT(Line.draw)\nline.pwt.draw()\nvwt.dealloc(line)\n```\n\n关于更多 Type Layout 的信息请参考: [swift\u002FTypeLayout.rst at main · apple\u002Fswift · GitHub](https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeLayout.rst)\n\n从上面的伪代码可以看到对于协议类型的变量，编译器在背后做了大量的工作。也有一定的性能损耗。\n\n## Protocol Type Stored Properties\n\n从上一小节可知，协议类型的变量其实质类型是 Existential Container (`OpaqueExistentialContainer` \u002F `ClassExistentialContainer`)。\n\n因此，当协议类型变量作为存储属性时，其在寄主实例中的内存占用就是一个 Existential Container 实例 (下图来自: [Understanding Swift Performance · WWDC2016](https:\u002F\u002Fdeveloper.apple.com\u002Fvideos\u002Fplay\u002Fwwdc2016\u002F416\u002F))：\n\n![ProtocolTypeStoredProperties.png](https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F9d7481161e844b98a945ca280c9cfc12~tplv-k3u1fbpfcp-watermark.image?)\n\n## 小结\n\nProtocol 不同于一般类型 (Class、Struct、Enum)，具有以下特点：\n\n- 使用 Existential Container (`OpaqueExistentialContainer` \u002F `ClassExistentialContainer`) 作为内存模型；\n\n- 内存占用 \u003C= 3 的实例，直接存储在 Existential Container buffer 中，否则在 heap 上另行分配内存，并将指针存储在 Existential Container buffer[0] 中；\n\n- 内存管理 (allocating、copying、destroying) 相关的方法保存在 VWT 中；\n\n- 通过 PWT 实现方法动态派发 (Dynamic dispatch)。\n\n# Generics\n\n____\n\n泛型作为提升代码灵活性、可复用性的重要手段被大多数语言所支持，如：Swift、Java、C++ (模板)。\n\nSwift 结合 Protocol 赋以泛型更多的灵活性。\n\n下面我们简单探讨一下泛型在 Swift 中是如何实现的。\n\nSwift 中泛型可以添加类型约束 (Type Constraints)，约束可以是类，也可以是协议。\n\n因此，Swift 泛型根据类型约束可以分为 3 类：\n\n- No Constraints\n\n- Class Constraints\n\n- Protocol Constraints\n\n下面，分别对这 3 类情况进行简要分析。\n\n\u003E 通过 SIL ([swift\u002FSIL.rst at main · apple\u002Fswift · GitHub](https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FSIL.rst)) 可以大致了解 Swift 背后的实现原理。\n\u003E \n\u003E `swiftc demo.swift -O -emit-sil -o demo-sil.s` \n\u003E \n\u003E 如上，通过 swiftc 命令可以生成 SIL。\n\u003E \n\u003E 其中的 `-O` 是对生成的 SIL 代码进行编译优化，使 SIL 更简洁高效。\n\u003E \n\u003E 后面要讲到的泛型特化 (Specialization of Generics) 也只有在 `-O` 优化下会发生。\n\n## No Constraints\n\n其实，这类泛型能执行的操作非常少。无法在 heap 上实例化 (创建) 对象，也不能执行任何方法。\n\n```swift\n@inline(never)  \u002F\u002F 禁止编译器做 inline 优化\nfunc swapTwoValues\u003CT\u003E(_ a: inout T, _ b: inout T) {\n    let temp = a\n    a = b\n    b = temp\n}\n```\n\n如上，`swapTwoValues` 用于交换 2 个变量的值，其泛型参数 `T` 没有任何约束。\n\n其对应的 SIL 如下，关键点：\n\n+ 第`8`行，通过 `alloc_stack` 在栈上为类型 `T` 分配内存 (`temp`);\n\n+ 第`9`行，通过 `copy_addr` 进行内存级拷贝 (不会执行任何 `init` 方法)；\n\n+ 第`12`行，通过 `dealloc_stack` 销毁上述开辟的内存；\n\n+ 其他就是做一些内存拷贝的操作。\n\n\u003E 需要注意的是，对于引用类型，`$T`是指针，即在栈上开辟的是存储指针的内存，而非引用类型本身。\n\n```swift\n1   \u002F\u002F swapTwoValues\u003CA\u003E(_:_:)\n2   sil hidden [noinline] @$s4main13swapTwoValuesyyxz_xztlF : $@convention(thin) \u003CT\u003E (@inout T, @inout T) -\u003E () {\n3   \u002F\u002F %0 \"a\"                                         \u002F\u002F users: %5, %6, %2\n4   \u002F\u002F %1 \"b\"                                         \u002F\u002F users: %7, %6, %3\n5   bb0(%0 : $*T, %1 : $*T):\n6    debug_value_addr %0 : $*T, var, name \"a\", argno 1 \u002F\u002F id: %2\n7    debug_value_addr %1 : $*T, var, name \"b\", argno 2 \u002F\u002F id: %3\n8    %4 = alloc_stack $T, let, name \"temp\"           \u002F\u002F users: %8, %7, %5\n9    copy_addr %0 to [initialization] %4 : $*T       \u002F\u002F id: %5\n10   copy_addr [take] %1 to %0 : $*T                 \u002F\u002F id: %6\n11   copy_addr [take] %4 to [initialization] %1 : $*T \u002F\u002F id: %7\n12   dealloc_stack %4 : $*T                          \u002F\u002F id: %8\n13   %9 = tuple ()                                   \u002F\u002F user: %10\n14   return %9 : $()                                 \u002F\u002F id: %10\n15 } \u002F\u002F end sil function '$s4main13swapTwoValuesyyxz_xztlF'\n```\n\n## Class Constraints\n\n```swift\nclass Shape {\n  required\n  init() {}\n\n  func draw() -\u003E Bool {\n    return true\n  }\n}\n\nclass Triangle: Shape {\n  required\n  init() {}\n\n  override\n  func draw() -\u003E Bool {\n    return true\n  }\n}\n\n@inline(never)\nfunc drawShape\u003CT: Shape\u003E(_ s: T) {\n  let s0 = T()\n  s0.draw()\n}\n```\n\n如例：\n\n- 将泛型类型 upcast 到约束类型 (第 `5~6`行)；\n\n- 通过 `class_method` 指令找到要执行的方法 (`init`、`draw` 方法 [第 `7~10` 行]，在 vtable 中找)；\n\n- 可以在 Heap 上创建泛型类型的实例 (第 `8` 行)；\n\n- 其实质就是通过虚函数表实现的多态。\n\n总之，由于有基础类作为类型约束，通过虚函数表就可以执行所有基础类公开的方法。\n\n```swift\n1  \u002F\u002F drawShape\u003CA\u003E(_:)\n2  sil hidden [noinline] @$s4main9drawShapeyyxAA0C0CRbzlF : $@convention(thin) \u003CT where T : Shape\u003E (@guaranteed T) -\u003E () {\n3  \u002F\u002F %0 \"s\"\n4  bb0(%0 : $T):\n5    %1 = metatype $@thick T.Type                    \u002F\u002F user: %2\n6    %2 = upcast %1 : $@thick T.Type to $@thick Shape.Type \u002F\u002F users: %4, %3\n7    %3 = class_method %2 : $@thick Shape.Type, #Shape.init!allocator : (Shape.Type) -\u003E () -\u003E Shape, $@convention(method) (@thick Shape.Type) -\u003E @owned Shape \u002F\u002F user: %4\n8    %4 = apply %3(%2) : $@convention(method) (@thick Shape.Type) -\u003E @owned Shape \u002F\u002F users: %7, %5, %6\n9    %5 = class_method %4 : $Shape, #Shape.draw : (Shape) -\u003E () -\u003E Bool, $@convention(method) (@guaranteed Shape) -\u003E Bool \u002F\u002F user: %6\n10   %6 = apply %5(%4) : $@convention(method) (@guaranteed Shape) -\u003E Bool\n11   strong_release %4 : $Shape                      \u002F\u002F id: %7\n12   %8 = tuple ()                                   \u002F\u002F user: %9\n13   return %8 : $()                                 \u002F\u002F id: %9\n14 } \u002F\u002F end sil function '$s4main9drawShapeyyxAA0C0CRbzlF'\n15\n16 sil_vtable Shape {\n17   #Shape.init!allocator: (Shape.Type) -\u003E () -\u003E Shape : @$s4main5ShapeCACycfC    \u002F\u002F Shape.__allocating_init()\n18   #Shape.draw: (Shape) -\u003E () -\u003E Bool : @$s4main5ShapeC4drawSbyF    \u002F\u002F Shape.draw()\n19   #Shape.deinit!deallocator: @$s4main5ShapeCfD    \u002F\u002F Shape.__deallocating_deinit\n20 }\n21\n22 sil_vtable Triangle {\n23   #Shape.init!allocator: (Shape.Type) -\u003E () -\u003E Shape : @$s4main8TriangleCACycfC [override]    \u002F\u002F Triangle.__allocating_init()\n24   #Shape.draw: (Shape) -\u003E () -\u003E Bool : @$s4main8TriangleC4drawSbyF [override]    \u002F\u002F Triangle.draw()\n25   #Triangle.deinit!deallocator: @$s4main8TriangleCfD    \u002F\u002F Triangle.__deallocating_deinit\n26 }\n```\n\n## Protocol Constraints\n\n\u003E 这里讨论的 Protocol 是没有 class constraint 的，对于只能由类实现的协议作为泛型约束时，其效果同上节讨论的 Class Constraints。\n\n```swift\n@inline(never)\nfunc equal\u003CT: Equatable\u003E(_ a: T, _ b: T) -\u003E Bool {\n  let a0 = a\n  let b0 = b\n  return a0 == b\n}\n```\n\n从下列 SIL 可以看到：\n\n- 通过 `alloc_stack` 可以为泛型类型在 Stack 上分配内存 (无论泛型类型是值类型还是引用类型)；\n\n- 同样通过 `copy_addr` 执行内存拷贝；\n\n- 通过 `witness_method` 指令在泛型类型上查找 Protocol 指定的方法 (查 PWT 表)。\n\n```swift\n\u002F\u002F equal\u003CA\u003E(_:_:)\nsil hidden [noinline] @$s4main5equalySbx_xtSQRzlF : $@convention(thin) \u003CT where T : Equatable\u003E (@in_guaranteed T, @in_guaranteed T) -\u003E Bool {\n\u002F\u002F %0 \"a\"                                         \u002F\u002F users: %5, %2\n\u002F\u002F %1 \"b\"                                         \u002F\u002F users: %8, %3\nbb0(%0 : $*T, %1 : $*T):\n  debug_value_addr %0 : $*T, let, name \"a\", argno 1 \u002F\u002F id: %2\n  debug_value_addr %1 : $*T, let, name \"b\", argno 2 \u002F\u002F id: %3\n  %4 = alloc_stack $T, let, name \"a0\"             \u002F\u002F users: %9, %10, %8, %5\n  copy_addr %0 to [initialization] %4 : $*T       \u002F\u002F id: %5\n  %6 = metatype $@thick T.Type                    \u002F\u002F user: %8\n  %7 = witness_method $T, #Equatable.\"==\" : \u003CSelf where Self : Equatable\u003E (Self.Type) -\u003E (Self, Self) -\u003E Bool : $@convention(witness_method: Equatable) \u003Cτ_0_0 where τ_0_0 : Equatable\u003E (@in_guaranteed τ_0_0, @in_guaranteed τ_0_0, @thick τ_0_0.Type) -\u003E Bool \u002F\u002F user: %8\n  %8 = apply %7\u003CT\u003E(%4, %1, %6) : $@convention(witness_method: Equatable) \u003Cτ_0_0 where τ_0_0 : Equatable\u003E (@in_guaranteed τ_0_0, @in_guaranteed τ_0_0, @thick τ_0_0.Type) -\u003E Bool \u002F\u002F user: %11\n  destroy_addr %4 : $*T                           \u002F\u002F id: %9\n  dealloc_stack %4 : $*T                          \u002F\u002F id: %10\n  return %8 : $Bool                               \u002F\u002F id: %11\n} \u002F\u002F end sil function '$s4main5equalySbx_xtSQRzlF'\n```\n\n再看一个例子：\n\n```swift\nprotocol Drawable {\n  init()\n  func draw() -\u003E Bool\n}\n\n@inline(never)\nfunc drawShape\u003CT: Drawable\u003E(_ s: T) -\u003E T {\n  var s0 = T()\n  s0.draw()\n  return s0\n}\n```\n\n从下列 SIL 可以看出：\n\n- 可以在 Heap 上创建泛型类型实例 (无论是值类型还是引用类型)；\n\n```swift\n\u002F\u002F drawShape\u003CA\u003E(_:)\nsil hidden [noinline] @$s4main9drawShapeyxxAA8DrawableRzlF : $@convention(thin) \u003CT where T : Drawable\u003E (@in_guaranteed T) -\u003E @out T {\n\u002F\u002F %0 \"$return_value\"                             \u002F\u002F users: %4, %6\n\u002F\u002F %1 \"s\"\nbb0(%0 : $*T, %1 : $*T):\n  %2 = metatype $@thick T.Type                    \u002F\u002F user: %4\n  %3 = witness_method $T, #Drawable.init!allocator : \u003CSelf where Self : Drawable\u003E (Self.Type) -\u003E () -\u003E Self : $@convention(witness_method: Drawable) \u003Cτ_0_0 where τ_0_0 : Drawable\u003E (@thick τ_0_0.Type) -\u003E @out τ_0_0 \u002F\u002F user: %4\n  %4 = apply %3\u003CT\u003E(%0, %2) : $@convention(witness_method: Drawable) \u003Cτ_0_0 where τ_0_0 : Drawable\u003E (@thick τ_0_0.Type) -\u003E @out τ_0_0\n  %5 = witness_method $T, #Drawable.draw : \u003CSelf where Self : Drawable\u003E (Self) -\u003E () -\u003E Bool : $@convention(witness_method: Drawable) \u003Cτ_0_0 where τ_0_0 : Drawable\u003E (@in_guaranteed τ_0_0) -\u003E Bool \u002F\u002F user: %6\n  %6 = apply %5\u003CT\u003E(%0) : $@convention(witness_method: Drawable) \u003Cτ_0_0 where τ_0_0 : Drawable\u003E (@in_guaranteed τ_0_0) -\u003E Bool\n  %7 = tuple ()                                   \u002F\u002F user: %8\n  return %7 : $()                                 \u002F\u002F id: %8\n} \u002F\u002F end sil function '$s4main9drawShapeyxxAA8DrawableRzlF'\n\n\nsil_witness_table hidden Shape: Drawable module main {\n  method #Drawable.init!allocator: \u003CSelf where Self : Drawable\u003E (Self.Type) -\u003E () -\u003E Self : @$s4main5ShapeCAA8DrawableA2aDPxycfCTW    \u002F\u002F protocol witness for Drawable.init() in conformance Shape\n  method #Drawable.draw: \u003CSelf where Self : Drawable\u003E (Self) -\u003E () -\u003E Bool : @$s4main5ShapeCAA8DrawableA2aDP4drawSbyFTW    \u002F\u002F protocol witness for Drawable.draw() in conformance Shape\n}\n```\n\n通过上面简单的分析可以看出 No Constraints、Class Constraints 以及 Protocol Constraints 的泛型类型在实现上的区别：\n\n- No Constraints 泛型能做的事很少，不能执行任何方法，只能 Stack 上为泛型类型分配内存并执行内存拷贝；\n\n- Class Constraints 泛型可以在 Heap 上创建新实例，方法调用通过虚函数表 (vtable) 实现；\n\n- Protocol Constraints 泛型可以在 Stack 上也可以在 Heap 上按需创建泛型类型实例，无论泛型是值类型还是引用类型；\n\n- Protocol Constraints 泛型通过 PWT 实现方法调用；\n\n- 也就是说泛型中的方法调用都是动态派发 (Dynamic dispatch)，通过 vtable 或者 PWT。\n\n## Specialization of Generics\n\n从上一小节可知，泛型方法调用都是动态派发 (通过 vtable 或 PWT)，有一定的性能损耗。\n\n为了优化此类损耗，Swift 编译器会对泛型进行特化 (Specialization of Generics)。\n\n所谓特化就是为具体类型生成相应版本的函数，从而将泛型转成非泛型，实现方法调用的静态派发。\n\n```swift\n@inline(never)\nfunc swapTwoValues\u003CT\u003E(_ a: inout T, _ b: inout T) {\n  let temp = a\n  a = b\n  b = temp\n}\n\nvar a = 1\nvar b = 2\nswapTwoValues(&a, &b)\n```\n\n如例，通过 `Int` 型参数调用 `swapTwoValues` 时，编译器就会生成该方法的 `Int` 版本：\n\n```swift\n\u002F\u002F specialized swapTwoValues\u003CA\u003E(_:_:)\nsil shared [noinline] @$s4main13swapTwoValuesyyxz_xztlFSi_Tg5 : $@convention(thin) (@inout Int, @inout Int) -\u003E () {\n\u002F\u002F %0 \"a\"                                         \u002F\u002F users: %6, %4, %2\n\u002F\u002F %1 \"b\"                                         \u002F\u002F users: %7, %5, %3\nbb0(%0 : $*Int, %1 : $*Int):\n  debug_value_addr %0 : $*Int, var, name \"a\", argno 1 \u002F\u002F id: %2\n  debug_value_addr %1 : $*Int, var, name \"b\", argno 2 \u002F\u002F id: %3\n  %4 = load %0 : $*Int                            \u002F\u002F user: %7\n  %5 = load %1 : $*Int                            \u002F\u002F user: %6\n  store %5 to %0 : $*Int                          \u002F\u002F id: %6\n  store %4 to %1 : $*Int                          \u002F\u002F id: %7\n  %8 = tuple ()                                   \u002F\u002F user: %9\n  return %8 : $()                                 \u002F\u002F id: %9\n} \u002F\u002F end sil function '$s4main13swapTwoValuesyyxz_xztlFSi_Tg5'\n```\n\n那么，什么时候会进行泛型特化呢？\n\n总的原则是在编译泛型方法时知道有哪些调用方，同时调用方的类型是可推演的。\n\n最简单的情况就是泛型方法与调用方在同一个源文件里，一起进行编译。\n\n另外在编译时若开启了 Whole-Module Optimization ，同一模块内部的泛型调用也可以被特化。\n\n\u003E 关于全模块优化请参考[Swift.org - Whole-Module Optimization in Swift 3](https:\u002F\u002Fwww.swift.org\u002Fblog\u002Fwhole-module-optimizations\u002F)，在此不再赘述。\n\n# 小结\n\n- Swift 为每种类型生成了一份 Metadata Record，其中包含了 VWT (Value Witness Table)；\n\n- Protocol 使用 Existential Container 作为其内存模型，所有 Protocol 类型的变量都是 Existential Container 的实例；\n\n- Protocol 通过 PWT 实现方法动态派发 (Dynamic dispatch)；\n\n- 泛型调用在满足一定条件时会进行特化，以提升性能。\n\n# 参考资料\n\n[swift-evolution · Opaque Result Types](https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift-evolution\u002Fblob\u002Fmaster\u002Fproposals\u002F0244-opaque-result-types.md)\n\n[OpaqueTypes](https:\u002F\u002Fdocs.swift.org\u002Fswift-book\u002FLanguageGuide\u002FOpaqueTypes.html)\n\n[Different flavors of type erasure in Swift](https:\u002F\u002Fwww.swiftbysundell.com\u002Farticles\u002Fdifferent-flavors-of-type-erasure-in-swift\u002F#closures-to-the-rescue)\n\n[Opaque Return Types and Type Erasure](https:\u002F\u002Fwww.raywenderlich.com\u002F24942207-opaque-return-types-and-type-erasure)\n\n[Phantom types in Swift](https:\u002F\u002Fwww.swiftbysundell.com\u002Farticles\u002Fphantom-types-in-swift\u002F)\n\n[How to use phantom types in Swift](https:\u002F\u002Fwww.hackingwithswift.com\u002Fplus\u002Fadvanced-swift\u002Fhow-to-use-phantom-types-in-swift)\n\n[swift\u002FTypeMetadata.rst at main · apple\u002Fswift · GitHub](https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeMetadata.rst#protocol-metadata)\n\n[swift\u002FTypeLayout.rst at main · apple\u002Fswift · GitHub](https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeLayout.rst)\n\n[Swift Type Metadata](https:\u002F\u002Fspeakerdeck.com\u002Fkateinoigakukun\u002Fswift-type-metadata?slide=48)\n\n[Understanding Swift Performance · WWDC2016](https:\u002F\u002Fdeveloper.apple.com\u002Fvideos\u002Fplay\u002Fwwdc2016\u002F416\u002F)\n\n[Swift.org - Whole-Module Optimization in Swift 3](https:\u002F\u002Fwww.swift.org\u002Fblog\u002Fwhole-module-optimizations\u002F)\n",display_count:d,is_markdown:g,app_html_content:e},author_user_info:{user_id:"1556564198033991",user_name:"峰之巅",company:e,job_title:"移动开发",avatar_large:"https:\u002F\u002Fp26-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fca0dc6fa206bce240c1650e7da6ef516~300x300.image",level:4,description:"追求高质量代码\r\nzxfcumtcs@gmail.com",followee_count:5,follower_count:1431,post_article_count:32,digg_article_count:59,got_digg_count:1644,got_view_count:128274,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:b,favorable_author:d,power:4493,study_point:d,university:{university_id:f,name:e,logo:e},major:{major_id:f,parent_id:f,name:e},student_status:d,select_event_count:d,select_online_course_count:d,identity:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,extraMap:{},is_logout:d,annual_info:[],account_amount:d,user_growth_info:{user_id:1556564198033991,jpower:4493,jscore:166.4,jpower_level:4,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[],vip_level:d,vip_title:e,jscore_next_level_score:500,jscore_this_level_mini_score:d},is_vip:a,become_author_days:d,collection_set_article_count:d},category:{category_id:"6809635626661445640",category_name:"iOS",category_url:"ios",rank:4,back_ground:"https:\u002F\u002Flc-mhke0kuv.cn-n1.lcfile.com\u002F34589746327a360a.png",icon:"https:\u002F\u002Flc-mhke0kuv.cn-n1.lcfile.com\u002F4a218bdf1f6969fd.png",ctime:1461266350,mtime:1432503174,show_type:3,item_type:l,promote_tag_cap:4,promote_priority:4,id:"6809635626661445640",name:"iOS",title:"iOS",alias:"ios"},tags:[{entriesCount:void 0,subscribed:a,id:"6809640463633481741",tag_id:"6809640463633481741",tag_name:"Swift",color:"#F44C29",icon:"https:\u002F\u002Fp1-jj.byteimg.com\u002Ftos-cn-i-t2oaga2asx\u002Fleancloud-assets\u002Feb7ab66be4c2898b5aa9.png~tplv-t2oaga2asx-image.image",back_ground:e,show_navi:d,ctime:1436421185,mtime:1677982696,id_type:9,tag_alias:e,post_article_count:7880,concern_user_count:72984,title:"Swift",tagId:"6809640463633481741",articleCount:7880,subscribersCount:72984,createdAt:c,updatedAt:c},{entriesCount:void 0,subscribed:a,id:"6809640399544516616",tag_id:"6809640399544516616",tag_name:"iOS",color:"#616161",icon:"https:\u002F\u002Fp1-jj.byteimg.com\u002Ftos-cn-i-t2oaga2asx\u002Fgold-user-assets\u002F155962881259379c25251a455680e3249366e3a3ac373.jpg~tplv-t2oaga2asx-image.image",back_ground:e,show_navi:g,ctime:1435964171,mtime:1677938122,id_type:9,tag_alias:e,post_article_count:34106,concern_user_count:192623,title:"iOS",tagId:"6809640399544516616",articleCount:34106,subscribersCount:192623,createdAt:c,updatedAt:c}],user_interact:{id:7061891716931912000,omitempty:l,user_id:2894327269039357,is_digg:a,is_follow:a,is_collect:a},org:{org_info:c,org_user:c,is_followed:a},req_id:"202303051102433BE066AB34434A808ACB",status:{push_status:d},author_interact:c,extra:{boost_type:e},title:"Swift Protocol 背后的故事(理论)",user:{id:"1556564198033991",self_description:void 0,followed:b,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:4,user_id:"1556564198033991",user_name:"峰之巅",company:e,job_title:"移动开发",avatar_large:"https:\u002F\u002Fp26-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fca0dc6fa206bce240c1650e7da6ef516~300x300.image",description:"追求高质量代码\r\nzxfcumtcs@gmail.com",followee_count:5,follower_count:1431,post_article_count:32,digg_article_count:59,got_digg_count:1644,got_view_count:128274,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:b,favorable_author:d,power:4493,study_point:d,university:{university_id:f,name:e,logo:e},major:{major_id:f,parent_id:f,name:e},student_status:d,select_event_count:d,select_online_course_count:d,identity:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,extraMap:{},is_logout:d,annual_info:[],account_amount:d,user_growth_info:{user_id:1556564198033991,jpower:4493,jscore:166.4,jpower_level:4,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[],vip_level:d,vip_title:e,jscore_next_level_score:500,jscore_this_level_mini_score:d},is_vip:a,become_author_days:d,collection_set_article_count:d,juejinPower:4493,jobTitle:"移动开发",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"峰之巅",blogAddress:void 0,selfDescription:"追求高质量代码\r\nzxfcumtcs@gmail.com",beLikedCount:1644,beReadCount:128274,followerCount:1431,followingCount:5,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:32,pinCount:d,likedArticleCount:59,likedPinCount:d,avatar:"https:\u002F\u002Fp26-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fca0dc6fa206bce240c1650e7da6ef516~300x300.image",latestLoginedInAt:c,createdAt:c,updatedAt:c,phoneNumber:e,titleDescription:e,followeesCount:5,applyEventCount:d,need_lead:d,followTopicCnt:d},viewCount:void 0,commentsCount:5,isEvent:void 0,abstract:"本文主要讨论 Swift Protocol 实现机制，涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理。",latestCommentAt:c,createdAt:new Date(1644224823000),updatedAt:c,isTopicEvent:a,likedCount:46,likeCount:46,content:e,originalUrl:e,type:"post",collected:a,viewsCount:6440,username:"峰之巅",viewerHasLiked:a,draftId:"7061859706158972965",collectionCount:26},entryView:{},author:{id:"1556564198033991",self_description:void 0,followed:b,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:d,wroteBookCount:d,boughtBookCount:d,isBindedPhone:a,level:4,user_id:"1556564198033991",user_name:"峰之巅",company:e,job_title:"移动开发",avatar_large:"https:\u002F\u002Fp26-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fca0dc6fa206bce240c1650e7da6ef516~300x300.image",description:"追求高质量代码\r\nzxfcumtcs@gmail.com",followee_count:5,follower_count:1431,post_article_count:32,digg_article_count:59,got_digg_count:1644,got_view_count:128274,post_shortmsg_count:d,digg_shortmsg_count:d,isfollowed:b,favorable_author:d,power:4493,study_point:d,university:{university_id:f,name:e,logo:e},major:{major_id:f,parent_id:f,name:e},student_status:d,select_event_count:d,select_online_course_count:d,identity:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,extraMap:{},is_logout:d,annual_info:[],account_amount:d,user_growth_info:{user_id:1556564198033991,jpower:4493,jscore:166.4,jpower_level:4,jscore_level:4,jscore_title:"进阶掘友",author_achievement_list:[],vip_level:d,vip_title:e,jscore_next_level_score:500,jscore_this_level_mini_score:d},is_vip:a,become_author_days:d,collection_set_article_count:d,juejinPower:4493,jobTitle:"移动开发",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"峰之巅",blogAddress:void 0,selfDescription:"追求高质量代码\r\nzxfcumtcs@gmail.com",beLikedCount:1644,beReadCount:128274,followerCount:1431,followingCount:5,collectionCount:d,createdCollectionCount:d,followingCollectionCount:d,postedPostsCount:32,pinCount:d,likedArticleCount:59,likedPinCount:d,avatar:"https:\u002F\u002Fp26-passport.byteacctimg.com\u002Fimg\u002Fuser-avatar\u002Fca0dc6fa206bce240c1650e7da6ef516~300x300.image",latestLoginedInAt:c,createdAt:c,updatedAt:c,phoneNumber:e,titleDescription:e,followeesCount:5,applyEventCount:d,need_lead:d,followTopicCnt:d},adEntryList:[],relatedEntryList:[],linkVotingList:[],userAnnuals:[],columnList:[],resultHtml:"\u003Cstyle\u003E.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre\u003Ecode{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:\"\"}.markdown-body blockquote\u003Ep{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}\u003C\u002Fstyle\u003E\u003Cstyle data-highlight data-highlight-key=\"juejin\"\u003E.markdown-body pre,.markdown-body pre\u003Ecode.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}\u003C\u002Fstyle\u003E\u003Cp\u003E本系列文章将从实践技巧、实现原理以及追踪语言更新等方面对 Swift Protocol 展开深入讨论。主要内容有：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7061874172560949279\" target=\"_blank\" title=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7061874172560949279\"\u003ESwift Protocol 背后的故事(实践)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003ESwift Protocol 背后的故事(理论)\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7115050654170628127\u002F\" target=\"_blank\" title=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F7115050654170628127\u002F\"\u003ESwift Protocol 背后的故事(Swift 5.6\u002F5.7)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E...\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E本文是系列文章第二篇，主要讨论 Swift Protocol 实现机制。\u003C\u002Fp\u003E\n\u003Cp\u003E内容涉及 Type Metadata、Protocol 内存模型 Existential Container、Generics 的实现原理以及泛型特化等。\u003C\u002Fp\u003E\n\n\u003Cp\u003E本文同时发表于我的\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fzxfcumtcs.github.io%2F2022%2F02%2F04%2FSwiftProtocol2%2F\" target=\"_blank\" title=\"https:\u002F\u002Fzxfcumtcs.github.io\u002F2022\u002F02\u002F04\u002FSwiftProtocol2\u002F\" ref=\"nofollow noopener noreferrer\"\u003E个人博客\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Ch1 data-id=\"heading-0\"\u003EType Metadata\u003C\u002Fh1\u003E\n\u003Chr\u003E\n\u003Cp\u003E在 Objective-C 中，通过 MetaClass 模型来表达类的元信息，并通过实例的 \u003Ccode\u003Eisa\u003C\u002Fcode\u003E 指针来引用 MetaClass。这是整个 Objective-C runtime 的核心机制。\u003C\u002Fp\u003E\n\u003Cp\u003E那在 Swift 中类型信息 (Type Metadata) 是如何表达的呢？\u003C\u002Fp\u003E\n\u003Cp\u003ESwift runtime 为每种类型 (Class、Struct、Enum、Protocol、Tuple、Function 等等) 生成了一份元信息记录 (Metadata Record)，几个关键点：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E对于常规类型 (nominal types，如：类、结构体、枚举)，其对应的 Metadata Record 在编译期由编译器静态生成；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E对于内在类型 (intrinsic types) 以及泛型实例，对应的 Metadata Record 则在运行时动态生成，如：元组、函数、协议等；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E每个类型的 Metadata Record 都是唯一的，相同类型的 Metadata Record 是同一个\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E不同类型的 Metadata 所包含的信息也不一样 (Metadata Layout)，但它们有一个共同的头部，其包含：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003EVWT (Value Witness Table) Poniter — 指向 VWT (虚函数表) 的指针，在 VWT 中包含了该类型的实例如何分配内存 (allocating)、copy (copying)、销毁 (destroying) 等基础操作 (函数指针)；\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E在 VWT 中除了包含上述函数指针外，还有该类型实例的 size、alignment、stride 等基础信息。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EKind — 标记 Metadata 的类型，如：0 -- Class，1 -- Struct，2 -- Enum，12 -- Protocol 等等。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F1f930ea0470244f581af6b5812772271~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?\" alt=\"MetadataType.png\" loading=\"lazy\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E与本文讨论相关的是 VWT，关于 Metadata 的更多信息请参考：\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeMetadata.rst%23protocol-metadata\" target=\"_blank\" title=\"https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeMetadata.rst#protocol-metadata\" ref=\"nofollow noopener noreferrer\"\u003Eswift\u002FTypeMetadata.rst at main · apple\u002Fswift · GitHub\u003C\u002Fa\u003E。\u003C\u002Fp\u003E\n\u003Ch1 data-id=\"heading-1\"\u003EInside Protocol\u003C\u002Fh1\u003E\n\u003Chr\u003E\n\u003Ch2 data-id=\"heading-2\"\u003EExistential Container\u003C\u002Fh2\u003E\n\u003Cp\u003EClass、Struct 以及 Enum 对应的实例都有确定的『模型』用于指导其内存布局。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E『模型』就是 Class、Struct 以及 Enum 本身的定义，它们包含的成员。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E而 Protocol 并没有确定的『模型』，因为其背后的真实类型可能千奇百怪，那么 Protocol 类型的变量按什么进行内存布局？\u003C\u002Fp\u003E\n\u003Cp\u003ESwift 用了一种称之为 \u003Cstrong\u003EExistential Container\u003C\u002Fstrong\u003E 的模型来指导 Protocol 变量布局内存。\u003C\u002Fp\u003E\n\u003Cp\u003EExistential Container 又分为两类：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Cem\u003EOpaque Existential Container\u003C\u002Fem\u003E — 用于没有\u003Cstrong\u003E类\u003C\u002Fstrong\u003E约束的 Protocol (no class constraint on protocol)，也就是说这种协议背后的真实类型可能是类、结构体以及枚举等。因此其存储就非常复杂。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title class_\"\u003EOpaqueExistentialContainer\u003C\u002Fspan\u003E {\n  void \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003EfixedSizeBuffer[\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E];\n  \u003Cspan class=\"hljs-type\"\u003EMetadata\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003Etype;\n  \u003Cspan class=\"hljs-type\"\u003EWitnessTable\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003EwitnessTables[\u003Cspan class=\"hljs-type\"\u003ENUM_WITNESS_TABLES\u003C\u002Fspan\u003E];\n};\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如上，\u003Ccode\u003EOpaqueExistentialContainer\u003C\u002Fcode\u003E 包含3个成员：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003EfixedSizeBuffer\u003C\u002Fcode\u003E — 3 个指针大小的 buffer 空间，当真实类型的 size (内存对齐后的大小) 小于 3 个字时则其内容直接存储在 fixedSizeBuffer 中，否则在 heap 上另辟空间存储，并将指针存储在 fixedSizeBuffer 中；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003Etype\u003C\u002Fcode\u003E — 指向真实类型的 Metadata，最重要的就是引用其中的 VWT 用于完成内存的各种操作；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003EwitnessTables\u003C\u002Fcode\u003E — 指向协议函数表 (Protocol Witness Table, PWT)，协议函数表中存储的是真实类型中对应函数的地址。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Cem\u003EClass Existential Container\u003C\u002Fem\u003E — 用于有\u003Cstrong\u003E类\u003C\u002Fstrong\u003E约束的 Protocol，该协议背后真实的类型只能是类，而类的实例都是在 Heap 上分配内存的。\u003C\u002Fp\u003E\n\u003Cp\u003E因此，在 Existential Container 中只需要一个指向堆内存的指针即可。\u003C\u002Fp\u003E\n\u003Cp\u003E同时，由于类的实例含有指向其 Metadata 的指针，故在 Existential Container 中也就没必要再存一份 Metadata 的指针了：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title class_\"\u003EClassExistentialContainer\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-type\"\u003EHeapObject\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003Evalue;\n  \u003Cspan class=\"hljs-type\"\u003EWitnessTable\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003EwitnessTables[\u003Cspan class=\"hljs-type\"\u003ENUM_WITNESS_TABLES\u003C\u002Fspan\u003E];\n};\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如上，\u003Ccode\u003EClassExistentialContainer\u003C\u002Fcode\u003E 只包含2个成员：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003Evalue\u003C\u002Fcode\u003E — 指向堆内存的指针；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E\u003Ccode\u003EwitnessTables\u003C\u002Fcode\u003E — PWT 指针。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E下面我们来看一个例子：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F4fdfe9986ded46ef8e34a9237f785310~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?\" alt=\"ExistentialContainer.png\" loading=\"lazy\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E如图，由于  \u003Ccode\u003Eprotocol Drawable\u003C\u002Fcode\u003E 没有 class constraint，故其对应的 Existential Container 是 \u003Ccode\u003EOpaqueExistentialContainer\u003C\u002Fcode\u003E：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E由于 \u003Ccode\u003EPoint\u003C\u002Fcode\u003E 实例占用 2 个字的内存空间 (小于 3)，故对于 \u003Ccode\u003EDrawable\u003C\u002Fcode\u003E 协议类型的变量 \u003Ccode\u003Epoint\u003C\u002Fcode\u003E 直接使用 \u003Ccode\u003EOpaqueExistentialContainer#buffer\u003C\u002Fcode\u003E 来存储其内容(\u003Ccode\u003Ex\u003C\u002Fcode\u003E、\u003Ccode\u003Ey\u003C\u002Fcode\u003E)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E而 \u003Ccode\u003ELine\u003C\u002Fcode\u003E 的实例要占用 4 个字的内存空间，故 \u003Ccode\u003Eline\u003C\u002Fcode\u003E 需要在 heap 上分配内存用于存储其内容(\u003Ccode\u003Ex0\u003C\u002Fcode\u003E、\u003Ccode\u003Ey0\u003C\u002Fcode\u003E、\u003Ccode\u003Ex1\u003C\u002Fcode\u003E、\u003Ccode\u003Ey1\u003C\u002Fcode\u003E)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EExistential Container 中的 \u003Ccode\u003Etype\u003C\u002Fcode\u003E 分别指向了其背后真实类型的 Metadata；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EPWT 中的函数指针则指向真实类型中的函数。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E对应编译器生成的(伪)代码如下：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E point: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EPoint\u003C\u002Fspan\u003E(x: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, y: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\npoint.draw()\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 编译器生成的(伪)代码\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E _point: \u003Cspan class=\"hljs-type\"\u003EPoint\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EPoint\u003C\u002Fspan\u003E(x: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, y: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E)\n\u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E point: \u003Cspan class=\"hljs-type\"\u003EOpaqueExistentialContainer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EOpaqueExistentialContainer\u003C\u002Fspan\u003E()\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E metadata \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E _point.type\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E vwt \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metadata.vwt\nvwt.copy(\u003Cspan class=\"hljs-operator\"\u003E&#x26;\u003C\u002Fspan\u003E(point.fixedSizeBuffer), _point)\npoint.type \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metadata\npoint.witnessTables \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EPWT\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-type\"\u003EPoint\u003C\u002Fspan\u003E.draw)\npoint.pwt.draw()\nvwt.dealloc(point)\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E line: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ELine\u003C\u002Fspan\u003E(x0: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, y0: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, x1: \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E, y1: \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\nline.draw()\n\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 编译器生成的(伪)代码\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E _line: \u003Cspan class=\"hljs-type\"\u003ELine\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ELine\u003C\u002Fspan\u003E(x0: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, y0: \u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, x1: \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E, y1: \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E)\n\u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E line：\u003Cspan class=\"hljs-type\"\u003EOpaqueExistentialContainer\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EOpaqueExistentialContainer\u003C\u002Fspan\u003E()\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E metadata \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E _line.type\n\u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E vwt \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metadata.vwt\nline.fixedSizeBuffer[\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E] \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E vwt.allocate()\nvwt.copy(line.fixedSizeBuffer, _line)\nline.type \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metadata\nline.witnessTables \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EPWT\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-type\"\u003ELine\u003C\u002Fspan\u003E.draw)\nline.pwt.draw()\nvwt.dealloc(line)\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E关于更多 Type Layout 的信息请参考: \u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeLayout.rst\" target=\"_blank\" title=\"https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeLayout.rst\" ref=\"nofollow noopener noreferrer\"\u003Eswift\u002FTypeLayout.rst at main · apple\u002Fswift · GitHub\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E从上面的伪代码可以看到对于协议类型的变量，编译器在背后做了大量的工作。也有一定的性能损耗。\u003C\u002Fp\u003E\n\u003Ch2 data-id=\"heading-3\"\u003EProtocol Type Stored Properties\u003C\u002Fh2\u003E\n\u003Cp\u003E从上一小节可知，协议类型的变量其实质类型是 Existential Container (\u003Ccode\u003EOpaqueExistentialContainer\u003C\u002Fcode\u003E \u002F \u003Ccode\u003EClassExistentialContainer\u003C\u002Fcode\u003E)。\u003C\u002Fp\u003E\n\u003Cp\u003E因此，当协议类型变量作为存储属性时，其在寄主实例中的内存占用就是一个 Existential Container 实例 (下图来自: \u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2016%2F416%2F\" target=\"_blank\" title=\"https:\u002F\u002Fdeveloper.apple.com\u002Fvideos\u002Fplay\u002Fwwdc2016\u002F416\u002F\" ref=\"nofollow noopener noreferrer\"\u003EUnderstanding Swift Performance · WWDC2016\u003C\u002Fa\u003E)：\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F9d7481161e844b98a945ca280c9cfc12~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?\" alt=\"ProtocolTypeStoredProperties.png\" loading=\"lazy\"\u003E\u003C\u002Fp\u003E\n\u003Ch2 data-id=\"heading-4\"\u003E小结\u003C\u002Fh2\u003E\n\u003Cp\u003EProtocol 不同于一般类型 (Class、Struct、Enum)，具有以下特点：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E使用 Existential Container (\u003Ccode\u003EOpaqueExistentialContainer\u003C\u002Fcode\u003E \u002F \u003Ccode\u003EClassExistentialContainer\u003C\u002Fcode\u003E) 作为内存模型；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E内存占用 &#x3C;= 3 的实例，直接存储在 Existential Container buffer 中，否则在 heap 上另行分配内存，并将指针存储在 Existential Container buffer[0] 中；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E内存管理 (allocating、copying、destroying) 相关的方法保存在 VWT 中；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E通过 PWT 实现方法动态派发 (Dynamic dispatch)。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch1 data-id=\"heading-5\"\u003EGenerics\u003C\u002Fh1\u003E\n\u003Chr\u003E\n\u003Cp\u003E泛型作为提升代码灵活性、可复用性的重要手段被大多数语言所支持，如：Swift、Java、C++ (模板)。\u003C\u002Fp\u003E\n\u003Cp\u003ESwift 结合 Protocol 赋以泛型更多的灵活性。\u003C\u002Fp\u003E\n\u003Cp\u003E下面我们简单探讨一下泛型在 Swift 中是如何实现的。\u003C\u002Fp\u003E\n\u003Cp\u003ESwift 中泛型可以添加类型约束 (Type Constraints)，约束可以是类，也可以是协议。\u003C\u002Fp\u003E\n\u003Cp\u003E因此，Swift 泛型根据类型约束可以分为 3 类：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003ENo Constraints\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EClass Constraints\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EProtocol Constraints\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E下面，分别对这 3 类情况进行简要分析。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E通过 SIL (\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FSIL.rst\" target=\"_blank\" title=\"https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FSIL.rst\" ref=\"nofollow noopener noreferrer\"\u003Eswift\u002FSIL.rst at main · apple\u002Fswift · GitHub\u003C\u002Fa\u003E) 可以大致了解 Swift 背后的实现原理。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003Eswiftc demo.swift -O -emit-sil -o demo-sil.s\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E如上，通过 swiftc 命令可以生成 SIL。\u003C\u002Fp\u003E\n\u003Cp\u003E其中的 \u003Ccode\u003E-O\u003C\u002Fcode\u003E 是对生成的 SIL 代码进行编译优化，使 SIL 更简洁高效。\u003C\u002Fp\u003E\n\u003Cp\u003E后面要讲到的泛型特化 (Specialization of Generics) 也只有在 \u003Ccode\u003E-O\u003C\u002Fcode\u003E 优化下会发生。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch2 data-id=\"heading-6\"\u003ENo Constraints\u003C\u002Fh2\u003E\n\u003Cp\u003E其实，这类泛型能执行的操作非常少。无法在 heap 上实例化 (创建) 对象，也不能执行任何方法。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@inline\u003C\u002Fspan\u003E(never)  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F 禁止编译器做 inline 优化\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EswapTwoValues\u003C\u002Fspan\u003E&#x3C;\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E\u003E(\u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Ea\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Einout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Eb\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Einout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) {\n    \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E temp \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E a\n    a \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E b\n    b \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E temp\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如上，\u003Ccode\u003EswapTwoValues\u003C\u002Fcode\u003E 用于交换 2 个变量的值，其泛型参数 \u003Ccode\u003ET\u003C\u002Fcode\u003E 没有任何约束。\u003C\u002Fp\u003E\n\u003Cp\u003E其对应的 SIL 如下，关键点：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E第\u003Ccode\u003E8\u003C\u002Fcode\u003E行，通过 \u003Ccode\u003Ealloc_stack\u003C\u002Fcode\u003E 在栈上为类型 \u003Ccode\u003ET\u003C\u002Fcode\u003E 分配内存 (\u003Ccode\u003Etemp\u003C\u002Fcode\u003E);\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E第\u003Ccode\u003E9\u003C\u002Fcode\u003E行，通过 \u003Ccode\u003Ecopy_addr\u003C\u002Fcode\u003E 进行内存级拷贝 (不会执行任何 \u003Ccode\u003Einit\u003C\u002Fcode\u003E 方法)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E第\u003Ccode\u003E12\u003C\u002Fcode\u003E行，通过 \u003Ccode\u003Edealloc_stack\u003C\u002Fcode\u003E 销毁上述开辟的内存；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E其他就是做一些内存拷贝的操作。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E需要注意的是，对于引用类型，\u003Ccode\u003E$T\u003C\u002Fcode\u003E是指针，即在栈上开辟的是存储指针的内存，而非引用类型本身。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F swapTwoValues&#x3C;A\u003E(_:_:)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E   sil hidden [noinline] @\u003Cspan class=\"hljs-variable\"\u003E$s4main13swapTwoValuesyyxz_xztlF\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(thin) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@inout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-meta\"\u003E@inout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) -\u003E () {\n\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %0 \"a\"                                         \u002F\u002F users: %5, %6, %2\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %1 \"b\"                                         \u002F\u002F users: %7, %6, %3\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E   bb0(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E):\n\u003Cspan class=\"hljs-number\"\u003E6\u003C\u002Fspan\u003E    debug_value_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"a\"\u003C\u002Fspan\u003E, argno \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %2\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E    debug_value_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"b\"\u003C\u002Fspan\u003E, argno \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %3\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E alloc_stack \u003Cspan class=\"hljs-variable\"\u003E$T\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"temp\"\u003C\u002Fspan\u003E           \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F users: %8, %7, %5\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E9\u003C\u002Fspan\u003E    copy_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E to [initialization] \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E       \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %5\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E   copy_addr [take] \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E to \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E                 \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %6\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E11\u003C\u002Fspan\u003E   copy_addr [take] \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E to [initialization] \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %7\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E12\u003C\u002Fspan\u003E   dealloc_stack \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E                          \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %8\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E13\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E9\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E tuple ()                                   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %10\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E14\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E9\u003C\u002Fspan\u003E : $()                                 \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %10\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E15\u003C\u002Fspan\u003E } \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F end sil function '$s4main13swapTwoValuesyyxz_xztlF'\u003C\u002Fspan\u003E\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 data-id=\"heading-7\"\u003EClass Constraints\u003C\u002Fh2\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title class_\"\u003EShape\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Erequired\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E() {}\n\n  \u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003Edraw\u003C\u002Fspan\u003E() -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  }\n}\n\n\u003Cspan class=\"hljs-keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title class_\"\u003ETriangle\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-title class_\"\u003EShape\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Erequired\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E() {}\n\n  \u003Cspan class=\"hljs-keyword\"\u003Eoverride\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003Edraw\u003C\u002Fspan\u003E() -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E {\n    \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-literal\"\u003Etrue\u003C\u002Fspan\u003E\n  }\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E@inline\u003C\u002Fspan\u003E(never)\n\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EdrawShape\u003C\u002Fspan\u003E&#x3C;\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E\u003E(\u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Es\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E s0 \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E()\n  s0.draw()\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如例：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E将泛型类型 upcast 到约束类型 (第 \u003Ccode\u003E5~6\u003C\u002Fcode\u003E行)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E通过 \u003Ccode\u003Eclass_method\u003C\u002Fcode\u003E 指令找到要执行的方法 (\u003Ccode\u003Einit\u003C\u002Fcode\u003E、\u003Ccode\u003Edraw\u003C\u002Fcode\u003E 方法 [第 \u003Ccode\u003E7~10\u003C\u002Fcode\u003E 行]，在 vtable 中找)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E可以在 Heap 上创建泛型类型的实例 (第 \u003Ccode\u003E8\u003C\u002Fcode\u003E 行)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E其实质就是通过虚函数表实现的多态。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E总之，由于有基础类作为类型约束，通过虚函数表就可以执行所有基础类公开的方法。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F drawShape&#x3C;A\u003E(_:)\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E  sil hidden [noinline] @\u003Cspan class=\"hljs-variable\"\u003E$s4main9drawShapeyyxAA0C0CRbzlF\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(thin) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@guaranteed\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) -\u003E () {\n\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E  \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %0 \"s\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E  bb0(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-variable\"\u003E$T\u003C\u002Fspan\u003E):\n\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metatype $\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E                    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %2\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E6\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E upcast \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E to $\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F users: %4, %3\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E class_method \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E, #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Eallocator : (\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E, $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(method) (\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-meta\"\u003E@owned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %4\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E apply \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E) : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(method) (\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-meta\"\u003E@owned\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F users: %7, %5, %6\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E9\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E class_method \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-variable\"\u003E$Shape\u003C\u002Fspan\u003E, #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.draw : (\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E, $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(method) (\u003Cspan class=\"hljs-meta\"\u003E@guaranteed\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %6\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E10\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E6\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E apply \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E) : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(method) (\u003Cspan class=\"hljs-meta\"\u003E@guaranteed\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E11\u003C\u002Fspan\u003E   strong_release \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-variable\"\u003E$Shape\u003C\u002Fspan\u003E                      \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %7\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E12\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E tuple ()                                   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %9\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E13\u003C\u002Fspan\u003E   \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E : $()                                 \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %9\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E14\u003C\u002Fspan\u003E } \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F end sil function '$s4main9drawShapeyyxAA0C0CRbzlF'\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E15\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E16\u003C\u002Fspan\u003E sil_vtable \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E {\n\u003Cspan class=\"hljs-number\"\u003E17\u003C\u002Fspan\u003E   #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Eallocator: (\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E : @\u003Cspan class=\"hljs-variable\"\u003E$s4main5ShapeCACycfC\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Shape.__allocating_init()\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E18\u003C\u002Fspan\u003E   #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.draw: (\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E : @\u003Cspan class=\"hljs-variable\"\u003E$s4main5ShapeC4drawSbyF\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Shape.draw()\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E19\u003C\u002Fspan\u003E   #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.deinit\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Edeallocator: @\u003Cspan class=\"hljs-variable\"\u003E$s4main5ShapeCfD\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Shape.__deallocating_deinit\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E20\u003C\u002Fspan\u003E }\n\u003Cspan class=\"hljs-number\"\u003E21\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E22\u003C\u002Fspan\u003E sil_vtable \u003Cspan class=\"hljs-type\"\u003ETriangle\u003C\u002Fspan\u003E {\n\u003Cspan class=\"hljs-number\"\u003E23\u003C\u002Fspan\u003E   #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Eallocator: (\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E : @\u003Cspan class=\"hljs-variable\"\u003E$s4main8TriangleCACycfC\u003C\u002Fspan\u003E [\u003Cspan class=\"hljs-keyword\"\u003Eoverride\u003C\u002Fspan\u003E]    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Triangle.__allocating_init()\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E24\u003C\u002Fspan\u003E   #\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E.draw: (\u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E : @\u003Cspan class=\"hljs-variable\"\u003E$s4main8TriangleC4drawSbyF\u003C\u002Fspan\u003E [\u003Cspan class=\"hljs-keyword\"\u003Eoverride\u003C\u002Fspan\u003E]    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Triangle.draw()\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E25\u003C\u002Fspan\u003E   #\u003Cspan class=\"hljs-type\"\u003ETriangle\u003C\u002Fspan\u003E.deinit\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Edeallocator: @\u003Cspan class=\"hljs-variable\"\u003E$s4main8TriangleCfD\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F Triangle.__deallocating_deinit\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-number\"\u003E26\u003C\u002Fspan\u003E }\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 data-id=\"heading-8\"\u003EProtocol Constraints\u003C\u002Fh2\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E这里讨论的 Protocol 是没有 class constraint 的，对于只能由类实现的协议作为泛型约束时，其效果同上节讨论的 Class Constraints。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@inline\u003C\u002Fspan\u003E(never)\n\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003Eequal\u003C\u002Fspan\u003E&#x3C;\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E\u003E(\u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Ea\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Eb\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E a0 \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E a\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E b0 \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E b\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E a0 \u003Cspan class=\"hljs-operator\"\u003E==\u003C\u002Fspan\u003E b\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E从下列 SIL 可以看到：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003E通过 \u003Ccode\u003Ealloc_stack\u003C\u002Fcode\u003E 可以为泛型类型在 Stack 上分配内存 (无论泛型类型是值类型还是引用类型)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E同样通过 \u003Ccode\u003Ecopy_addr\u003C\u002Fcode\u003E 执行内存拷贝；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E通过 \u003Ccode\u003Ewitness_method\u003C\u002Fcode\u003E 指令在泛型类型上查找 Protocol 指定的方法 (查 PWT 表)。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F equal&#x3C;A\u003E(_:_:)\u003C\u002Fspan\u003E\nsil hidden [noinline] @\u003Cspan class=\"hljs-variable\"\u003E$s4main5equalySbx_xtSQRzlF\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(thin) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E {\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %0 \"a\"                                         \u002F\u002F users: %5, %2\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %1 \"b\"                                         \u002F\u002F users: %8, %3\u003C\u002Fspan\u003E\nbb0(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E):\n  debug_value_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"a\"\u003C\u002Fspan\u003E, argno \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %2\u003C\u002Fspan\u003E\n  debug_value_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"b\"\u003C\u002Fspan\u003E, argno \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %3\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E alloc_stack \u003Cspan class=\"hljs-variable\"\u003E$T\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"a0\"\u003C\u002Fspan\u003E             \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F users: %9, %10, %8, %5\u003C\u002Fspan\u003E\n  copy_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E to [initialization] \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E       \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %5\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E6\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metatype $\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E                    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %8\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E witness_method \u003Cspan class=\"hljs-variable\"\u003E$T\u003C\u002Fspan\u003E, #\u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-string\"\u003E\"==\"\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E (\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(witness_method: \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003Eτ_0_0 \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E τ_0_0 : \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E τ_0_0, \u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E τ_0_0, \u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E τ_0_0.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %8\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E apply \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E6\u003C\u002Fspan\u003E) : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(witness_method: \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003Eτ_0_0 \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E τ_0_0 : \u003Cspan class=\"hljs-type\"\u003EEquatable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E τ_0_0, \u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E τ_0_0, \u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E τ_0_0.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %11\u003C\u002Fspan\u003E\n  destroy_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E                           \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %9\u003C\u002Fspan\u003E\n  dealloc_stack \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E                          \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %10\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-variable\"\u003E$Bool\u003C\u002Fspan\u003E                               \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %11\u003C\u002Fspan\u003E\n} \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F end sil function '$s4main5equalySbx_xtSQRzlF'\u003C\u002Fspan\u003E\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E再看一个例子：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-keyword\"\u003Eprotocol\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title class_\"\u003EDrawable\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E()\n  \u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003Edraw\u003C\u002Fspan\u003E() -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E\n}\n\n\u003Cspan class=\"hljs-meta\"\u003E@inline\u003C\u002Fspan\u003E(never)\n\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EdrawShape\u003C\u002Fspan\u003E&#x3C;\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003E(\u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Es\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E {\n  \u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E s0 \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E()\n  s0.draw()\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E s0\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E从下列 SIL 可以看出：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E可以在 Heap 上创建泛型类型实例 (无论是值类型还是引用类型)；\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F drawShape&#x3C;A\u003E(_:)\u003C\u002Fspan\u003E\nsil hidden [noinline] @\u003Cspan class=\"hljs-variable\"\u003E$s4main9drawShapeyxxAA8DrawableRzlF\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(thin) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-meta\"\u003E@out\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E {\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %0 \"$return_value\"                             \u002F\u002F users: %4, %6\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %1 \"s\"\u003C\u002Fspan\u003E\nbb0(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E):\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E metatype $\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E                    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %4\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E witness_method \u003Cspan class=\"hljs-variable\"\u003E$T\u003C\u002Fspan\u003E, #\u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Eallocator : \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(witness_method: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003Eτ_0_0 \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E τ_0_0 : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E τ_0_0.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-meta\"\u003E@out\u003C\u002Fspan\u003E τ_0_0 \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %4\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E apply \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E) : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(witness_method: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003Eτ_0_0 \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E τ_0_0 : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@thick\u003C\u002Fspan\u003E τ_0_0.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E \u003Cspan class=\"hljs-meta\"\u003E@out\u003C\u002Fspan\u003E τ_0_0\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E witness_method \u003Cspan class=\"hljs-variable\"\u003E$T\u003C\u002Fspan\u003E, #\u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E.draw : \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(witness_method: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003Eτ_0_0 \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E τ_0_0 : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E τ_0_0) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %6\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E6\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E apply \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E) : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(witness_method: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E) \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003Eτ_0_0 \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E τ_0_0 : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-meta\"\u003E@in_guaranteed\u003C\u002Fspan\u003E τ_0_0) -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E tuple ()                                   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %8\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E7\u003C\u002Fspan\u003E : $()                                 \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %8\u003C\u002Fspan\u003E\n} \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F end sil function '$s4main9drawShapeyxxAA8DrawableRzlF'\u003C\u002Fspan\u003E\n\n\nsil_witness_table hidden \u003Cspan class=\"hljs-type\"\u003EShape\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E module main {\n  method #\u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003Einit\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E!\u003C\u002Fspan\u003Eallocator: \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E.\u003Cspan class=\"hljs-keyword\"\u003EType\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : @\u003Cspan class=\"hljs-variable\"\u003E$s4main5ShapeCAA8DrawableA2aDPxycfCTW\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F protocol witness for Drawable.init() in conformance Shape\u003C\u002Fspan\u003E\n  method #\u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E.draw: \u003Cspan class=\"hljs-operator\"\u003E&#x3C;\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E : \u003Cspan class=\"hljs-type\"\u003EDrawable\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-operator\"\u003E\u003E\u003C\u002Fspan\u003E (\u003Cspan class=\"hljs-keyword\"\u003ESelf\u003C\u002Fspan\u003E) -\u003E () -\u003E \u003Cspan class=\"hljs-type\"\u003EBool\u003C\u002Fspan\u003E : @\u003Cspan class=\"hljs-variable\"\u003E$s4main5ShapeCAA8DrawableA2aDP4drawSbyFTW\u003C\u002Fspan\u003E    \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F protocol witness for Drawable.draw() in conformance Shape\u003C\u002Fspan\u003E\n}\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E通过上面简单的分析可以看出 No Constraints、Class Constraints 以及 Protocol Constraints 的泛型类型在实现上的区别：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003ENo Constraints 泛型能做的事很少，不能执行任何方法，只能 Stack 上为泛型类型分配内存并执行内存拷贝；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EClass Constraints 泛型可以在 Heap 上创建新实例，方法调用通过虚函数表 (vtable) 实现；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EProtocol Constraints 泛型可以在 Stack 上也可以在 Heap 上按需创建泛型类型实例，无论泛型是值类型还是引用类型；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EProtocol Constraints 泛型通过 PWT 实现方法调用；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E也就是说泛型中的方法调用都是动态派发 (Dynamic dispatch)，通过 vtable 或者 PWT。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 data-id=\"heading-9\"\u003ESpecialization of Generics\u003C\u002Fh2\u003E\n\u003Cp\u003E从上一小节可知，泛型方法调用都是动态派发 (通过 vtable 或 PWT)，有一定的性能损耗。\u003C\u002Fp\u003E\n\u003Cp\u003E为了优化此类损耗，Swift 编译器会对泛型进行特化 (Specialization of Generics)。\u003C\u002Fp\u003E\n\u003Cp\u003E所谓特化就是为具体类型生成相应版本的函数，从而将泛型转成非泛型，实现方法调用的静态派发。\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-meta\"\u003E@inline\u003C\u002Fspan\u003E(never)\n\u003Cspan class=\"hljs-keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-title function_\"\u003EswapTwoValues\u003C\u002Fspan\u003E&#x3C;\u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E\u003E(\u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Ea\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Einout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-params\"\u003Eb\u003C\u002Fspan\u003E: \u003Cspan class=\"hljs-keyword\"\u003Einout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003ET\u003C\u002Fspan\u003E) {\n  \u003Cspan class=\"hljs-keyword\"\u003Elet\u003C\u002Fspan\u003E temp \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E a\n  a \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E b\n  b \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E temp\n}\n\n\u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E a \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E b \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E\nswapTwoValues(\u003Cspan class=\"hljs-operator\"\u003E&#x26;\u003C\u002Fspan\u003Ea, \u003Cspan class=\"hljs-operator\"\u003E&#x26;\u003C\u002Fspan\u003Eb)\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E如例，通过 \u003Ccode\u003EInt\u003C\u002Fcode\u003E 型参数调用 \u003Ccode\u003EswapTwoValues\u003C\u002Fcode\u003E 时，编译器就会生成该方法的 \u003Ccode\u003EInt\u003C\u002Fcode\u003E 版本：\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"hljs language-swift copyable\" lang=\"swift\"\u003E\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F specialized swapTwoValues&#x3C;A\u003E(_:_:)\u003C\u002Fspan\u003E\nsil shared [noinline] @\u003Cspan class=\"hljs-variable\"\u003E$s4main13swapTwoValuesyyxz_xztlFSi_Tg5\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-meta\"\u003E@convention\u003C\u002Fspan\u003E(thin) (\u003Cspan class=\"hljs-meta\"\u003E@inout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-meta\"\u003E@inout\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E) -\u003E () {\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %0 \"a\"                                         \u002F\u002F users: %6, %4, %2\u003C\u002Fspan\u003E\n\u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F %1 \"b\"                                         \u002F\u002F users: %7, %5, %3\u003C\u002Fspan\u003E\nbb0(\u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E):\n  debug_value_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"a\"\u003C\u002Fspan\u003E, argno \u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %2\u003C\u002Fspan\u003E\n  debug_value_addr \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E, \u003Cspan class=\"hljs-keyword\"\u003Evar\u003C\u002Fspan\u003E, name \u003Cspan class=\"hljs-string\"\u003E\"b\"\u003C\u002Fspan\u003E, argno \u003Cspan class=\"hljs-number\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %3\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E load \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E                            \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %7\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E load \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E                            \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %6\u003C\u002Fspan\u003E\n  store \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E5\u003C\u002Fspan\u003E to \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E0\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E                          \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %6\u003C\u002Fspan\u003E\n  store \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E4\u003C\u002Fspan\u003E to \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E1\u003C\u002Fspan\u003E : $\u003Cspan class=\"hljs-operator\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-type\"\u003EInt\u003C\u002Fspan\u003E                          \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %7\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E=\u003C\u002Fspan\u003E tuple ()                                   \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F user: %9\u003C\u002Fspan\u003E\n  \u003Cspan class=\"hljs-keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"hljs-operator\"\u003E%\u003C\u002Fspan\u003E\u003Cspan class=\"hljs-number\"\u003E8\u003C\u002Fspan\u003E : $()                                 \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F id: %9\u003C\u002Fspan\u003E\n} \u003Cspan class=\"hljs-comment\"\u003E\u002F\u002F end sil function '$s4main13swapTwoValuesyyxz_xztlFSi_Tg5'\u003C\u002Fspan\u003E\n\u003Cspan class=\"copy-code-btn\"\u003E复制代码\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E那么，什么时候会进行泛型特化呢？\u003C\u002Fp\u003E\n\u003Cp\u003E总的原则是在编译泛型方法时知道有哪些调用方，同时调用方的类型是可推演的。\u003C\u002Fp\u003E\n\u003Cp\u003E最简单的情况就是泛型方法与调用方在同一个源文件里，一起进行编译。\u003C\u002Fp\u003E\n\u003Cp\u003E另外在编译时若开启了 Whole-Module Optimization ，同一模块内部的泛型调用也可以被特化。\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E关于全模块优化请参考\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.swift.org%2Fblog%2Fwhole-module-optimizations%2F\" target=\"_blank\" title=\"https:\u002F\u002Fwww.swift.org\u002Fblog\u002Fwhole-module-optimizations\u002F\" ref=\"nofollow noopener noreferrer\"\u003ESwift.org - Whole-Module Optimization in Swift 3\u003C\u002Fa\u003E，在此不再赘述。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Ch1 data-id=\"heading-10\"\u003E小结\u003C\u002Fh1\u003E\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Cp\u003ESwift 为每种类型生成了一份 Metadata Record，其中包含了 VWT (Value Witness Table)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EProtocol 使用 Existential Container 作为其内存模型，所有 Protocol 类型的变量都是 Existential Container 的实例；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003EProtocol 通过 PWT 实现方法动态派发 (Dynamic dispatch)；\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E\n\u003Cp\u003E泛型调用在满足一定条件时会进行特化，以提升性能。\u003C\u002Fp\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch1 data-id=\"heading-11\"\u003E参考资料\u003C\u002Fh1\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift-evolution%2Fblob%2Fmaster%2Fproposals%2F0244-opaque-result-types.md\" target=\"_blank\" title=\"https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift-evolution\u002Fblob\u002Fmaster\u002Fproposals\u002F0244-opaque-result-types.md\" ref=\"nofollow noopener noreferrer\"\u003Eswift-evolution · Opaque Result Types\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fdocs.swift.org%2Fswift-book%2FLanguageGuide%2FOpaqueTypes.html\" target=\"_blank\" title=\"https:\u002F\u002Fdocs.swift.org\u002Fswift-book\u002FLanguageGuide\u002FOpaqueTypes.html\" ref=\"nofollow noopener noreferrer\"\u003EOpaqueTypes\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.swiftbysundell.com%2Farticles%2Fdifferent-flavors-of-type-erasure-in-swift%2F%23closures-to-the-rescue\" target=\"_blank\" title=\"https:\u002F\u002Fwww.swiftbysundell.com\u002Farticles\u002Fdifferent-flavors-of-type-erasure-in-swift\u002F#closures-to-the-rescue\" ref=\"nofollow noopener noreferrer\"\u003EDifferent flavors of type erasure in Swift\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.raywenderlich.com%2F24942207-opaque-return-types-and-type-erasure\" target=\"_blank\" title=\"https:\u002F\u002Fwww.raywenderlich.com\u002F24942207-opaque-return-types-and-type-erasure\" ref=\"nofollow noopener noreferrer\"\u003EOpaque Return Types and Type Erasure\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.swiftbysundell.com%2Farticles%2Fphantom-types-in-swift%2F\" target=\"_blank\" title=\"https:\u002F\u002Fwww.swiftbysundell.com\u002Farticles\u002Fphantom-types-in-swift\u002F\" ref=\"nofollow noopener noreferrer\"\u003EPhantom types in Swift\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.hackingwithswift.com%2Fplus%2Fadvanced-swift%2Fhow-to-use-phantom-types-in-swift\" target=\"_blank\" title=\"https:\u002F\u002Fwww.hackingwithswift.com\u002Fplus\u002Fadvanced-swift\u002Fhow-to-use-phantom-types-in-swift\" ref=\"nofollow noopener noreferrer\"\u003EHow to use phantom types in Swift\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeMetadata.rst%23protocol-metadata\" target=\"_blank\" title=\"https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeMetadata.rst#protocol-metadata\" ref=\"nofollow noopener noreferrer\"\u003Eswift\u002FTypeMetadata.rst at main · apple\u002Fswift · GitHub\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapple%2Fswift%2Fblob%2Fmain%2Fdocs%2FABI%2FTypeLayout.rst\" target=\"_blank\" title=\"https:\u002F\u002Fgithub.com\u002Fapple\u002Fswift\u002Fblob\u002Fmain\u002Fdocs\u002FABI\u002FTypeLayout.rst\" ref=\"nofollow noopener noreferrer\"\u003Eswift\u002FTypeLayout.rst at main · apple\u002Fswift · GitHub\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fspeakerdeck.com%2Fkateinoigakukun%2Fswift-type-metadata%3Fslide%3D48\" target=\"_blank\" title=\"https:\u002F\u002Fspeakerdeck.com\u002Fkateinoigakukun\u002Fswift-type-metadata?slide=48\" ref=\"nofollow noopener noreferrer\"\u003ESwift Type Metadata\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2016%2F416%2F\" target=\"_blank\" title=\"https:\u002F\u002Fdeveloper.apple.com\u002Fvideos\u002Fplay\u002Fwwdc2016\u002F416\u002F\" ref=\"nofollow noopener noreferrer\"\u003EUnderstanding Swift Performance · WWDC2016\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.juejin.cn?target=https%3A%2F%2Fwww.swift.org%2Fblog%2Fwhole-module-optimizations%2F\" target=\"_blank\" title=\"https:\u002F\u002Fwww.swift.org\u002Fblog\u002Fwhole-module-optimizations\u002F\" ref=\"nofollow noopener noreferrer\"\u003ESwift.org - Whole-Module Optimization in Swift 3\u003C\u002Fa\u003E\u003C\u002Fp\u003E",hitArticleCache:b,showSidebar:a,actionType:{FETCH:"view\u002Fcolumn\u002FFETCH",FETCH_ADDITIONAL:"view\u002Fcolumn\u002FFETCH_ADDITIONAL",FETCH_SIDEBAR_ADENTRY:"view\u002Fcolumn\u002FFETCH_SIDEBAR_ADENTRY",FETCH_AUTHOR_EXTRA:"view\u002Fcolumn\u002FFETCH_AUTHOR_EXTRA",RESET:"view\u002Fcolumn\u002FRESET"},recommendedArticleList:{list:[],cursor:f,loading:a,skeleton:a,hasMore:a,articleId:e,actionType:{UPDATE_STATE:"view\u002Fcolumn\u002Frecommend-List\u002FUPDATE_STATE",FETCH_MORE:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH_MORE",FETCH:"view\u002Fcolumn\u002Frecommend-List\u002FFETCH",RESET:"view\u002Fcolumn\u002Frecommend-List\u002FRESET"}}},collection:{collection:{author:{}},actionType:{FETCH:"@\u002Fview\u002Fcollection\u002FFETCH",REFRESH:"@\u002Fview\u002Fcollection\u002FREFRESH",RESET:"@\u002Fview\u002Fcollection\u002FRESET"},list:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fcollection\u002Flist\u002FUPDATE",FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fcollection\u002Flist\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fcollection\u002Flist\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fcollection\u002Flist\u002FRESET"},id:e,sort:n}},gettingStarted:{category:{},actionType:{UPDATE_STATE:"@\u002Fview\u002FgettingStarted\u002FUPDATE_STATE",FOLLOW:"@\u002Fview\u002FgettingStarted\u002FFOLLOW",RESET:"@\u002Fview\u002FgettingStarted\u002FRESET",UPDATE_CATEGORY:"@\u002Fview\u002FgettingStarted\u002FUPDATE_CATEGORY"}},pin:{pin:{user:{},imageUrlList:[]},pinList:[],actionType:{FETCH:"@\u002Fview\u002Fpin\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002FRESET"},sidebar:{list:[],after:e,loading:a,isRecommend:a,hasNextPage:b,actionType:{UPDATE_STATE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH_MORE",FETCH:"@\u002Fview\u002Fpin\u002Fsidebar\u002FFETCH",RESET:"@\u002Fview\u002Fpin\u002Fsidebar\u002FRESET"}},commentList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FcommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FcommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FcommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FcommentList\u002FRESET"},pinId:c},subCommentList:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FUPDATE",FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fpin\u002FsubCommentList\u002FRESET"},commentId:c}},topic:{topic:e,followedTopicList:[],actionType:{FETCH:"@\u002Fview\u002Ftopic\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002FUPDATE_STATE",RESET:"@\u002Fview\u002Ftopic\u002FRESET"},allTopicList:{pageSize:x,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FallTopicList\u002FRESET"},sortType:m},pinlist:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FpinList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FpinList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FpinList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FpinList\u002FRESET"},sortType:p},sidebar:{actionType:{RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FRESET",UPDATE_STATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002FUPDATE_STATE"},attender:{pageSize:h,page:g,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002Fsidebar\u002Fattender\u002FRESET"},topicId:c}},followedList:{pageSize:x,page:d,total:d,pointer:c,lastPointer:c,list:[],loading:a,error:c,canPrev:b,canNext:b,linkList:[],lastFetchOnServer:a,actionType:{UPDATE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FUPDATE",FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH",FORCE_FETCH:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFORCE_FETCH",FETCH_MORE:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FFETCH_MORE",RESET:"@\u002Fview\u002Ftopic\u002FfollowedList\u002FRESET"},after:d}},recommendationIndex:{actionType:{FETCH_USER:"@\u002Fview\u002Frecommendation\u002FFETCH_USER",FETCH_MORE:"@\u002Fview\u002Frecommendation\u002FFETCH_MORE",RESET:"@\u002Fview\u002Frecommendation\u002FRESET",FETCH:"@\u002Fview\u002Frecommendation\u002FFETCH"},cursor:e,hasMore:e,userList:[],loading:a,skeleton:b,category:k,categoryNavList:[],serverRenderUserList:a},event:{event:{},loading:a,user:{},actionType:{FETCH:"view\u002Fevent\u002FFETCH",RESET:"view\u002Fevent\u002FRESET"}},academyIndex:{academy:{},bannerList:[],qualitiedList:[],latestList:[],offlineList:[],loading:a,user:{},actionType:{FETCH:"view\u002Facademy\u002FFETCH",RESET:"view\u002Facademy\u002FRESET"}},coursesIndex:{loading:a,list:[],sort:"online",actionType:{FETCH:"view\u002Fcourses\u002FFETCH",RESET:"view\u002Fcourses\u002FRESET",FETCH_MORE:"view\u002Fcourses\u002FFETCH_MORE"}},team:{team:{},loading:b,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FFETCH",RESET:"@\u002Fview\u002Fteam\u002FRESET",UPDATE:"@\u002Fview\u002Fteam\u002FUPDATE",FOLLOW:"@\u002Fview\u002Fteam\u002FFOLLOW"},detailList:{actionType:{RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002FRESET"},posts:{list:[],hasMore:a,skeleton:a,loading:a,sort:n,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fposts\u002FRESET"}},pins:{list:[],hasMore:a,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fpins\u002FRESET"}},hire:{list:[],hasMore:a,cursor:f,loading:a,skeleton:b,actionType:{FETCH:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FFETCH",UPDATE_STATE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FUPDATE_STATE",FETCH_MORE:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FFETCH_MORE",RESET:"@\u002Fview\u002Fteam\u002FdetailList\u002Fhire\u002FRESET"}}}},couponList:{list:{"0":q,"1":q,"2":q}},payment:{selectedDiscount:{},bookletDetail:{},coupons:{availables:[],unavailables:[]},discountList:[]},activityVip:{selectedVipSku:{}}},component:{indexAside:{bannerList:[],userList:[],actionType:{FETCH_BANNER:"@\u002Fcomponent\u002Faside\u002FFETCH_BANNER",FETCH_USER:"@\u002Fcomponent\u002Faside\u002FFETCH_USER",CLOSE_BANNER:"@\u002Fcomponent\u002Faside\u002FCLOSE_BANNER"}}},ore:{oreCount:d},avatarMenuInfo:{},common:{theme:"light"},env:{ua:"Mozilla\u002F5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F110.0.0.0 Safari\u002F537.36",serverEnv:"production"},auth:{user:{id:"2894327269039357",self_description:void 0,followed:a,viewerIsFollowing:void 0,community:void 0,subscribedTagCount:12,wroteBookCount:d,boughtBookCount:d,isBindedPhone:g,level:d,user_id:"2894327269039357",user_name:"Leon0206",company:"网易云音乐",job_title:"iOS开发工程师",avatar_large:"https:\u002F\u002Fp6-passport.byteacctimg.com\u002Fimg\u002Fmosaic-legacy\u002F3795\u002F3044413937~300x300.image",power:d,phone:"17*****0590",email:e,allow_notification:a,rank_index:d,wallet_total_bill:d,description:e,blog_address:e,is_black:a,editor_type:e,register_time:1627475051,update_time:-62135596800,administrator:d,builder:d,favorable_author:d,book_author:d,phone_verified:g,wechat_verified:d,weibo_verified:d,github_verified:d,followee_count:6,follower_count:d,post_article_count:d,digg_article_count:l,view_article_count:118,subscribe_tag_count:12,got_digg_count:d,got_view_count:d,comment_count:d,collect_set_count:g,booklet_count:d,buy_booklet_count:d,post_shortmsg_count:d,comment_shortmsg_count:d,digg_shortmsg_count:d,ltime:d,isfollowed:a,forbidden_words:d,create_collect_set_count:g,follow_collect_set_count:d,weibo_nickname:e,wechat_nickname:e,github_nickname:e,apply_logout:d,is_logout:d,weibo_id:e,is_new:a,study_point:d,university:{university_id:f,name:e,logo:e},major:{major_id:f,parent_id:f,name:e},student_status:d,select_event_count:d,select_online_course_count:d,identity:d,graduated_at:-62135596800,blog_move_priority:a,tech_team:{org_id:f,org_name:e,org_icon:e,role:d},job_count:d,is_select_annual:a,select_annual_rank:d,annual_list_type:d,digg_news_count:d,news_privilege:d,digg_toutiao_count:d,follow_column_cnt:g,can_tag_cnt:g,need_lead:d,follow_topic_count:d,badges:{wear_badges:c,obtain_badges:c,obtain_count:d,show_badge:a,link_url:e},is_collect_fast:a,user_growth_info:{user_id:2894327269039357,jpower:d,jscore:48,jpower_level:d,jscore_level:3,jscore_title:"新星掘友",author_achievement_list:[],vip_level:d,vip_title:e,jscore_next_level_score:150,jscore_this_level_mini_score:30},is_vip:a,collection_set_article_count:d,juejinPower:d,jobTitle:"iOS开发工程师",roles:{isBookAuthor:a,isFavorableAuthor:a,isCobuilder:a,isAdmin:a},username:"Leon0206",blogAddress:e,selfDescription:e,beLikedCount:d,beReadCount:d,followerCount:d,followingCount:6,collectionCount:g,createdCollectionCount:g,followingCollectionCount:d,postedPostsCount:d,pinCount:d,likedArticleCount:l,likedPinCount:d,avatar:"https:\u002F\u002Fp6-passport.byteacctimg.com\u002Fimg\u002Fmosaic-legacy\u002F3795\u002F3044413937~300x300.image",latestLoginedInAt:c,createdAt:new Date(1627475051000),updatedAt:c,phoneNumber:"17*****0590",titleDescription:e,followeesCount:6,applyEventCount:d,followTopicCnt:d},clientId:e,token:e,qrCode:c,qrCodeStatus:c,qrCodeToken:c},tag:{subscribedTagList:[]},entry:{isLikeLoading:a},collection:{},comment:{},bookComment:{},repoComment:{},category:{list:[]},user:{subscribedTagList:[]},notification:{unreadCount:{user:d,system:d,total:d}},follow:{subscribedTagList:[]},error:{location:c,errorView:c,statusCode:200,needRiskModal:a,riskAppealUrl:e},abTest:{info:{}},suspensionPanel:{needSuspension:b},pinComment:{},pin:{deleteDialogVisible:a,reportDialogVisible:a,targetPin:c,isOnFocus:a},topic:{visible:a},activity:{"2020":{},offer:{is_show:d,start_time:d},voteData:{err_no:d,err_msg:"success",data:{face:{title:e,activity_id:"5",start_time:y,end_time:1675699200,status:l,image:"https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fd9c6d6b34c8045e993f2f607a660dd43~tplv-k3u1fbpfcp-zoom-1.image",close_image:"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F882fc263e36347ffbf6d598de520870e~tplv-k3u1fbpfcp-image.image",url:"https:\u002F\u002Fjuejin.cn\u002Fpin\u002F7195849498253770808?utm_source=popup&utm_medium=jjapp&utm_campaign=xcyxj",is_show:d},top:{title:r,activity_id:j,start_time:s,end_time:t,status:g,image:"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F9563d620af3b48a791f77019c948f064~tplv-k3u1fbpfcp-zoom-1.image",close_image:"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Ff49fe994db7b4af7846259d97610bec0~tplv-k3u1fbpfcp-zoom-1.image",url:"https:\u002F\u002Fjuejin.cn\u002Fvip?utm_source=app_top",is_show:g},web_top:{title:r,activity_id:j,start_time:s,end_time:t,status:g,image:z,close_image:"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F19e7f58eecbd497c92397344e1d489a6~tplv-k3u1fbpfcp-zoom-1.image",url:"https:\u002F\u002Fjuejin.cn\u002Fvip?utm_source=web_nav",is_show:g},plugin_top:{title:r,activity_id:j,start_time:s,end_time:t,status:g,image:z,close_image:u,url:"https:\u002F\u002Fjuejin.cn\u002Fvip?utm_source=gold_browser_extension",is_show:g},search_top:{title:A,activity_id:j,start_time:B,end_time:1675612799,status:l,image:C,close_image:D,url:E,is_show:d},web_search:{title:A,activity_id:j,start_time:B,end_time:y,status:l,image:C,close_image:D,url:E,is_show:d},jcode_top:{title:"码上掘金编程挑战赛",activity_id:j,start_time:1670846400,end_time:1671983999,status:l,image:u,close_image:u,url:"https:\u002F\u002Fjuejin.cn\u002Fchallenge?utm_source=code_nav",is_show:d},offer:{title:e,activity_id:"2020",start_time:1617638400,end_time:1618934400,status:l,image:"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F2879410508de459c91ae8b7509ca75f8~tplv-k3u1fbpfcp-zoom-1.image",close_image:"https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fa38d640009e14c87a7d29cd95dee27dd~tplv-k3u1fbpfcp-zoom-1.image",url:"https:\u002F\u002Fjuejin-activity.bytedance.net\u002Frank",is_show:d}}}},header:{leadStep:d,isPopupZlink:a},tcc:{tccConfig:c},route:{name:"column",path:v,hash:e,query:{},params:{id:w},fullPath:v,meta:{},from:{name:c,path:F,hash:e,query:{},params:{},fullPath:F,meta:{}}}},serverRendered:b,routePath:v,config:{API_HOST:"api.juejin.cn",CAPTCHA_HOST:"verify.snssdk.com",PLATFORM_APPID:{wechat:1277,weibo:1276,github:1045,wechatApp:1070},SCM_VERSION:"1.0.0.6544",http:{}},globalRefs:{}}}(false,true,null,0,"","0",1,20,"topic","2022","recommended",2,"hot","newest","following","popular",{},"掘金会员",1673020800,1680278400,"https:\u002F\u002Fp6-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F759e2aa805c0461b840e0f0f09ed05fa~tplv-k3u1fbpfcp-zoom-1.image?","\u002Fpost\u002F7061891716931911687","7061891716931911687",100,1675612800,"https:\u002F\u002Fp3-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F7482b3ad2cd14edda31f05399c2ae759~tplv-k3u1fbpfcp-zoom-1.image","开启我的2022年度报告",1672797600,"https:\u002F\u002Fp1-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002F8a41831fce8b4c838f1807b2c86aea06~tplv-k3u1fbpfcp-zoom-1.image","https:\u002F\u002Fp9-juejin.byteimg.com\u002Ftos-cn-i-k3u1fbpfcp\u002Fe5199830276c4a85bc7c8cb8edecd54d~tplv-k3u1fbpfcp-image.image","https:\u002F\u002Fjuejin.cn\u002Freport2022\u002Fmobile?utm_source=search","\u002F"));</script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/6ccc1bf.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/c68ae6a.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/607e9aa.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/fe8610f.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/37aab1f.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/83d184c.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/6a0af43.js" defer=""></script><script src="./Swift Protocol 背后的故事(理论) - 掘金_files/6e787e2.js" defer=""></script>
  

<link href="./Swift Protocol 背后的故事(理论) - 掘金_files/52.39cb9d6.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/4.4ebc7e8.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/default.c3d25dd.css" rel="stylesheet" type="text/css"><div data-v-47b82694="" data-v-1b688d7c="" data-transfer="true" class="collection-list-modal byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1000; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1000; display: none;"><div class="byte-modal__content" style="width: 520px;"><!----><div class="byte-modal__body"></div><!----></div></div></div><div data-v-47b82694="" data-v-fe76cb40="" data-transfer="true" class="collection-list-modal byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1001; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1001; display: none;"><div class="byte-modal__content" style="width: 520px;"><!----><div class="byte-modal__body"></div><!----></div></div></div><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/198.adcadde.css" rel="stylesheet" type="text/css"><div data-transfer="true" class="risk-modal byte-modal v-transfer-dom" align-center=""><div class="byte-modal__mask" style="z-index: 1002; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1002; display: none;"><div class="byte-modal__content" style="width: 350px;"><!----><div class="byte-modal__body"><div class="risk-modal-inner"><div class="risk-modal-title">温馨提示</div> <div>当前操作失败，如有疑问，可点击申诉</div> <div class="risk-modal-footer"><button type="button" class="cancel-button risk-button byte-btn byte-btn--default byte-btn--large"><!----><!----><span><span>前往申诉</span></span></button> <button type="button" class="risk-button byte-btn byte-btn--primary byte-btn--large"><!----><!----><span><span>我知道了</span></span></button></div></div></div><!----></div></div></div><div class="byte-tooltip byte-tooltip--dark" style="display: none; position: absolute; max-width: none; will-change: transform; z-index: 1003; top: 0px; left: 0px; transform: translate3d(39px, 617px, 0px);" x-placement="top">
        沉浸阅读
      <div x-arrow="" class="popper__arrow" style="left: 0px;"></div></div><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/139.9ccface.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/181.1b801b1.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/192.1dc0908.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/158.cb7fed2.css" rel="stylesheet" type="text/css"><div data-v-41eefe39="" data-transfer="true" class="lead byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1004; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1004; display: none;"><div class="byte-modal__content" style="width: 500px;"><div class="byte-modal__header"><img data-v-41eefe39="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/MaskGroup.13dfc4f.png" alt="" loading="lazy" class="header-bgc"> <span data-v-41eefe39="" class="header-title">选择你感兴趣的技术方向</span><span aria-label="Close" class="byte-modal__headerbtn"><i class="byte-icon byte-icon--close"><svg t="1561638608887" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="441911" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M512 448l288-288c6.4-6.4 19.2-6.4 32 0l25.6 32c6.4 6.4 6.4 19.2 0 32L569.6 505.6l288 288c6.4 6.4 6.4 19.2 0 32l-32 32c-6.4 6.4-19.2 6.4-32 0L512 569.6l-288 288c-6.4 6.4-19.2 6.4-32 0l-32-32c-6.4-6.4-6.4-19.2 0-32L448 505.6 160 224c-6.4-12.8-6.4-25.6 0-32l32-32c6.4-6.4 19.2-6.4 32 0L512 448z" p-id="441912"></path><path d="M512 448l288-288c6.4-6.4 19.2-6.4 32 0l25.6 32c6.4 6.4 6.4 19.2 0 32L569.6 505.6l288 288c6.4 6.4 6.4 19.2 0 32l-32 32c-6.4 6.4-19.2 6.4-32 0L512 569.6l-288 288c-6.4 6.4-19.2 6.4-32 0l-32-32c-6.4-6.4-6.4-19.2 0-32L448 505.6 160 224c-6.4-12.8-6.4-25.6 0-32l32-32c6.4-6.4 19.2-6.4 32 0L512 448z" p-id="441913"></path></svg></i></span></div><div class="byte-modal__body"> <div data-v-41eefe39="" class="classify-box"><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M2 2.5C1.44772 2.5 1 2.94772 1 3.5V11.5C1 12.0523 1.44772 12.5 2 12.5H14C14.5523 12.5 15 12.0523 15 11.5V3.5C15 2.94772 14.5523 2.5 14 2.5H2ZM4.5 7.5C4.22386 7.5 4 7.72386 4 8V10C4 10.2761 4.22386 10.5 4.5 10.5H5C5.27614 10.5 5.5 10.2761 5.5 10V8C5.5 7.72386 5.27614 7.5 5 7.5H4.5ZM7 5.5C7 5.22386 7.22386 5 7.5 5H8C8.27614 5 8.5 5.22386 8.5 5.5V10C8.5 10.2761 8.27614 10.5 8 10.5H7.5C7.22386 10.5 7 10.2761 7 10V5.5ZM10.5 6.5C10.2239 6.5 10 6.72386 10 7V10C10 10.2761 10.2239 10.5 10.5 10.5H11C11.2761 10.5 11.5 10.2761 11.5 10V7C11.5 6.72386 11.2761 6.5 11 6.5H10.5Z" fill="#86909C"></path><rect data-v-41eefe39="" id="Rectangle 282" x="3" y="13.5" width="10" height="1.3" rx="0.5" fill="#86909C"></rect></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              后端
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M2 2.5C1.44772 2.5 1 2.94772 1 3.5V6.5H15V3.5C15 2.94772 14.5523 2.5 14 2.5H2ZM15 7.8H1V13.5C1 14.0523 1.44772 14.5 2 14.5H14C14.5523 14.5 15 14.0523 15 13.5V7.8ZM8.65811 8.52566C8.92009 8.61298 9.06167 8.89614 8.97434 9.15811L7.97434 12.1581C7.88702 12.4201 7.60386 12.5617 7.34189 12.4743C7.07991 12.387 6.93833 12.1039 7.02566 11.8419L8.02566 8.84189C8.11298 8.57991 8.39614 8.43833 8.65811 8.52566ZM3.5 5.5C3.77614 5.5 4 5.27614 4 5C4 4.72386 3.77614 4.5 3.5 4.5C3.22386 4.5 3 4.72386 3 5C3 5.27614 3.22386 5.5 3.5 5.5ZM5.5 5C5.5 5.27614 5.27614 5.5 5 5.5C4.72386 5.5 4.5 5.27614 4.5 5C4.5 4.72386 4.72386 4.5 5 4.5C5.27614 4.5 5.5 4.72386 5.5 5ZM6.5 5.5C6.77614 5.5 7 5.27614 7 5C7 4.72386 6.77614 4.5 6.5 4.5C6.22386 4.5 6 4.72386 6 5C6 5.27614 6.22386 5.5 6.5 5.5ZM6.44721 9.27639C6.57071 9.52338 6.4706 9.82372 6.22361 9.94721L5.11803 10.5L6.22361 11.0528C6.4706 11.1763 6.57071 11.4766 6.44721 11.7236C6.32372 11.9706 6.02338 12.0707 5.77639 11.9472L3.77639 10.9472C3.607 10.8625 3.5 10.6894 3.5 10.5C3.5 10.3106 3.607 10.1375 3.77639 10.0528L5.77639 9.05279C6.02338 8.92929 6.32372 9.0294 6.44721 9.27639ZM9.77639 9.94721C9.5294 9.82372 9.42929 9.52338 9.55279 9.27639C9.67628 9.0294 9.97662 8.92929 10.2236 9.05279L12.2236 10.0528C12.393 10.1375 12.5 10.3106 12.5 10.5C12.5 10.6894 12.393 10.8625 12.2236 10.9472L10.2236 11.9472C9.97662 12.0707 9.67628 11.9706 9.55279 11.7236C9.42929 11.4766 9.5294 11.1763 9.77639 11.0528L10.882 10.5L9.77639 9.94721Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              前端
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><rect data-v-41eefe39="" id="Rectangle 287" x="5.7002" y="12.5" width="1.3" height="3" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 289" x="1" y="6.5" width="1.3" height="6" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 290" x="13.7002" y="6.5" width="1.3" height="6" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 288" x="9" y="12.5" width="1.3" height="3" rx="0.5" fill="#86909C"></rect><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M13 5.86364V12.5C13 13.0523 12.5523 13.5 12 13.5H4C3.44772 13.5 3 13.0523 3 12.5V5.86364V5.77273C3 5.74067 3.00151 5.70897 3.00446 5.67768C3.11608 3.35397 5.30996 1.5 8 1.5C10.69 1.5 12.8839 3.35397 12.9955 5.67768C12.9985 5.70897 13 5.74067 13 5.77273V5.86364ZM7 6.25C7 6.66421 6.66421 7 6.25 7C5.83579 7 5.5 6.66421 5.5 6.25C5.5 5.83579 5.83579 5.5 6.25 5.5C6.66421 5.5 7 5.83579 7 6.25ZM9.75 7C10.1642 7 10.5 6.66421 10.5 6.25C10.5 5.83579 10.1642 5.5 9.75 5.5C9.33579 5.5 9 5.83579 9 6.25C9 6.66421 9.33579 7 9.75 7Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              Android
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39=""><g data-v-41eefe39="" id="pingguo-2 1"><path data-v-41eefe39="" id="Vector" d="M11.821 8.9388C11.8035 7.16562 13.267 6.31556 13.3322 6.27312C12.5097 5.06956 11.2287 4.90506 10.7724 4.88581C9.6821 4.77556 8.64523 5.52763 8.09179 5.52763C7.5401 5.52763 6.6861 4.902 5.78179 4.91863C4.59354 4.93613 3.49761 5.60944 2.88598 6.67387C1.65136 8.8163 2.56967 11.9899 3.77323 13.7277C4.36123 14.5782 5.06254 15.5332 5.98304 15.4991C6.86942 15.4637 7.20498 14.9255 8.27642 14.9255C9.34785 14.9255 9.64929 15.4991 10.5877 15.4816C11.5415 15.4637 12.1461 14.6149 12.7302 13.7618C13.4052 12.7752 13.6835 11.8197 13.6997 11.7707C13.6787 11.7611 11.8394 11.0567 11.821 8.9388ZM10.0584 3.73563C10.547 3.14281 10.8769 2.32031 10.7868 1.5C10.0829 1.52888 9.22973 1.969 8.72485 2.56006C8.2716 3.08463 7.87523 3.922 7.98154 4.72613C8.76729 4.78737 9.56923 4.32669 10.0584 3.73563Z" fill="#86909C"></path></g></g><defs data-v-41eefe39=""></defs></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              iOS
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><rect data-v-41eefe39="" id="Rectangle 289" x="1" y="8.5" width="1.3" height="5" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 292" x="14" y="8.5" width="1.3" height="5" rx="0.5" fill="#86909C"></rect><rect data-v-41eefe39="" id="Rectangle 293" x="7.5" y="4.5" width="1" height="3" rx="0.5" fill="#86909C"></rect><circle data-v-41eefe39="" id="Ellipse 25" cx="8" cy="2.5" r="1" fill="#86909C"></circle><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M3 7.5C3 6.94772 3.44772 6.5 4 6.5H12C12.5523 6.5 13 6.94772 13 7.5V14.5C13 15.0523 12.5523 15.5 12 15.5H4C3.44772 15.5 3 15.0523 3 14.5V7.5ZM7 11.25C7 11.6642 6.66421 12 6.25 12C5.83579 12 5.5 11.6642 5.5 11.25C5.5 10.8358 5.83579 10.5 6.25 10.5C6.66421 10.5 7 10.8358 7 11.25ZM9.75 12C10.1642 12 10.5 11.6642 10.5 11.25C10.5 10.8358 10.1642 10.5 9.75 10.5C9.33579 10.5 9 10.8358 9 11.25C9 11.6642 9.33579 12 9.75 12Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              人工智能
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><g data-v-41eefe39="" id="kaifagongjuicon-hui 1"><path data-v-41eefe39="" id="Vector" d="M14.212 5.04986L13.497 5.76886C13.3158 5.95088 13.1005 6.09531 12.8633 6.19386C12.6261 6.29242 12.3718 6.34315 12.115 6.34315C11.8582 6.34315 11.6039 6.29242 11.3667 6.19386C11.1295 6.09531 10.9142 5.95088 10.733 5.76886C10.3664 5.39915 10.1606 4.89955 10.1606 4.37886C10.1606 3.85817 10.3664 3.35857 10.733 2.98886L11.448 2.26986C11.843 1.87286 11.579 1.40486 10.868 1.51686C10.028 1.64786 9.262 2.07586 8.709 2.72286C8.005 3.41786 7.682 4.66486 7.922 5.81786L1.927 11.8469C1.56096 12.2165 1.35562 12.7157 1.35562 13.2359C1.35562 13.7561 1.56096 14.2552 1.927 14.6249C2.10804 14.807 2.32329 14.9515 2.56038 15.0501C2.79747 15.1487 3.05172 15.1995 3.3085 15.1995C3.56528 15.1995 3.81953 15.1487 4.05662 15.0501C4.29371 14.9515 4.50896 14.807 4.69 14.6249L10.686 8.59486C11.2693 8.7189 11.8745 8.69473 12.446 8.52459C13.0176 8.35444 13.5375 8.04373 13.958 7.62086C14.5581 7.01861 14.9243 6.22244 14.991 5.37486C15.071 4.91886 14.607 4.65286 14.212 5.04986ZM3.768 13.6979C3.67659 13.7885 3.56041 13.85 3.4341 13.8747C3.30779 13.8994 3.17699 13.8861 3.05819 13.8366C2.93939 13.7871 2.8379 13.7036 2.76651 13.5965C2.69511 13.4894 2.65701 13.3636 2.657 13.2349C2.65647 13.0618 2.72462 12.8957 2.84649 12.7729C2.96836 12.6501 3.13399 12.5807 3.307 12.5799C3.487 12.5799 3.651 12.6529 3.768 12.7719C3.888 12.8889 3.96 13.0539 3.96 13.2349C3.9604 13.3209 3.94363 13.4062 3.91066 13.4857C3.87769 13.5652 3.82919 13.6373 3.768 13.6979ZM3.118 5.16786L5.377 7.43986L6.297 6.51286L4.04 4.24286L3.535 3.27086L1.92 2.11186L1 3.03986L2.151 4.66086L3.118 5.16786ZM10.672 9.98586C10.642 9.95526 10.6062 9.93095 10.5667 9.91436C10.5272 9.89776 10.4848 9.88921 10.442 9.88921C10.3992 9.88921 10.3568 9.89776 10.3173 9.91436C10.2778 9.93095 10.242 9.95526 10.212 9.98586L8.83 11.3759C8.79955 11.4062 8.7754 11.4423 8.75891 11.482C8.74243 11.5218 8.73395 11.5644 8.73395 11.6074C8.73395 11.6504 8.74243 11.693 8.75891 11.7327C8.7754 11.7724 8.79955 11.8085 8.83 11.8389L12.09 15.1169C12.2106 15.2383 12.3541 15.3348 12.5122 15.4006C12.6703 15.4663 12.8398 15.5002 13.011 15.5002C13.1822 15.5002 13.3517 15.4663 13.5098 15.4006C13.6679 15.3348 13.8114 15.2383 13.932 15.1169C14.442 14.6049 14.442 13.7769 13.932 13.2639L10.672 9.98586Z" fill="#86909C"></path></g></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              开发工具
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M1 2.5C1 1.94772 1.44772 1.5 2 1.5H14C14.5523 1.5 15 1.94772 15 2.5V14.5C15 15.0523 14.5523 15.5 14 15.5H2C1.44772 15.5 1 15.0523 1 14.5V2.5ZM3 5C3 4.72386 3.22386 4.5 3.5 4.5H12.5C12.7761 4.5 13 4.72386 13 5V5.3C13 5.57614 12.7761 5.8 12.5 5.8H3.5C3.22386 5.8 3 5.57614 3 5.3V5ZM3.5 7.5C3.22386 7.5 3 7.72386 3 8V8.3C3 8.57614 3.22386 8.8 3.5 8.8H4.5C4.77614 8.8 5 8.57614 5 8.3V8C5 7.72386 4.77614 7.5 4.5 7.5H3.5ZM7 8C7 7.72386 7.22386 7.5 7.5 7.5H8.5C8.77614 7.5 9 7.72386 9 8V8.3C9 8.57614 8.77614 8.8 8.5 8.8H7.5C7.22386 8.8 7 8.57614 7 8.3V8ZM11.5 7.5C11.2239 7.5 11 7.72386 11 8V8.3C11 8.57614 11.2239 8.8 11.5 8.8H12.5C12.7761 8.8 13 8.57614 13 8.3V8C13 7.72386 12.7761 7.5 12.5 7.5H11.5ZM3 11C3 10.7239 3.22386 10.5 3.5 10.5H7.5C7.77614 10.5 8 10.7239 8 11V11.3C8 11.5761 7.77614 11.8 7.5 11.8H3.5C3.22386 11.8 3 11.5761 3 11.3V11ZM10.5 10.5C10.2239 10.5 10 10.7239 10 11V11.3C10 11.5761 10.2239 11.8 10.5 11.8H12.5C12.7761 11.8 13 11.5761 13 11.3V11C13 10.7239 12.7761 10.5 12.5 10.5H10.5Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              代码人生
            </span></div></div></div><div data-v-41eefe39="" class="technology-box"><div data-v-41eefe39="" class="wrap"><svg data-v-41eefe39="" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg" class="left"><g data-v-41eefe39="" id="&amp;#230;&amp;#161;&amp;#136;&amp;#228;&amp;#190;&amp;#139;"><path data-v-41eefe39="" id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M14.9187 7.03385C15.0999 7.26744 14.9466 7.7 14.651 7.7H6.32905V4.5H5.02905V7.7H3.6C2.16406 7.7 1 6.53594 1 5.1C1 3.66406 2.16406 2.5 3.6 2.5H14.651C14.9466 2.5 15.0999 2.93257 14.9188 3.16616C14.5064 3.69779 14.2602 4.36959 14.2602 5.10001C14.2602 5.83043 14.5064 6.50222 14.9187 7.03385Z" fill="#86909C"></path><path data-v-41eefe39="" id="Subtract_2" fill-rule="evenodd" clip-rule="evenodd" d="M1.34902 14.5008C1.0534 14.5008 0.900077 14.0682 1.08126 13.8346C1.49363 13.303 1.7398 12.6312 1.7398 11.9008C1.7398 11.1704 1.49362 10.4986 1.08125 9.96694C0.900064 9.73335 1.05339 9.30078 1.34901 9.30078H12.4C13.8359 9.30078 15 10.4648 15 11.9008C15 13.3367 13.8359 14.5008 12.4 14.5008H1.34902Z" fill="#86909C"></path></g></svg> <div data-v-41eefe39="" class="right"><span data-v-41eefe39="" class="descrip">
              阅读
            </span></div></div></div></div> <!----></div><div class="byte-modal__footer"><div data-v-41eefe39="" class="left">跳过</div> <div data-v-41eefe39="" class="mid" style="display: none;">上一步</div> <div data-v-41eefe39="" class="right">
      至少选择1个分类
    </div></div></div></div></div><div data-v-8bb78912="" data-transfer="true" class="upgrade-new-modal byte-modal v-transfer-dom"><div class="byte-modal__mask" style="z-index: 1005; display: none;"></div><div class="byte-modal__wrapper" style="z-index: 1005; display: none;"><div class="byte-modal__content" style="width: 311px;"><div class="byte-modal__header"><span class="byte-modal__title"></span><!----></div><div class="byte-modal__body"> <!----> <div data-v-8bb78912="" class="close-icon"><img data-v-8bb78912="" src="./Swift Protocol 背后的故事(理论) - 掘金_files/8867e249c23a7c0ea596c139befc04d7.svg" alt=""></div></div><!----></div></div></div><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/100.b5554a0.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/155.cc4a86e.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/9.b3ecb8a.css" rel="stylesheet" type="text/css"><link href="./Swift Protocol 背后的故事(理论) - 掘金_files/88.9843b4c.css" rel="stylesheet" type="text/css"></body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>